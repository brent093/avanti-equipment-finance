"use client";
import { useState, useEffect, useCallback, useRef, createContext, useContext, useMemo } from "react";
// lodash removed — using native sort

// ════════════════════════════════════════════════════════════════
// AVANTI EQUIPMENT FINANCE — UNIFIED WEB APPLICATION
// CRM + Admin + Dealer Portal + Customer Portal
// ════════════════════════════════════════════════════════════════

// Fonts and CSS injected via useEffect (SSR-safe)
const INJECT_CSS = `
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  ::-webkit-scrollbar{width:5px;height:5px}
  ::-webkit-scrollbar-track{background:transparent}
  ::-webkit-scrollbar-thumb{background:#2A2A2E;border-radius:10px}
  ::selection{background:#4F8EAE44}
  input:focus,select:focus,textarea:focus{border-color:#4F8EAE !important;outline:none}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  @keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}
  @keyframes progFill{from{width:0}}
  @keyframes scaleIn{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
  .av-row:hover{border-color:#2A2A2E !important;background:#161618 !important}
  .av-card:hover{border-color:#2A2A2E !important;transform:translateY(-1px)}
  .av-btn:hover{filter:brightness(1.15)}
  .av-ghost:hover{border-color:#4F8EAE !important;color:#4F8EAE !important}
  .av-tab:hover{color:#bbb !important}
  .av-kcard:hover{border-color:#2A2A2E !important;background:#1E1E22 !important}
`;

// ── CONFIG ────────────────────────────────────────────────────

// Brand colors from Avanti logo
const BRAND = {
  steelBlue: "#4F8EAE",    // Primary accent — logo's steel blue
  darkBlue: "#3A6F8F",     // Darker steel blue
  lightBlue: "#6BA3BF",    // Lighter variant
  black: "#0D0D0D",        // Logo black
  charcoal: "#1C1C1C",     // Near black
  white: "#F0F0F0",        // Clean white
  green: "#4CAF50",
  red: "#B0413E",
  slate: "#5A6872",
};

const STAGES = [
  { id:"new_lead", label:"New Lead", color:BRAND.steelBlue, order:0 },
  { id:"contacted", label:"Contacted", color:"#6BA3BF", order:1 },
  { id:"app_submitted", label:"App Submitted", color:"#3A6F8F", order:2 },
  { id:"in_review", label:"In Review", color:"#7B8FA3", order:3 },
  { id:"approved", label:"Approved", color:BRAND.green, order:4 },
  { id:"docs_out", label:"Docs Out", color:"#2E9A8F", order:5 },
  { id:"funded", label:"Funded", color:"#2E7D32", order:6 },
  { id:"declined", label:"Declined", color:BRAND.red, order:7 },
  { id:"dead", label:"Dead", color:"#555", order:8 },
];

const CUST_STAGES = {
  new_lead:{label:"Application Received",desc:"We've received your application and it's in our queue.",progress:10},
  contacted:{label:"Initial Review",desc:"Our team is reviewing your information.",progress:20},
  app_submitted:{label:"Submitted to Credit",desc:"Your application has been submitted for credit review.",progress:40},
  in_review:{label:"Under Review",desc:"Lenders are actively reviewing your application. Typically 1-3 business days.",progress:55},
  approved:{label:"Approved!",desc:"Congratulations! Your financing has been approved. You may accept the approval below or your account manager will be in touch with next steps.",progress:75},
  docs_out:{label:"Documents Sent",desc:"Your financing documents have been sent for signature.",progress:90},
  funded:{label:"Funded",desc:"Your deal has been funded! The vendor will be notified to proceed.",progress:100},
  declined:{label:"Unable to Approve",desc:"We were unable to secure approval at this time. Your account manager will discuss alternatives.",progress:0},
  dead:{label:"Inactive",desc:"This application is currently inactive. Contact your account manager to restart.",progress:0},
};

const EQ_TYPES = ["Tow Truck","Flatbed","Excavator","Loader","Crane","Dump Truck","Semi Truck","Trailer","Skid Steer","Bulldozer","Forklift","Box Truck","Other"];
const SOURCES = ["Jotform Application","Dealer Referral","Website","Phone Call","Email","Social Media","Repeat Customer","Other"];
const REQ_DOCS = [
  {id:"credit_app",label:"Credit Application",req:true,stage:"always"},
  {id:"equipment_quote",label:"Equipment Quote / Invoice",req:true,stage:"always"},
  {id:"drivers_license",label:"Driver's License",req:false,stage:"always"},
  {id:"bank_statements",label:"Bank Statements (3 mo)",req:false,stage:"always"},
  {id:"tax_returns",label:"Tax Returns (2 yr)",req:false,stage:"always"},
  {id:"business_license",label:"Business License",req:false,stage:"always"},
  {id:"insurance_cert",label:"Certificate of Insurance",req:false,stage:"always"},
  {id:"voided_check",label:"Voided Check",req:false,stage:"always"},
];

// Auto-added when deal moves to docs_out (after approval accepted)
const DOCS_OUT_ITEMS = [
  {text:"Driver's License Copy (front & back)",category:"customer"},
  {text:"Voided Check (matching business bank account)",category:"customer"},
];

// Auto-added when deal moves to funded (dealer must provide)
const FUNDING_ITEMS_AUTO = [
  {text:"Final Invoice (must list make, model, VIN, mileage & customer info)",category:"dealer"},
  {text:"Title Copy (front & back)",category:"dealer"},
];

const COMMON_STIPS = [
  "Bank Statements (3 months)",
  "Bank Statements (6 months)",
  "Tax Returns (2 years)",
  "Profit & Loss Statement",
  "Balance Sheet",
  "Equipment Invoice / Quote",
  "Debt Schedule",
  "Business Plan",
  "Personal Financial Statement",
  "Proof of Insurance",
  "Voided Check",
  "Articles of Incorporation",
  "EIN Verification Letter",
  "Driver's License (front & back)",
  "Accounts Receivable Aging",
  "Accounts Payable Aging",
];

const LENDERS_INIT = [
  {id:"l1",name:"Channel Partners Capital",code:"CPC",taxRule:"include",lienholder:"Channel Partners Capital, LLC",address:"5005 LBJ Freeway Ste 1250, Dallas TX 75244"},
  {id:"l2",name:"Navitas Lease Finance",code:"NAV",taxRule:"exclude",lienholder:"Navitas Lease Finance Receivables, LLC",address:"125 TownPark Dr Ste 300, Kennesaw GA 30144"},
  {id:"l3",name:"Beacon Funding",code:"BCN",taxRule:"customer_choice",lienholder:"Beacon Funding Corporation",address:"500 N Dearborn St Ste 700, Chicago IL 60654"},
  {id:"l4",name:"Amur Equipment Finance",code:"AMR",taxRule:"include",lienholder:"Amur Equipment Finance, Inc.",address:"1055 Westlakes Dr Ste 300, Berwyn PA 19312"},
  {id:"l5",name:"Crossroads Equipment Lease",code:"CRE",taxRule:"exclude",lienholder:"Crossroads Equipment Lease & Finance, LLC",address:"7322 SW Freeway Ste 1400, Houston TX 77074"},
];

const AM = { name:"Brent Christiansen", title:"Senior Account Manager", phone:"(603) 459-9731", email:"Brent@AvantiEquipFi.com" };

const AVANTI_LOGO = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QCMRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAf//AACgAgAEAAAAAQAAA5KgAwAEAAAAAQAAAVMAAAAA/+0AOFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAAOEJJTQQlAAAAAAAQ1B2M2Y8AsgTpgAmY7PhCfv/iAihJQ0NfUFJPRklMRQABAQAAAhhhcHBsBAAAAG1udHJSR0IgWFlaIAfmAAEAAQAAAAAAAGFjc3BBUFBMAAAAAEFQUEwAAAAAAAAAAAAAAAAAAAAAAAD21gABAAAAANMtYXBwbAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACmRlc2MAAAD8AAAAMGNwcnQAAAEsAAAAUHd0cHQAAAF8AAAAFHJYWVoAAAGQAAAAFGdYWVoAAAGkAAAAFGJYWVoAAAG4AAAAFHJUUkMAAAHMAAAAIGNoYWQAAAHsAAAALGJUUkMAAAHMAAAAIGdUUkMAAAHMAAAAIG1sdWMAAAAAAAAAAQAAAAxlblVTAAAAFAAAABwARABpAHMAcABsAGEAeQAgAFAAM21sdWMAAAAAAAAAAQAAAAxlblVTAAAANAAAABwAQwBvAHAAeQByAGkAZwBoAHQAIABBAHAAcABsAGUAIABJAG4AYwAuACwAIAAyADAAMgAyWFlaIAAAAAAAAPbVAAEAAAAA0yxYWVogAAAAAAAAg98AAD2/////u1hZWiAAAAAAAABKvwAAsTcAAAq5WFlaIAAAAAAAACg4AAARCwAAyLlwYXJhAAAAAAADAAAAAmZmAADypwAADVkAABPQAAAKW3NmMzIAAAAAAAEMQgAABd7///MmAAAHkwAA/ZD///ui///9owAAA9wAAMBu/8AAEQgBUwOSAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/bAEMAAQEBAQEBAgEBAgMCAgIDBQMDAwMFBgUFBQUFBgcGBgYGBgYHBwcHBwcHBwgICAgICAoKCgoKCwsLCwsLCwsLC//bAEMBAgICAwMDBQMDBQwIBggMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDP/dAAQAOv/aAAwDAQACEQMRAD8A/rv2jGKIxj2NKBhc+9OAwwDdBXYcrQqdalpoAJ3d6kUZNS9ykKgyalpAoBzUmw/5/wD11IAgB609Qev6UxPvVLQA9I1HzU9Cc49KFUbcUowx3ZwRQAq9Qx7U9PvccUwD+N/wFPXPTpQBLUsfAqMAnpUoIGFFADqURnJpKcoyaAJQAOlLRSgZ4br7UALGM89qmUjHy0gGRgfrSKNvy+lADqeibzikjG/pU6oR045pSATbt+X0oH3gtKykdelKgywFNAS7ArfX9KlUAHr0pu0j5KkEfA4oAblfSpEIb5RzRRQAUU9UzS4Ab5qAEzj5FGeKE5GB1pFyCMU4c53dugoAkxnipIo8t1wQKrxHuc1YUAigdiTvnvUQGWqUDtUqxKg3npmpkGo2OM9SPwqWgH04oqREn5VHSg46UlABSxk55FIBgYpx4Y4oAeYx2P8An86fTUJxTqABSTlR0FKkjjGR0phJPC8VIsbYx/n+dA4ocJN3QU8LkndilXA7CnCNixPbpQNRGkADjkVIEx0ApoQ56YqXC0FEJjfPGMVJ5S4xn9P/AK9PooAj2MOQf8/nTFjBf5qnppXLBvSgpAyenGKTyx6/p/8AXp9FBIzyx6/p/wDXqPYo/iqeigCDYcc809Su7JqSm7OORQBEqup46VJ5Y9f0/wDr04DAxS0AQ7QOO9R7JCeDU7cHOOlAwOT/ABfpQX0Km1l9vpQmM81Y+RePvUxk6EDFBnyoh3EHIpfvNz/n+VLgqOnSmHpQQOZQ4+XiofLIqSigCvTCmTnP+fzqdk7j/P61HQBG33xTti0AcCnUAR7MDEfSgqccHmp0JAGFpuz+5978qrmArU3GfZganOQdv8qiJ56cVICNyMVA4b+PpVim+Wv+f/11UGBCOnHSinvHkcd/8+tMqhIrFDv46UbccnrVmoCu180DIuOu3Ham7duM1LJ8+MdKhY7c5oAYQSQO1RMMHFT0mzjgZoGiCiiigGtRr/dqNPvVP221EV5CCgRG52motuOWqw65GwVXfrQBGxyMjioKsVCwAPFADajZMD+lPxu4HaloArEZK44prgcgdql2Zz7UwnjIoAgpA4JwKO3FInqOtNbgPH3Pxpp6Glpg++aQFSQovykUjElcVM6Lu/z/AI1AoAbJoAhKkDJptSv0qKgCFlxz/n+dNqfAxioMY4oAKr1P24qN0ygNADKheP5uvb/PepqiILNycDFNbkyIvk9qPl9qf5a+v6f/AF6PLX1/T/69VzIk/9D+vAL2FS7OMN92mxxgj0/D/wCvUoAAwK6Ys5wqZeEIA/zikVMcmn05AICC3y9aevLCmLgdMKanA2nJ/SpAUYGYx/n/AD9aljUqKjUAt8oxVigAoooprcCRU7n/AD+tB5OF60JnoOlPVOeeAe9ICWNcDP5Uco3NOUEDBpCpGATQA+pUGCR6UR469xT6ACposr81MT73SpMDGKAFpQu7nvSU+MYoAlij2/MalxnDD8qanWnoeeBQAbfmz/n+dSiLODTNjbsZqZVwc0kgFDAnFLTSPSlRccHn/P40wFooopoeo5SRwKfv3HkVGCwPHSnpg805EpirjOAKeApznt0p8Y/hp4252nGay5mMYg5zUpjwePT/AD3pVAJ4p5T0/wA/rQ2A1FzhjUy4GPSmKOPpxT6QBRRRQAUAZ4FFTbQOnFADWXHK/dp+FoEZ3fL6UYbG5evTFAABt6U/adu7tTkjKt5frUmz+AUD5WIMYGBiloxjiigsKeh5xTRjPNPAQ8kcUFX0sSUAZ4FFFTZkhnHA6CkDA9KURHHy8HNATku3FUAUcdaeiBk5pqoMZIoASipgBjpSeWPX9P8A69AuZEVFT+Wv+f8A9dMA9MUDKycNikZiT0xU+3IOKjETYoKiCdKDknI6CnLGQcD/AD+tLjHFBIA56UAYGKQDb0paXKgICSTk0BZCevFL/H+NPAJ6YpjnsNGACGqt5bf5/wD11bKovJqKgyK9NZiOcVZwtRPGT06d/wDOaAGhQ3T0/wA96iCAj5TTgrKePyqRcDGaAK2wp8poqw4DdOKr0AAJHTinhiDTKfndgNwB6UANcDbu281WqycZwOlRMoAoAYATz6U0rjr0xTtwPK0mcc+lVEBowVqGlLE1MvQjiqAgqED5TmppOM1FH02mgCLnI7Ch1DDFOooAr4xxRUsihaioAjbn5B/n/P1qOrFVztH0oACQBk01iCpxRlcf0qPy2/z/AProACoxkHNRbd3GMVIRg02XJGD2oAgXl9hqNlyuMdDU7qMBh8pplAEHQ8UlFFVygMJDdeAv93vULnjpU7AkYAzUG0nGe1SBEfuimAj7vpVggHrUA2hyCKaQBTcAuKeV53DpURJLemKFuAshUHpVNwN4+XjFWmYc1ExO3IpyQFdlyMD/AD/KoSufwqyAT0pJQFYBfu45pWYFYjIx0qEqVqeo5O1IBgBPSmORg5708tgcdqidlPXbQBHTWGRTqY/SgCPDUYapsLRhaOQLI//R/r2Tj5O5p2McUwbSfm7dKev3/MH5GuuyOcnQ4AH92lA3dKRUPJ/z/OljP3hTAET1GalRMLg9KVPu06swHBV/5Z9qkBJ7UyMAZxUtABRRUiqMbjQAdDhePWpkGSfT0qNFH8PepwmF20ANER2j/P8AWpcY4oAwMU+MZagAUD73cVICD0pCvPHftTo4z2pqwEqAYGOTS5OPLanYxxRSAKkQfLk8UxRk4qfb+lAD+/PFO+83y8VFU8Y5B7dKAHKp5z2qY/d54NMJZTzSsoYhqBtgnSn0UirITk9BQIEyGw1O4DeopccZpAM0AKxCk46e9SomF4Hyn0/pTFTDCvnH9sD9rn4L/sJ/s9+Iv2lvjxetbaD4fgVvKiw01xO5Kw28CHaGkmZgMbhtA3nAVsKQH0TrWtaF4U0e68R+Kr2303TrFDJc3Vy6RQooGdztJtVUAPJyp9M1+GP7Sv8Awclf8Emv2b9Uk8N2vjG78fanCzJJD4TgNzErAdDcSFISBnA2uxyOpr+Db/gp1/wWe/a0/wCCnvjC5TxvqEnhr4fQSn+y/CWmuwtI16I1ww2G5m4BZ3+XPCqvQfkA7ImVj+52HbH0NQUoo/0Rbj/g8Z/YgXUjbx/Cfxt9m3Y80PZKcf7m/jHpur71/Zo/4OYf+CT/AO0VqcXh7VfFt78O9TuCqxxeLbb7PCSx2gfaYWeFR1JZ2UYA5ya/yuyV3YHTj+VEMvT8+fpj+VVyhbQ/3KtE1rQPE2j2mv8AhW8g1Kxv4fOtbm2YTRTIQcPC8ZCsvIxhsk8dq0RtLHbyOg/D8Bz7YFf5Pf8AwSF/4LRftC/8Ew/ifaWX2y78T/Ca/nX+3vC07kxiMsA09ju4gukHK7cJIMqw6Ff9Sv4K/Gf4YftGfCDw78dfgxqya14W8UWS3unXsWRujYEMrj+B0f5ZBt3IysrAYokiGj1PcwY/1qSP52BPApqDaAuMY44qXnjP6VJSHIqZOe1S9Bx0pgGBgVKiM/7scYoKiJsLn5OBTwjDgcgdKnxiPZ/KgHYvp6CgZFRRRQAuGow1SE44xSorH6UEMkH+rFIAScCpQvGDzSgAdKhMsYE9f8/qaUrt496Qbt/FHOM+hqx8rJPaijOeaOO33qTYgpd3G2kpCAetMBajZO4/z+tPyv8AdP50tACLnHNMxk9OKcMBab8xoATleKBv7VLRQKyIthx/n/GngDHIxTqQMD0NBPKxjRDoOKhdWBwDVlcY4paCudlDac7afnHGPw/yKs4Bf6VA6Nu9KC2yGipM4XGKbkZoJURhJAyRQ5IwSMD2p5z17dqaPl6UGY2VFzmOoRu7jFWKYwDcZwR1FAEVNKZ5701t+6nfxgUAQ0VMyhqhxjigApSuGpSAAMVGGPfikmBGU2/dptT9MqOlVvuNz0xx/nmrcewDXGFxTOT/AKungBV9DTBntVIBHyR83BFV6t9BtcdKgMTDrQAw4HSkoowT0p38gI9vyHNV8OOlWJM7eKib7pP4UgISpHWmOPlp5GCaUg/dNCaArs2OAKbUjpjnpSNt4xQBGSF5NIBgbs5p3G3nrRQBH2w38VQuQq7KlfrUZAPWgCN1AqJ2wcDoasOuV+lVH60CkO3hRhagkGRxUgbA2mgHaOetA0Vx6fdxxTad/H+NNJyxWq5gDmomUj6f5+tHmN6f5/KjK+lHKAzGePWm4HT0p1FK7Ah/T0qIjAJapWBBz60089asCvSEAjFPkUq3HQ9KjcAL8vzVGoEDcA4pnmMRgduKcSc9KjO5Rj1qwG4IODUXG7d29KlIBO6okQgn5elTEBN7Ub2o3S/3P0/+vRul/ufp/wDXp8yA/9L+vcABsjmnAFjgUgwOI/xqaMocEV2HOSAYOM4p42j+VRU6Ncn6UASqD/qx2py4f7vGKSnoAPu88f59KzAeowKdTEJc4p9O2gEkfI5H41JTEU7tnpT6QD1UMtS4xTE6U+gBQCTgVOkfTHbpUKfeqcEjpTSXUBozu56VMg4zUYBPSpwNvSkA4HjGKbUgTqWoHJGB+dO/kNCRjLVMAScClUIM06P0xSENwf6VaVCq7RUSx5YEdKs0AJuDdKWkAA6UtABRSgd26U75c8DtS5kAynp1plSKQCM/pTAuRp+73du+K/z0v+Dun9szXfHv7TXhX9iHw7csND8B2Mes6nAhG2TU79f3YYc8wW4UIp6GR+lf6BPjf4h+Cfg98O9d+K3xNu003w54bsZtU1G5bgR20CF3Y5z/AHCAByWOB2r/ABsv26f2mdX/AGz/ANr74iftQasskcnjTWZ761ikOTFbBgttG2eipAqqT7Y6UpFRXU+QTJj37VBvJyf71LKyjnH3qi3r/n/9VLlKTQ0y5bNSAqT6D0qvRVAaQkAH97HA/wA/5/x/uk/4M/P2pviff/8ACwf2PvEchm8HQrHrWjSSsR9lvpG2zwRdsTovmbem5M45bP8AChGpPTvxnt+H0xX9sv8AwRr+H2u/shfs9eFPi1DF5Gv6vfp4kkTGHMK/u4YmBPR4st/wOu/B4J17nn5jjY4eKfc/vbKNGTkfQDP5c+lOTcevasrwxr+keMPDun+LfD0vmWOp28d3bOMElJU3L7YHQ1s43Dpgd64KkOV2OunNNJokTLfJ6d6mGcc02MALxT6zNQHHSlJJ60lFBTYUqjJxSU9UOM9PagkeN2anGe2KroV3cirIC54oK2IyzA02pWBHPFRUWQ7onHQUYGMU1GJ61OqAjJoIGYHGPpTsN0pxAxz+FKmCOOKXKhc7ItrGjbg9KnoobIIsPRsb/P8A+upaKZoRbAnzHvTKkdWA/wBmhixAz0oFzIhCsEpeNu39KmXn5DxTAm7k0BdDaahBG1etPCHoO1Dx7ct+goDmQlFRsM4IpC57f5/SgY08HigdRSU1sggCgB5Qt8vSomjAGQasu+OnP+fpUTfN170FRGBgABUVPxxyOlMznn1oCI8/cFR4XOQMVJg7Vp3yEelBiV5OM4GaiqZdoziopE7KaAEqNk7j/P60o+RcmkB3E/5/woAjpp3NkYp0kYGPX0pnl46Y56UABYj5MVFtxzincHJb8KXcdwBOOPSnzMCs/wB6m1K4Ct0qKrHfoB5601hkU6igRCEJbbQCf4fSlZSH3D0qJhjISgBedpHFV9uBh+lTKuOTzUR560ANwN+ccVF34qVm21DQBG6k4YnOaTbltp7U9/u1DQAEZGKKKjL9sf5/KgBhB6mmY+bP+f506hgcDBp6gJgZzVeVAD8vTFOy3TuP5VCz5GBxSAZkDnrRnPNFFAET9aZT23HgYplAFejzAOCf0opvmY4FOLAP9rOPpSJnHNBOAvp6UvmL/n/9VPQBsnr2qAENwOKmY/LgdKjAwKkBjDC4qMcdKdIQflU1GCB8tACOvcVFUzDI2DvUOMcVogComB6mpajc9qjUCL5/71Hz/wB6lopAf//T/r3DDdtUdOtWk+U4btUCrnt8venx8c11XOcfU/yg+3TioAoLZqcDAxUgO6LipIxhaiqf+EH0FAAAB0pQy79x+lNYkMMDg1IioxJPamtwJqcuAPVqbT49qjrQtxWRLRTfMX/P/wCqmFznjpT0GTKeeePep6gRckAmpwMYxUhckiXB57c1OOQaiTO35vwqVcnpgVSAaCR0p6E9KFj9f8/rT1GBih6jQ5R1zxUidM0RgYpVBPydKkL3J0Uge1PpfQelOyvpQIZT0+90plSRsAtADQQrVMGB6UjhTz0qIDGDnIqbX2Adjv71JtUnK8UFcjj1P8qdJ9mso3vL+VLaCJWkllbAVI1BZmYkYwq5diem0DoaoD+Rr/g7Q/bom+En7NHhv9iLwNfeXrPxOlOp64Izh10mzcCOM46LcXCjIPURHtX+eVIWZQw6N/n8q/S//grz+2reft+ft9ePPj5ayvLoT3h03w/Cx+VdLsN0NuFyON6h5T/tOwr81CpBwDuXpn1FBa2M6VWI2t1HpVNo8ruFaUsZHSq5Ugc0dbEFIrlRimlNoq4Qu4444piKWO096pR7F3R9c/sL/s9Xn7S/7Sfhz4YFf9BuLkT37gfctYRvlJ9AVG0e5r+5W6istPgS006NYLaBFhhjUYVY412Kox0XaOlfhH/wQ5+BkPhrwJ4i+P2rRBbrVpP7I09mH/LFRvnYemTsTI9DX7ha3qARTzyemK+3yfDKFHme5+c8RY72lfkjsj94/wDglv8AF9PHPwW1L4V6pMXv/B91+5Xqxs7jLpgH+BH3p7AY71+mJDZ9CDjFfynfsQ/tAx/AT9p3RdX1mYRaNr5/sXUSzYVUmKmN29o5MN6Yr+rQxGPKnnaevTOO/wBK+czfCulU0PqshxftKHK90PIwcUlJkU4AnpXj2SPdHL0NIvtzSAMflFTRhfWpAFQ7sHFLjHFFOwCMfxCgqIqdaacZ4p5Rjz/n+dSpHheaCSAIxp6AAnP0qYEYKd6aBnigzEoqUgBcU1dveg0AJkZzT1UKKVcY4pwQk/1oASiiiswCmKu2rAZNuKjJ54qrMBrox5YDFM2uMYPFOJ44GaUkDrVABAHXnFIp+XNKSAKgpcqFzIeX4wtISM/LTaQIeimmQLnPNMCMOKUIvQ/jSrwBmgBvlj1/T/69REdqsVE3J2igBlFOZcD2qMEZ2jtQaDqj+bPAH1pxYLxTM4OB92gAV8UymjaevpTqBSDj6VDgFvMHT0qaon2/d7UEDZYwTx0qPdtPIp/4/SoCTu8ugBZD39qry5ABHapqay/Lz81AEQBIB9alHIFQnoAvbpTA2HoAZKqlzVcMQMVMeu6q2QOTVcwDsnGKVckeuB2qPzF/z/8Aqpvmdsfr/wDWokBOSE6854qFQFbbQHHf/P6VHLIoFKGwC79q9KbwTuNN3rTHYEcf5/SrAYSM5NM+bAK0jg9ajprYCTzM8Ef5/Kq7HBz04p78EentVeVsjb/nFIA8wetM8z/aH5VG7DcMDjpTH6ZoAm8zv2qGV9x4qMk9B0pKAHl1VBjrTGbueKjOzOc0SEYoAazDBAFNSTjHeoy/p/n9KYOoquUCQkr82AajLEmp6hf71K+oDaaeeh/Cml+eKhaTPB/OkBM4wAKq5bNSb1qGgCwNwYAYGagJJYj0ppb5sHrTHYp0FVECUgDkdagHDc08HLGoqqyAlYsGwKjYjOBTkbJYVCeOvWo5WA4nAzUJb06U4vkYx/n8qiI+XFOIDsY49KKKKVmB/9T+vkDPSp6YnSpAOeOa6DnAAnpUiZxSJuwXHT3qQY7UAFTjoKjT73SpaADnv0oye1KiZZT2pKtASZ+SnhgTgVBuDDB4xUgZR2/z+tMCSmgknGKaZPQf5/KlD+v+f0qYgWY8ryas49OKrIflBFXImBbp/n9KVmBMOIvwqf5VqMHpxxSMMHFCsA7ILcnipypbgYqsoJOPSrAwTx8tHUCReFFPWM7j+lRF+yj/AD+VWV9e4pAPoo6jniok4bFAEoVmPy1IAQ9INw4xmkD4HyjH+fpQApJVunBFNU4HNLh8c0mPm2HpQBOvAH8q/DX/AIOI/wBtOD9jf/gmt4q0/wAPXhtfFnxLB8JaOY2xIqXK7r2ZcfN+7tt4z0DMK/cyFNxRUG5ixX27BQOPfBPYiv8AMu/4Ofv22j+0/wD8FDrv4O+Frzz/AAr8HIf7BhCnMb6gx36jNwMfK+yE47RnHWgqK1P5uDsPyYG084HIx2/kPyqcAmqcSFXI9OM1cUBV3A/5/OqiF7aEEij9Kzyf3gz0FXWIwWI6istzkAe1PlRRKEXH411fgjwtqPjXxXY+E9FjM13eXEUEKKMks7BVXHfJP6YrkFcDIb/P6V+tv/BH74Jt8Q/2jU+IurRb7DwdAb0Ej5ftByIF544O5/8AgIrrwFH2lVLoceNrexpSnsf0z/Bb4YaV8Avg54d+EmkbRHoVksMpTHzS43TufXe54rb1fVlUEdCefpTtX1RcsM4bp7cV5brOrDYzbq/Q4pQikfkM5OpUcmYPijUw8U6xtgAKRtOGyGJOPTHB+tf17fsAftGQftL/ALKHhzx1dTrNrWmRto2rDPIurVdu498Spsf6N7V/Ft4n1n7y55HT+lfp9/wRH/ajT4eftMX/AOz7r9wU034hQf6CpwEXUrNWeNRngeZDvU+rKo9K8HOoqpTTW6Pq8greyq+R/W2yMGK4+7xSxsFbmkXO3kbfYU9VYHpXw7iffcyLYQYJpu0L0oHQU8jJ/wAKYxtOXqOPapFAIxHShQvFAC0IwLDHNKWJ60qRjJP+f50uVAA+mOalwB0pcY4pO3FMTYtNCD/P/wCunVIqgrQMjwBwKkXcoz/DUZIXquaB83SlyolSY7kjsKbTyo+6fwpSNqHHSjlRV/Ii2qaMDGKnVcD/AD/iaUADpTArBQKQ7duw9ferflx81CI4+cdRQTIq02Q5FWPKPFRyR/Lx/n9aCiIbsULx1xmmiPj/AD/jTCuDnpQUiRioyQOajDMx4OMU45wM9KbQSSLvx2pDIe3H+fpQnWh+tBmSADGBVbIxg8HtTqY8W4+ZxgUGg3jbjvmlBAbJ6e1MJJ60YagqIOPl/d4FQ7uMVJ1O0elQNx05oJHNKQOP8/pUeQycdf8AP+elRkN9409OAfSgzCSTCiJRSN83PT0pnVvrQRzgUARCQ55H+fypA7Z6/wCfypNp3EU2gBkzSj5jiq6MTwatY3DFV8YzQAEZFVyMipx8q81DQBByOKkAyORTGXHP+f50isCdhoHdiUbNy5ozngdqbvx8gqoiGAKR6U3J6UOcR7PSmtnho8YwABVANkOcVC+Adw6GpiMg9z6Dv9PSoJYrlMYjO0HPI/L0496AIWY7j7VBI+eD1qSXzEHmEZ7cVVfrQA12cYPGD0xQzNnBxiomj9P8/rTB1zj2pcyAmJA61BTgAT83am1PMwB3dcZpMueOKa/TNIq4G+rAceOgqGpiuAVFQH5BzT50A4MQajd2OP8Aap9Nf7tICFuhqMrtQevXipcHGajOV4VaAIWbPzH8qrs0hOF4qd+PeoHwy8cUAAzjnrQSQc9qB0FNfpQD3sLk9uKUkDApaT+HGKAFHHSonYklvwqWom24IP5VSegDKKjDgDGKcn3aa2Ak3f7J/L/69G7/AGT+X/16bRTA/9X+vyP72O1SLgNhKao2AlunanV1NWOcmTcfk707OefWq6KO/XtU+cEdhUhoyWMgipUkGMf5/lVYA9u1JzvHpQBZooyOlMc4IoAYzKecY5pxf0/z+lNQ5J9B2ptVECSPvU0aspJPeok6VKvzkCk9WFi1Ge3pVuPKocCqgHzfKauxtuJHarAsjP3RTQf3nPYVCJCOgp6gZ92qOVgTocvmrCx8c/5/WolUKc9f8/Wn/M9IB8YXPzcYqxyvIxUKIN3WpHwML6UAS0gG44Hak8xf8/8A6qVcD7tADlJOcfl0pKUMFHvTQCBg0APfBUU8+30qPyz6USIUCntjJAoA+P8A/goP+2F4a/YG/Yv8d/tT+Iyn2jw7p7ppNuxA8/UZx5dnEBxwZGDNg52hzjiv8drxNrOt+MvEWoeL/FFw95qep3Ul3dzyfekmmcu7t/vOxP41/Yp/wdu/twXvi/4r+Cv2DPCN1/xL/CMQ8ReIEQ/K99dKVtY22k/6iDcwBH3n7YFfxvqGQ8cr0/wpNlxRmNAF5Jxg44ppUjJHFaDRxnr17Cq7xrjG2qsyDMlTHT/P61QlQZ5H4VtPCAwHbFV2hz06indgZaQM22PHzNj2yOc/y61/W/8A8Ez/AIMJ8Ev2WNN1K8iEep+Kz/a9y207ljb5IFYf3Anzn/er+bH9l74P3Xxy+O/hv4bRjdBe3Sm5cc7LeP8AeTtgfwhFP6+1f2AajqdnZ2CWWnoIreKNY4Yx0VIxsRRx0AHFfT5JR5Vzs+Y4kxPuqimXtZ1pcE7vujArxnxBr4VCI25qp4g8RgKcPXhniPxUy7sEda9upVPkqGFDxJ4kVN3mPlu1eGp8XPEnwz8a6X8RvB8/2fV9AvIdSsXXqssDB1z/ALJKH652ng1znjLxesIf5/wr47+IXxFSz3PvGOP/AEIH/CvHxGIWqZ9FgsLZpn+sJ+zh8cPC/wC078AvB37QPgh1Nh4x0y31KPB3KrSDE0Z9PLkDRt3BFe1fIRn271/If/waZftux/Fv4JePv2LPE17u1bwHfHX9FjP3jpt8dk6rn+GG4KsQOgkAHWv68AgK5Cjb+lfJT3PtIPRC0qnBzTF4XmplUBvp0qChyhgfanUL/s0sYz07UASqu0e9OoUhjgUUuVC5kFIAFFSIh/CmnAbimC2Gb1pqqR3/AM/rU6xZHAFSAYFAxip68f5+tPChaWlHHTmgBKKKRcY4oAWimb+cY/z+VCjv+lAD6XOOgFJTct6UANkPzZFM+8eOf0o3qGywphk5x2oHbqARQMVF5QOKnGA1NON/HTFAiq6gDIqPqMVdcEfSoAgBzQKRH/B+NKx/5Z96Qg54GKawbqOooIHcbD69qhTIIz6VKpwc0lAFZiN/tipAGIFJLGC3t/n3puAOBQA18gVGu7+GpJCMEfSnYbPBGPpQBXqJRzjsKsPkDHX3qABlOe1BumhskWTupOV/d/5/lU9Qv96gwI2OFyDz0/CoOjY6irGOdtVVIDHHeg1kiYIM8dKryrt+ZOecVabhcVFIMqFFC8zIrjaPdaHjKrisjxN4g0vwX4S1XxprxlNno9lNfzrAoZvKt0d32g8M21cKOPm4ziv5yJP+Dsv/AIJOuQQvjKNcDg6YpA/8jGjbYaP6QJ0lDY/lVRQ/Br+cBv8Ag6//AOCT55WXxf8AhpY/+O19Gfsgf8HBn7Af7cH7SHhz9mD4HJ4ofxH4m877M19p8cFuPs8LzuzuZSyrsQ/dQ8r707sGft5jBPGKikYcU8HcvIyfb/8AUP5CmMuORTiIbuJOTUyQxiF7iUBURd25iQqkKwJLYwFH3mbt9AKgr88/+CunjnxV8MP+CXnx48ceAS8GrWnhC6jinjJVoxOFgkdSuCNsbnkdzntVrcD+TX/grb/wc5/FjxB8QNT+A/8AwTj1BfC/hnTJ5LK58XrGr3l9KjbWazEislvb5UqrYLuMMNgNfgJ4V/4LIf8ABUXwL4r/AOEv0X46eL3vFJbbe3YuITjPDwzeZGynHXaB6V+YzFAeMMqrt/Dt+FVXwvTv/SpaLTR/pM/8ENP+C+Q/4KF6+n7LP7T1rZ6N8VVt5JtLvrIeVaaukKZkRYm/1VzGitIUQlXCkrtxtr+mO4UiY5IOeflGBj2r/Gj/AGJvix4m+CH7X3wv+LHg6ZotT0LxPYXUXl4JO2dAVx6OjFCD1ycV/sz6hEhu5PLG1d5wPQZ6UoikZvl7c7OhFRhAo55q8vQ1FGmOBVWRJCY93zCkMYB5FXVGOuKjosgKbRbuBURiKrsz3rRqs8eOmPyoAhZNnvUD/eq2E+XBqJk6Z/z+tOzAr0gx93HDVYwtIQMdKQFXyyOAePWmOGA2jp61PJ8qDFNzklaAKRUjr/n9ahYBc+mBVsqDUDrn/D/OKAIQCelNdcEZ6VZAAGBUbxsWzngUAMCnt2pwUFSOntQmTyOlOU87jyKAIxjr/d7f5/z/AFjk6YzzTnAMmPamt1FVECo/3qVOtSzrg1Eg5zVASZX0NGV9DS0UAf/W/r+iKj5u9OpB0FOAxzjiunc5yRVUHAp21See3So1BP0p6kdDxnpQxRHH/Z4ppdQcf5/lTqiZs8UhkyEbOlKQxywxx2qJDxih1G4PtpqwDkZuuMVJHz1FIpwaVflbBpxFJaImUDIFThecdKjQZ4xVjcBICOOKIgthwUg/LznrU6DimbGGMcVNVDAOC2Bz2+lSIuxhnqtR1LGgzn1qXIC3QOOlGMcUUtx36FhO1POCcjg1FECP/rVJuUe+aQajvL/z/k0sZwRsHynrmo8sOKlDDbSkIMAcYzzxUm47gaZz+NL5nt3/AM9qaAsVx3xW+Jng34HfCfxJ8a/iRN9k8P8AhTTZ9Wv5emIbVS7AZ6l9oVR3Y4HWuyQAYFfyi/8AB2T+2r/wqP8AZD8O/sceFLxo9a+Kl59s1RYmAI0mwIOw45xNc7F57Ie1AH8GX7Un7QvjD9rb9pPxv+0n49fOpeNNVn1F0OSUSVsRRrkH5IolSMV4qsUa8flj0qkjYIkXnPIx/SrSbTwO9FrlKQ4oOg7f59qi2NU6LtGP7tNJA61oSUpI88iqzjaMDt/nj6VoO4xlOn+fbpXVfDb4deLPi58RtB+FngWBrvWvEmpW+lWMKgEtPcuqR7QB93LfMOnrxSkB/Qn/AMEk/wBhDx9pH7Jnib/gozq9qRpc+rL4Y0xSMZgJ/wBLuV44XzFSEHIBO70FfX2veI0CsC/Pbt/Lj8q/tY+GH7Dfw1+FP7BOj/sE6FDGukad4bTQDIByboJue446s9zukz3zjtX8I3xLTW/A3iXVfBPiiJoNS0m6lsrlCCu2WF/LcEHlVBGfpX0eVYxcjgz5jNsG3U5zI8TeJtgb5q+cvFvi9LeN/Mf5j0qbxh4sCI+16+NfiJ8QTCHjZskA1WJxSjoYYTA3dyP4gfENIt+9xwa+GPHnjebVZWSFuDxjNWfGXi+51OdkibJzXkUmTkuOWrwK1fmR9JRw6ifqb/wRK/bSP7DH/BSn4d/GXXZ/J8OX93/wj2vZJCix1HEDswUdIXKS8/3a/wBeOfaGKq3mDqG4wR2PHHPtX+GC6gLn7vCkn0GSMj0ycAV/rhf8EKf2zZ/24/8Agmh4B+IuvTfafE/hmJvCmv7xnN3pyqqO/cGWBo3J9zjpXI4naj9d9mOMc+1TgcCgKqcZzjjJ4NOyD0rLlY1qLt2jjigHb0qRQTx1Wl2LVgOU4wwopCT2FCbm+ooFyolXBXZTUiyOuOaciE5m7VIOnHSgUQwB0oopyrk/5/xFBQgBJwKkICpihUwacisy89+h+lAEZAMeDUYAHSrCoOg6elO8s+lLmRKdiuiDsf0p+FH3R81WVVh7fSkYN3NMfMiuygLSBMgGpGGRihRgYoDmRVkj4AxkVWeMhuK0nOOvpVcopOelLmQc7KoBVv8AI/xpCcoDVmSDcu+PiqMqMnHahMG9CSR8Agf5/SoSemP0pm4n5aRVCnIpkE3zH2prffFThVLc/eFRHAbmgBGRQMimgLt5HIqWmsCRxQBC5xyKrsQU+Xk1a+zynnNV5Y1BoN00QtwvPU08nAzUIK5ODkfyqRUOz/61BgGNy4WothT5TV1VUfdqGWJmJPoO1BcSConaNev6VPjaARVR87sYFBd1aw0tn5wMDpUW3aDip+oyeKeqE0EcqID9wUm0/wDLP1qRkOMHkiogpPHXNNbkHj37Skhg/Zw+IUrf8s/C+qH8rSWv8SoRhVz9OB9a/wBsz9prMv7NfxHiAyf+EV1RQB3zZyY/wr/E03lF6cg01uBVfIGB6f1r92/+DahxH/wWX+EfHVdVX89Oua/CVzlua/c//g2ukEf/AAWY+D+e7amo/HTbgVVkB/qtQ5xx6UwjBxUkSGlKg59ahbgVSvIwK84+N/wd8OftAfBTxb8EPGg/4lHi3R7jSLor95VuEZQyrtwdhIf8COlepJG23lasrHgfrx2PStEwP8ZH9t/9i34zfsBftEeIf2b/AI6abLZajo0x+y3O0iK+tTnyLm3dvleKRcH5clWypwykL8ZM7E88H9K/2if2sv2MP2af20vAZ+Hf7TXgyw8W6ZCCbc3a7Jrctg7redAskJPGcOFJAyDX4y+H/wDg11/4JUeHvFI12fwrr2owq25bG+1SQwcc7cRhZD+L4xRZl80ex/Hr/wAEBv8Agm549/bf/bU8LfETVdImHwz+HOow634g1KVSIXa2cSQWUbYw8k0qoHVQSiEs20Yz/qXs8lw3mS/eZiT0/px+XFeU/Bn4M/DT4AeAbL4W/Bnw/p/hfQNLBW1sNNhEMScHLGP1P8crE8c9a9SjUqgCDao4A9Pap5US3cXAK4FQ45GOKutGuQB8v+fwqF49vGM5piIzHgZxmmVOBgYphGNtADCjFc9v8+9VZMKT5fSrb8EqOlQyoAo549qAI6ZIBingdhSFJAOTQBBRRRQBFIowAe1Q/Ju96tSLlc1BQBA/yH1/z+NR7BjH9P8A69WJdvG2oqAIkj9e1IVwcCn8lvao1OCMUARbSrYHy5okGMCnMAZDUbDBoAicnnPHpTh0FI3+sH0p1NMCGVckH/P9KQjBNSHng/Lnp+FRVXMgI8t6UZb0qSijmQH/1/7AMR/5FSIMNz8wpoc4xTgVGdnDcV0qxzjwAOlKP9ZuK54pXVjlm+X2FNCluhwKLaALUPlt/n/9dTVXYDpSFZEijBFGW+VT933/APrUwMVGAKRMbhsFAyfO1jt+YVLGxyAefrUQAHSpiNq4FVECdGAbirCj5jVONfm+TrVyPvREC3EmWO7nilpIcb/m68UDGOKe3ugLVlBtwR0qtVkfkKljt1J6B/tfpUcbDtinpw2e1IRPHtUZSmr8zZNKg6jFPoAKUdRSU5V3GgCRlznApU5ApR0pwHOT26/0oAsqm9thZY8EByRhVX1J6ABTlj2/Cv8AJj/4LV/toyft2/8ABRTxv8UtDnNx4b0e4GgeHF7fYdPJjSReMDz5BJI3oGx0r/QV/wCC6v7ZL/sTf8E2vG3jXQ7hrXxJ4vQeFNFZDhhNeqVlkXkEMkAdgR0Ir/KKmaJyPRmyO+D65PrQBDGYyuPTp9KnDhjlO1V2bB44+lOjdR0q0BaEnPtTWbdx2qAyIBhaj80fpTHfQSWUKOPpX9Pn/BqN+xzN8df29L39pnxNZed4f+EFibuB3XKHVr0NBZr/AHSUj8x8dVYKeK/l8dkYGLGMgFT1PfOBxnJGAPwr/Wk/4IU/sKxfsG/8E6PBHgbWLQQeLfFsI8VeIztw/wBpvYwY4Wyv3YINkZH8OGI5qGylsfsW8gb93yQOMnsMH075FfxTf8F/PgWfg1+1JB8YNHttuk/Eaz+2kRgBRe2wWO4XPTLjY+PrX9qMuFYbeg4H4V+NP/BeP9mK/wD2kP8Agnb4m1bwvbPceJfh83/CT6ckYJZ4YF23iLjGQYcue/yjFXQq+zleJjWoqasf53/xA+IUVpaFPM3cda+IvF/iq41GVo0cnf6H0rH8TeNZ9bumeJ8o3Q9M/hXHtIex/GtK1Z1GZUKPIilLyCTzWdIvy4HFabrgHdWfP2rBm9kZ4Tn5eGHSv7Bf+DQv9syP4bftQ+Mv2JPFV0I9O+JViuqaOjFVUajp6negz/z0tmbI7+Xx1r+P1xzmvZf2cvjp41/Zj+Png/8AaH+G7mPXfBuqQ6xaHopaCRcoT3V0DIw7biOlFtCkf7ZPB2hemMk1KgwoFeXfAD40+CP2mfgV4Q/aD+G8wuNE8a6VBq1oykZCzIGZGA6bGyjd1YV6uygcr0rIRNbrI0ioMDcdq+hJBxnjgA/meOlfk/4x/wCC5P8AwSb+H/jLU/h343+NWkaVrGi3s1hf2lxDcB4poWMckbERYXaw27h6ZFfq6CSmMY4HHsMn8M1/l2/8HTf7Fh/Zq/4KR3nxn8PWvleHPi/af2/EwBCpfR/ur1OFAB3hZOOfmoNY2P7tk/4Lv/8ABHOZP3f7QPhnj/r4X/2lVO//AOC93/BHHTImuJvj74cYEciBLqRsD0CwnPbpg/Uc1/j/ALRCORsevGaCRgr2AAb8TQHLqf7qnhHxb4c+IXgfSPiR4JvItT0XW7SHUNPu4DmOaCdd0cinrsZCvHVeoxXQNkMc5b69f04r8DP+DaX9p6P9pL/gkh4E0zUrnz9X+HE8/hO9TcSwS2bzLbd3CmB0B9h7V++LkEkjpQKwlT5bOB0qCrKBsZz96gBUVjzXO/EDxv4K+FHw/wBY+J3xF1KLRtA8P2cuo6lez8LDbwqzPKT/AHFUZIwTkYFdRHHxz0zX83f/AAdS/tUy/s/f8EstX+GekS+TqnxW1a38NxMpAItU/wBJuznHQonlkejGgLXPutP+C7H/AAR4eESxftAeF1BGSC8uf/RYrMvf+C9H/BHWzjLv+0D4ZY4Jwhnft6LCa/yAXkR+qjHbioim09B09KOQUT/Yh+Ff/Bbr/glf8cPijofwX+E/xi0zXPEviW8Sw06xtLa8ZpZn4RFJgCgE4JZiAO7AZFfqdIu7L5yD6V/mi/8ABoh+yo3xa/4KD61+0xrVr52k/CXQpZYJGX5f7R1ENbW6g9Nywm4cY5GPpX+mKIWTCdccZIpJDZniM4+U/wCfzqY27bx8pweirnJOD69Fx6CvB/2of2qfgR+xl8FtZ/aE/aM1yDw94Z0NAZpZQS8rnISGCMfNLLIcKqJznngc1/m5f8FRP+Dmz9sH9s+81L4Z/s1XVz8J/hxK7wotm+zVb2IZwbq6jP7r3ihIGDyzdacULlR/oT/tIf8ABSH9gn9kSeW0/aJ+LXhrw1exAh7B7pZrkY9LeEPMBgj+HOa/Ej4rf8Hb/wDwSz8B3ktj4AsfF/jkxHb5thYrbQn/AHWupI3/ADQfjX+Y1eaheajezahfTSXE8jFpJZWLOxPUljySagE245Pf1p8iByP9FGb/AIPPv2TI2MMPwR8XvERwxvLMEj6DIGPrXuvw3/4O+P8AgmT4uKQ/ETw1428IMeS72sF2igAd4ZdxGfRelf5nqFTkEDNRsQPmx78U+UnmZ/sl/s2/8Fbf+Cav7XcsOn/An4w+H73Ubn5Y9O1CT7Bdk4X5RBdLExwWx8pPJ46V+jotQqAp8uRuXIDAg9COen0Jr/CaVpFJk5zwVYDkd/wx6iv3P/4J0/8ABwF+3/8A8E+dRstBtPED/ELwAhCyeF/EkzzQhAelpcndNavhdqEbo+fmQkcKzKR/rK7+zjDe/WpBF5o3V+d//BOb/gpP+zl/wVD+Bi/GD9n++eG/sysGuaHeFRe6bcMuAkqrkNE5yYplG1wpHysGVf0cjRo12Hnb3H/1qQzJdc5xXhX7Qv7UHwC/ZH+GT/GX9pXxLB4S8LxXMVlJqN0GaNZpsiJcIhcbtpOeny19CNADzX82f/B1/pn/ABp5125HGzxTo3T08yQfzNAon2rF/wAF5P8Agj3Mv7v4++Gwvo3nj/2lWfqH/BeP/gj3aR+a3x78ONjsn2hj+AWE1/kLHO856VC8jKePumq5Qb6H+3X+zh+0V8FP2s/hRZ/G39njXofEnhXU5ZYbTULZWjV2gZkkAWRFYDeNu4rnj5eOa9xlxGWXJY52qgwMjB5PBIAIx6nH3j0r8D/+DXzUbK8/4IyfD66vGCpY6jrEbu5AChbx2yx4wgB+Yk4VRzwK/ms/4Lof8HGHjz9oPxvq/wCyZ+wTrs+hfDyxkez1LxLYM0V1rDrgOsDqN8FkhDhduGmHzMVXaCuXUlI/r3/bB/4LRf8ABN39h6WbR/jV8SbCbXLdir6NogbUbwMB91khYrH6YdlI9a/FX4g/8HjP7F2iXzWvwz+FHjDxBCjbfOu5bSzDem0AynGfYcV/nay3T3E73DMWeQkszEliT1yTzmoHbqcYo5WOJ/oUeD/+Dyf9li+vEtviD8FvFmlQ9Hksbu0uSAc8lGERIHsa/Xr9lj/gv7/wSq/azvbfw94Z+JUHhLW7kqkWmeLIzpshZgDtWZi1uw5wPnBJ6ZFf5LBKnHoKgcuSFXoO3/1umKLMo/3PUksrm1jurKQSxTruhfcHRlK5BVxgMmOdwJ9uK0NobI9OF98V/k9f8EoP+C6n7VP/AATV8a6f4Z1a/ufG3wluJVGpeFL+VnWOLPzSac7bjbTLgEKp8thwy4IZf9SX9nj4+/Cv9qf4I+G/2gPghqya34Y8U2gvLG7TAYAD50lXGIpYXykicnKkEdKmyF1PWXgA4r83v2l/+CtH/BO79jv4qXHwQ/aN+Jtn4V8V21tDdyWE8E8hEVwu6Nt0cbJ8yjOM5GAO5r9NZcBjj3x271/l+f8AB2BG0H/BXnV2/wCevhTRyPwidf6VVmEUup/Yr8bf+C7/APwSQ1/4IeMNJ8PfGvR7y+v9Bv7a2txFdKXllt5EjQfueNzkKM49Sa/ykQrHJbhielXA5MfP+c1AG5xiqSIK8qfMMc1+tv8AwQv+Ofwj/Zo/4Kk/Cj41fHTWrfw34U0i7vBfaldBzHEJbG4hUtsViFZ3VcheCfavybIB60qhd2Cf8f8A9VEogf61kv8AwXw/4I9Wqbv+F66JJheiRXR/lAKx5f8Ag4J/4I5wFnn+NumhdnyhLS9YkkE5+W39gAAQcj0Nf5NROPmPemO3yKD7AfnU26l2R/uPaBrml+LPD1j4n0GUT2Op20V5bS7du6KVQyttIBBKkHGBitCeWCwgk1C+dUt4QzMdpwFUMzFh32r83B5HHHSvJf2fAsfwA8CQr/D4c03H/gJDXeeKjt0HVDjH+hzgn28t8flVkpK5+WUn/BeX/gkAx2j46aDGw4wyXClfUYMXH5VmXX/Bd/8A4JBRqc/HTQXyP4UuW/RYa/yZPEqtb6/fRf3bmVeOnDsKwHcjOOaF5jkf67Hwv/4LSf8ABMD45fEvRPg18Lvi3pmteJPEt0lhp1lFb3eZppThY1LQqi5Pdjz0J7V+nrfeJT8f/rV/kZf8ES/Mf/grN+z8h/6HKywPxI/oK/10T0P1pJkjKiPznbuxt6CpBnPtULRqZelMBKl2A4+nSoqeFYYYUAIYzj/P+NQMoCjIq2VLKB3qJ12rzTUeoFaq8pO01YRCSSDmoXj4OD/n86QFWildWX7vNN2nC0AL0Ge1VgBjAqycd6qEDdkYoAjfKNwMio1OVwOKkyQfSoX3bv8AZoAdyeDxUQ9vpTn4UA5OenpTcY4oARc45paYFIPPSn0ARMq55P5UyiigBCGPXoKgxjipH5IFR1dgJdo9KNq+n+fzqKinZAf/0P7AKQOCcClojGQ1dBzky8d81KnWooxkVKvQ0AMqMoo5NSUjDIxQBADtG2hCMBOBinBBk+wqOPJfkdqBLYup96nMoxmmRgdugp+AWOafUZPEAv1qwmBzn5aqxoORVoDEdN7gOTIFSLIAdpqFCOlR1IFnzCx9Oasls1TT7tWQwJwKdmHQsAAdKkV8VWDnfz6f57VIpyKQFxGIbJ5U0gb+AGolPY/5/T+tPAA6UATJgHrUqfeqJVGM9TUi46j8qAJF6mrKgBQNpK4GR3JJwP8AgI6fhUKeqivij/gpL+17pn7Bf7D/AMQP2pL8Kbzw7pxj0iE4Hm6jcnybVPpvcSNjnap7UDt1P4Yv+Dpb/goQ/wC0p+2Jbfsk+AbtZ/B/wf329wUJKXGtTqPtRJXg/Z1CwJt4B355Ir+XRZMqAP8A69O8R+I9a8Xa7qHi3xNdPe6lqlxJd3dxKcvLNKxZ5GPqzkmqCPuc0CLLSYBz2quJH+8TxUgXcv0qs47L8uKALYcAYNIxYJ64/l2rP+ZDU8chb/PSgD9bv+CIv7HkX7cn/BSL4d/CPXbT7V4d0u7/AOEi19cfL9g03ErxlRztlk2R5H94+9f65ksqvIHCqvzcBRgD6e3pX8eP/BpL+w6fhn+zf4n/AG2fGVmYtW+Id1/ZWh7xyumWTEyOMjpPc8ehVB2xX9gCyDdxzQNljy19f8/nVW60+x1C1kstQhFzbTqyTROPlMZG1lf5fuvkrV3GOnFLuIOe/wDkUCP8hb/grh+xXrH7A/7fPj34CyQFdHW9Or+HpCMLJpt8TLB227Y9xjbHRkxX5qqwUYBPHHIwfyr/AEFP+Dur9jFPiH+zF4P/AG2vDFj5mpfDu+Gja48Y+Y6dqLkQs5UfdhuQoGTx5h6ZFf56gn7Zz9P/AKwxRFlNWNksxTNVpOhqGGXeMVI/SnuK3QruCchaICeQWwMjIHTpTJgSmQaiRgMDpirQj/RC/wCDQ39tk/Ez9mvxh+xB4tu9+qfDe6OtaKrnOdMvjiVAOuyG4Ofl6Bx6V/YNIPnKgY21/j+/8Ebf25bj/gn3/wAFDvAHx5v7gxeGpboaJ4kXJCf2dfERSMcdfJJSYehQDvX+wKggvLSO8sZUnikXfG6EFWRlBVlI4IIwQRxWMi4jAQo4+lfzF/8AB1v+yg/x7/4Jrt8afD1p5us/CHWItZLovP2C6H2a6GcZ2qfLkb/c4r+np4hHx2rzD4yfCfwv8efhF4n+CPjSIS6T4u0u50i6V8Y8q5jaNmHbCnDZ9VxSW5cT/DnuI1B2jjHT/PFZrRnfkV7f8fvgx4t/Zz+OXi74D+O4/J1jwbq9xo9yGGMvbuUVtvQKwG70IxXjMcZP8qaQmf2q/wDBmf8AtOSeHPjx8U/2QNUudsHirR4fEmmwn7v2iwYRz4Hq8Mq5HcL6Cv8AQaZcHjt/Kv8AHQ/4I3ftSRfsaf8ABS/4RfHPUrj7PpFrrsem6s2cKtlqANpOz4H3UWXf9V9q/wBjy5j2HnkL345wM9uMfpUiKqAjjFTqmP8A9VIqMEAbqKloAki6c9O2K/zu/wDg8o/aM/4S39qz4YfsvabNut/BHh6XWryMH5Rc6rLtQHHRlgtl49G96/0R4lDMo3bQTg9OAw6+wHJ9sV/jc/8ABX79paT9rz/gpP8AGH47wz+dp994hk07TGJOz7HYEWkGOPuFIt3HrxTSC9j8ywuzOCSAPpUmAR5Y44HJ+mWyT06dR2pJwdx/KvrP9gf9my//AGwv2y/hr+zLpaF/+Ev8QWtldbf4bXdvuXwOcLCjMT2wKqRMT/TI/wCDa39i0fshf8EvfCeseIrNbbxN8T3Pi7VNykN5d0oWyjfPRUtlRsert6V++OsazYaJo11r2sXUdnaWEbTTzTYCxpGGZmcngKijJb04qLRNG0rQNGtNC0eFILCxhS2t4kGAkMShEUDsAoAAr8Cv+Dmr9rDVf2XP+CUvi3TfCs7W2tfEq7h8HW0qNtKRXIeS7YEfNzbxSJxn73bisupR/CX/AMFxf+Cs3jv/AIKbftRX8miajPbfCzwjdS2fhHSlZgjIuVa9lX7pnudu5WbOxNqqB8xP4Z3DN/qz/nFWpWi24X7h6D2qtI+84HfpWsSXIzZCQdw6V33gX4a/ED4l6kmhfDrQ9Q8QX52gW2nQSXD5bgDZEjNz61+/3/BAP/giZB/wVJ+JupfET42m70z4S+Cplj1B7QlZtSumAdbKBwCUVEG+eQcqrKq4Ztw/02/gD+y7+z1+yr4Htfh/+zn4P0nwhpFlHsWDSoUiYgAnLSY8yWQ93dyTRzIa2P8AHAP/AATr/b6t7M6nJ8E/HQgRQzP/AGLe7QPU/uf8K+ZvFXgXxl4A1RtB8d6NeaLeqObfUYJbeUFeD8jhGGPp1r/dHYzA4ErDH+0eBXi3xr/Zm+AX7Ung+4+Hn7Q/g/S/GejXqGJ4NWt0kyD/AHJGxLG2RjfGRjAwQaSYWR/h4BFLbk49KsxNtbJ4r+j3/g4W/wCCKemf8EuvitpfxT+Bn2q++E/jmaWHT1uMvLpt7ENz2Tycb0ZMvC5GSqsp5Usf5v2yOM9+v/1u1NBoj9Dv+CY3/BQj4q/8Ezv2tfDn7SPw7lkn0+GZbPX9I3ER6hpzsPPgdemVXEkL4+SRVPTKn/Yz+H/xF8G/GP4d6D8Wfh3d/wBoeHfEmnQanp92nV7e5jEkbdccAgH0r/C+I+bj7pwG981/qTf8Gpv7Q+p/HH/gk9pfgvxHP9qvPhl4gu/Daknn7KypdW6EnsqylB/sgY6VLjqCZ/SUpbOH61/N1/wdhXixf8EeNbhJ/wBd4q0aMfhK7f0r+kBFzgf0x+lfzOf8Hac6xf8ABJSSFv8Alt410hMfQTN/SkKJ/l7yxKMjFVJFK5yOK3ZUxwRurMf72R6kfpWiJP6RtF/4Kzy/s8/8ECfCv7AHwF1vyfHXjrW9Yk8SyWrES2GjvMCISy/ckvidnGSIVbO3cDX85TopYmPlD/kY9KSNljh80ko0Z+XGPfdn5TxtHHXAB+lf2bf8Em/+DW3Vvjh4O0f9ov8A4KFXV74Z8PavCl5p/hHTm8m/lhkGY3vJ2DfZUdSHWNF8zaRuZPukui2tD+L53KcybVB4HA/+tUTsEQfMHUdcN/8AXJxX+vd8Lv8AgiT/AMErvhHp6WPhT4F+GJWjQAS6nC1/MwXPLSXTyHBqb4kf8ETv+CWHxVspLHxP8DvDKI6qvnadCbJ8DnKvbuhU8Y5GKBJ2P8gvzCRsx09f/wBVQu6uvHHoK/th/wCCu3/BrHpnwa+Fuu/tMf8ABPG71DU9N8O2z6hq3g+/b7ROtqg3PNYT7VeYRqpZ4pPm2g7WbhT/ABNdR229qSZQx9/P9Pav7Iv+DSD/AIKNax8Kv2hb/wD4J7/EO9Mnhf4hiS/8PLIwVbbVrePe6KT0S6hQhh3eNcc5r+N/6j6V75+zP8a/EP7Nf7QPgf4/+E5DFqHg3W7TV4mA/wCeEwdl9ArqCPfNEgbvof7dkpjwOK/zG/8Ag7W0yVf+Csr3caOVn8G6S27BI3ASrjIHPTJHtX+mP4e8SaV408MaX4z0Rt9lq9pDqFuQfvR3CLIn6EVma34H8H69dfa/Eujaffz7RHvu7eKZyq9F3NGx2jsM8UovoLmR/huva3Vv/rYWAxkrhhtH4j2PbtUTR/MQOB61/tI/tWfBv4Rn9ln4myHwnoqlfCGruriytwylbKbaQRFkEYGDX+LvboDGmP7o/lRFksqlSBzVqC3nufktYi8h4GwZPPboST7AfLxTphk+gr9vv+DcOxsNS/4LH/COwvoYriKVtSVo5FVlONPuOqsCKocT8PpNP1ONvLe0m46fIR/7LVd7O+2gSQunoCre/t3Ppz2r/brm+HHgS4/1ugaY2e5tYD/7Tqk/wn+GjnY/h3SCcd7SDof+2dTdj5kYX7OE63n7Ovw9vI87ZvC+mMMjBGbOI9Ox9q9G8aNjwnqsn92yuMfhCxrcs4Y7aFbeJQkcahVVQAFVRgAAYAAAwAB0rG8YRCbwjqijjNlcj84WFHQg/wAQzxEmdevn65uJeP8Ato1c8yMBhTxXSeIUZNbvN3QXEn/oZrDxniqQH6ef8ETC8H/BWX9n6WMZK+NbAfgSa/10vL2yOCM8mv8AJH/4Id2f23/grh+z/Zn+Hxfaycf7KO3/ALLX+t65yxNTEqRC/SmP96lbhs0nzOff/P0qiSKVQGqNTg5qd0IU5qJVzz/n+dA2yWiQqRt9qKQgHrS5kIpKwHPtUQVzHwatOq8+maRANoAo5kBSkVgNvT6VDt4Ge3SrUow1UqYFcEkZNRFAZatvndx6VVIIbd6DpQBHQQMcnbU3y45qB1w2B6f59aAImJEXpTacUO3BNNxjigBpdRx/n+VQ5PangZah+tAokZOBmmR525/KlfpTuB+FAwICqD3xTAU61JUGPmx2oAmwtGFp+5fSjK+lAH//0f7AKVf+ea0lO4PXiug5xxB3cn5cdqfCUCHOaauA+KRfuGgAJ+QEUu/5c/5/lUeTjFNDgnAoAaxB+bP4VImf4uvtULEKfl4NTRDkYoAtqoG3b3pcc+2KcBjB9Kdz0oAVBggCpuqnBpsaHP8An/GnRqvI6NQAUU7Y1G0Yx3p2YDg2CFXpUynByagH3vlqdRk04gTU5PvU2np1qQJ9q5yeo7VKpbORio0HOad5fof8/nQBPH3qdMZ5qvGQBg1MvUYoDluXlU7fmXjFfw1f8HgX7X/2rVPhx+wl4Vuyws1PivXYYycGSbdBYxuAcZCrI4B6bwe9f2xfED4k+DvhB4B1v4q/EG6Ww8P+GbCbU9RuGIAWG2RpHYZ7FVC47twOtf46/wC3f+1f4r/bg/az8cftR+L2JufFmqPNaQnOILSPCWkCgjhY4URTTa0KiujPjrbvAc88dQMZq0i/KGAwaZAwPA4q5wD60iQ+7j+VMYDk4pxOTmkquUCERNjtXsn7O3wP8ZftG/HPwn8AvAFuZtY8X6pBpdssYyczsFL49I1JduwC15Bg5zj7vsa/rx/4NF/2PLD4p/tY+K/2tfFdvHNafDnTfsGjo2MtqN8CHeNWyWaC2BzgfKZVxz0kD+9j4BfBbwn+zt8C/CnwK8C26waN4R0q20u2jUADZAqrnjrvcFyfevX1UMS355qSZWAxMNpPAQj+X+FIpLdef50uZATVKsYJH+f60ixvkHFSx+w6UrlRPBP2q/2dvC37WX7NPjv9mXxsB/Z/jXRZ9KLn/lnJIpeCYZUj91KqPu/hZcHjFf4vHxd+GHjP4K/FDxJ8IfHtu9pr3hi/uNLv4mBDLPbOY2yp6AkbgfTFf7giHORGNuOeOec1/mwf8HZf7Gh+CH7fmmftJeFtO8jQvi7pwu5yikL/AGnZARXAzt2hpUMbkdyWNKLHufyzxZ2/Kcr61f3ZGOw9Kqx5RjzvBOc9qsxgdR0rSLIInUFeaovwDitIjHWqE+B92rAieBXQkrvXaDhfQAhgP0OPWv8AV7/4Nw/24pf21/8AgmP4Y07xFe/afF3wyz4R1dmbczLbKpspnJ5xJbbFJ7srV/lDpllCA/8A1q/qC/4NSP20V/Zz/wCChUv7PXiq9MXhr4yWH9kbWOEXU7UGazb5vlBdPMhX1LgdqzlHqi0z/TXm2F2x0P4fpUKqjfuhwp/pV2Tc3J+8O1RmIdQOazGf5nP/AAdq/shj4Lf8FCrD9o7w9YeRo3xc0dLuZkVgv9o2WIJ8sBtDPGI3x3+Y1/K3gHDMa/1Of+DoX9kST9pb/glxr/jzRrYT678J7yLxVauF+b7KP3F6oxyQIn8w/wC5iv8AK/Wdc7cdKa3KlJFsxyKjNESpQq0ZGQwyGwRgdA/5dq/2Zf8AglH+0wn7Y3/BOb4Q/Hh51lvtU8Ow2upNyT9tsl+yXAb0zImW/MV/jLhtzZHfBH4fnX+iJ/wZsftHnxf+zD8Tv2VdUuQ8/gvXIdbsYcnIttSjKSADH3Vmh7cDf70WsQmf2U8E7hUnl5xihoyrFT609OBtHf8ApSGfnf8A8FYP2nR+x1/wTu+Lvx9hnEOoaV4fms9MIOCLu8H2e3C/7QeTfx6e1f41s+9TmViz53Ox6lj1Nf6GP/B49+0xF4U/Zq+Gn7KWj3BS58Z61Jrt/Ch62mnKUjDD0M8mV91yOlf54zurp8vAP51USZGdL8rkD5lGP5V/ZD/wZ0/shN4//aj8dftgeIrMS2PgDS00bSpHGR/aGpcsV4xujtkYH080V/HCSquPMzxy/wDwHkH6Yr/Wx/4N0/2Rrf8AZR/4JTfDex1C2EGt+PYW8YaqSpDFtRwbdWz2S2WFcdjk0SYRP3KURqoAHHYH0r+e/wD4OC/+CWP7TH/BVX4S/D34afAHWNC0iDwtq11qt+dblljErSwCGEJ5cb/dw+4krjtmv6D9wOGbrjmmlVJzUlH+agf+DOf/AIKUMSx8Y+ARg9Ptd11/8BqbF/wZ0/8ABSUyKX8Y+AFUdWN5dcD6fZq/0udmVBbtTLiP+L14xRewrI/LT/gjv/wT91j/AIJtfsGeFf2YvFtzYal4ltZr7VNcu9O3mGW6upS48tnUMwWERx7yB93hcV+oOOOeh/PFSwnfmBlLZ64yOfY9f6VHqGoadpURn1ieO0RfvPMyKOfXeVwOetJeYNjO23tQFAOQOa8k8Q/tFfs4+EbdrjxX8QPDGmKgyxudSto8D/gUtfOfiP8A4Kif8E2fCGT4i+PHgS22cEDVIJMY/wByQ0w5kflh/wAHT3grS/Ff/BHrxhrGoRRvL4f1zSb63dguVf7T5LY4yNySFePcV/lfyKgk/d4Iz1Ff6Pf/AAcT/wDBUf8A4J+ftBf8EuvGfwR/Z++MHhvxb4q1jU9LEOm6VOZpXihukllI2gLhFUtlm2jG3rwf84eVt5LEYyelWtiCBkyTz1r+/P8A4Ms/GM1x8L/j98O2/wBXZ6npOpxj+6ZYp4WP4qgwPav4DCduAe1f3a/8GV0Eu/8AaEvQMRlNFQY6bg10f5USRUT+73G0Yx07V/Lv/wAHdUjR/wDBKzToxyJPHemfpDdV/UWuDHxX8rv/AAd63TQ/8EvtAtAf9f4+05f++be7b+lQET/NPki3DA/z+tZT2+TjHStvhRVSRM4z0rREn9BP/Btf/wAE+/D/AO3H/wAFBbTxR8SbOO98GfCa3j8S6tbTqTHPOG8uxgYDgq0oEjA8FY2HIJx/qVaha5kHnff7g9j6Y4r+PX/gzX8AWFh+yx8Y/igkK/atS8U22ml8Dd5drZq4APXAaYnHSv7EbiPD+1TItbFKKEAjaKmZAWyR82eDTwu7C9l/z7Uvy5xiiOgSJY2Fq3n8EbsHIBHCEd+NvXJ6djX+QZ/wXO/ZN8Ofsa/8FRfin8JPBlutp4fu74a5pMK8LHb6iguFRR0CRyM6LjjaoFf6+IQrHjP0+n+T61/ms/8AB4B4chsP+ClvhvXYlCvf+BrMuR/F5U06D9MCjqKL6H8oxUDiNjjPcc1dIzavGD8iqf5Ht9TUaiQMC3H6VJ+8BJh68Y/LmnIk/wBkX/glH8SLr4s/8E0PgR47u23SXngyxjkbuXt1FuTn/gFfoJu9Fxg8e1fkJ/wQGmnn/wCCO/wIE/JGiTpn0AuZduPwr9e2Ybcr07UogeCftcyra/skfFeY/wDLPwXrJ/Kylr/E3td3lp/uj+Vf7W37ZBJ/Y9+LWO/gnWv/AEgmr/FTtkPkR57oP5URL5UNcZVQK/cX/g29l8n/AILLfBtT1MmpAf8AguuK/Dpm24x9K/bb/g3Ml+y/8Fmvgrno93fp/wB9afcj+tD3CJ/qvkfIv0FJsX0FT4Cxr9BUVUQP64FY/idd/h6/hXkiznHoP9U1a+MMBWb4jcf2BqPPS1mP/kN6TYH+Ip4ohDeIr5kGB9qm4/7aNXMFMZ47V2viAF9dvnTvdzH/AMiNXLzqFHP6UogfrT/wQJhS4/4LC/AYN1HiHcPqkEpH5V/rKFsLjFf5Nn/BApSv/BYv4Br0DeJCo/4FbTD+lf6ysi7Rz7VJUiJsBelMT71OfH/1qYpwck1oiSZuny1BU3zbeOtQ0AFMMmD0p7r8maZlT+FFkBWd9/GMVXyQpx2qdsZP+10qBfuGkmAjjDGoD984FSv0H4VGPvmmBG/3N/T6VXOC/wCFWn+90qCRQGoAglGMU1sYAp5TBGfSmPjPFAEDcJ0+lRKMDBqy/wB5fpVYdBQA0rgfLUVWztBBWoti5z/T/wCvQBDTU+7U0igDjimEYJoAbjAwKhAJ6VYw1MULz2aqVgI8L60YX1peP7tHH92pA//S/sAp5+4KZT26Cug57i9UpkQbbhf/AB6n4BTnihB8mKmIEBXJ47U2RflBHan8KtQ1rYCXau7j0qWJc8+nFQJ1qzGQVx6VAFpAR1pwIyG/z/n8KiDkf5/+saeCp5PDUAWF3d6dUEOSSanoAB0608j22iooxkbRTs559aBRJI8dulTJ96oY+9TxjLfhQMdJkPxUqfeqBBls1Mg5AFAFv/GpKjUZcingjpQNeYoU4qdPkTyw1MTYn3TUkqKIw0q44yOnfjn2xn6YzV04q9rXbCUuVOXTqfycf8HX37bd18HP2S9C/ZJ8H3Zh1n4p3bTamIjtYaXYspZc9hNMUXHQqrDpX+dmzCQYXv8AiMHtX9vH/BWb/gm98Tf+ClP7ZniD48an8RLHStDsootH8PacbSaYw2dsMEuyuqhpJi75AYNuHIxivyw1v/g3c+MdlH/xI/iFod22TgTQzw5/DDYr2I5JiHG6joePLP8ABrTnP534sYHGMVdCjomDjmv1x+Iv/BEX9uTwOslzo2k6f4ljiGdumXK7z8vZJPLbj0ANfm/8Tfgb8YPgtqp0f4oeHL/QbleB9thaIEj0LAIw+mfrXFPAVae6O6hmFCq7QkeW9OCKjHC8/wCf51FKdp2r93+f+FJn+HOa4/U69OhIxUYIrrfBnxA8a/DvXLbxP8P9XvtF1K0JaG6sZpLaZW54R4XV+3JHTp0rju3FR4bHt6Ut9iT+gf8AZP8A+Dk//gqP+zA9tpGueLU+I+hW+N2neLoxdOEGBhLtAk68DAJZh7V/U1+xT/wdffsO/HC8svCv7Uuk3nwi1u42R/bZCb3SS3yglrhFEsK5PO+IqB/EK/zX1LbCoxtPap7edo2DDrmpcRo/3FfBnjPwd8S/B9j46+G2s2Wv6HqUayWmoafKs0MqkcFJYcpjkDBOR3x0rqIpB1AIyD14/lxX+Ot+wz/wU6/bF/4J2eKh4i/Zj8X3Ol2kziW90ScGbTbpec+faufLyxGC6FJOmGGK/ut/4Juf8HP/AOyV+1rNpvwu/adhh+Evjm5KwRz3Mm7RbqU4AVLpwDbF+Ttm46AMRiocOwczP6hyvy/Svwb/AODi39iaf9s7/gml4sl8O2Yu/FPw3x4t0hEGXZbVWF5EoAOS9szMACM7V71+7EN0txAtxG++J1Doeu5dpbIwBlcYwwz6Uy98uZPs1ygnhI2vEy7lKsWDKRj7jDg01Eq6P8MqKTPzE5V+g/z0rVjjBG3oV6V+nf8AwWf/AGJZf2A/+Cinj34LaRbGDw3eXJ17w7kEK1hfBpI0X5cEQvviI/2PpX5kxoBmnF2E0QyAbd7fSqTcHBXtV9lBz3qhNu/KqJKaNjk/lXW+BvHHif4eeNdG+IXge8ey1rQbuPUNPni4aKe3kV4mHHZxnr7dBXHtkD56cTuUx9RVRA/2lP8Agnf+134f/b3/AGMPAP7VXhsLv8UabHJfxKwIgvoT5d5CcfdCSq+M87cdjX2kDj5fSv4Ov+DOT9t1o9S+IX/BPzxZc5iuVPi/w4rnhWQLDqEK98MvlSADuGNf3hLncWJznvWE1qaI5P4ieA9A+KfgHWvhp4qhFzpXiOxm0y9gPRoLlWhcH5cYIc/TFf4lf7UXwD8T/suftJeOf2cvF0bxah4P1q50liwwzCGQqj4OBiRNrA+hr/cGQBg0eAM9R2Pav827/g78/Y+/4VL+294Z/az8M2fk6X8VNJEV86LhRqWnDynct03PAYmxnJKniqW5W6P5Fll3YkQfL2Ff0tf8GqX7TEPwH/4KpaV8Otbufs+n/FHRbrw4dxAU3Khbm19uWj2D3bFfzQ7VA/d8r27f4V7D8Bvi/wCJv2f/AI1+D/jh4Pcxaj4R1i11m1KNg77WVZCv0YIQR6HFVIyW5/uTNg/Ovp39Kq/N5mE4zgD1BPyqMehrivg58VvCPx6+Enhr43+BphNoni3SrbWbKTg/urqJZlz24B2+xrL+Pvxi8Ofs+fBHxZ8ePF8qxab4R0i61e45ABW2R2CDPHLBQPXOKyWpZ/mE/wDB0f8AtJx/Hf8A4Kw+J/CejXRuNM+GmnW3hiBc5VJ0Qz3WM8f6xyhI7rjtX85rTbvn9RXovxp+J+v/ABu+LHif4x+MZGl1PxTqdzql0TljvuZWkIyew3V5nGhPDkGtiHufRf7H3wB139q/9qn4e/s4+HonlufG2vWWmEIOUjkkUTPjuEiDP6AZr/bZ8MeHdK8IeG7HwnoMCwabp1tHZ2sScKsMCiNEA9NigV/m8/8ABoT+yW/xT/br8TftUa7ZiTSvhVojQ2krr8v9papmGLaT3S3E7ccqSD6V/pTgZXA/SouWQU+OMn5h0FWEjIHXNfld/wAFc/8Agqr8Hv8AglJ+zXN8WPGES6v4u1rdZ+FfDwba99dADcz90togwaWQDgYVcuyipW4H1d+1f+2z+yx+w38O3+KH7VHjPT/CGkjiEXLZmnYZ+W3gQGed8EErGhxxk96/jm/bM/4PIpZPtHhn9g74bqAJHjXXvFrZyASEaOygI27sf8tJOOm01/G7+1n+11+0R+3D8ZdR+O37SHiSfxH4g1B28sksIbdGOVt7WLhIYUAwiqO2Wy2TXzDJIGUN6EEfn1rTlQmz9bfj/wD8F2f+Crv7RE9x/wAJr8Zdc02zuM4s/D8i6ZAoPO0LbBXIwMDLHivzb8W/HL4z+PLhrnxv4s1zWZXOS95fXMxP13k15WPnH3jtHHGBjjuelb+h+Gdc8R3C2Hh6xmv5WIAjt42lY59FjUk+gwKNEGjMOWSW5P78+af9okn9aZsRMEINwr7X+G//AATl/b6+Lbonwz+DPjPVxJja0OlXKpjt8zIqAe/FfZHhn/g3r/4LKeMFWSw+BGtWYcffvprO3xwMbhJOCMfQGjmRPKz8YYy5bBGKe0bA9j9eK/Z/9pr/AIIGf8FLP2Ov2cNd/am/aJ8JaZoPhbw+YftZXU7ea4Xz5BBGFjhd8/Owzz0r8X5gQSD/AAnFOL0G1Yry85zX9+3/AAZYaUB8K/j1rWBmTVdJgBHX5YZ2/wDZq/gIf7tf6Fv/AAZcQqf2ZvjfdYG4+KNPXd7LaMf61MgR/aTGOPSv5Rv+DwRGX/gmj4UZfujx/ZZx/wBel3iv6u1Taa/lV/4O/ofN/wCCYHh+THK+P9O/9Jrsf1FJbj0Z/mrb+2P8/lUL9KGly/HQ01mzx/n+VWQf6OP/AAZzurf8E+fiKg7eP5Qf+BWNt/Sv60ZFJc8V/JD/AMGcMoX9gL4mDsvxAc/+U61r+uFmzJ19P5VMiolMAhuakooqShskmDsI7V/nRf8AB4lYhP27/hver/y28Dgfit5Kv9a/0XJULMG9BxX+d5/weLKn/DbXwqQH/mR3J/8AA6XFNWuLRn8fciZHNJGACM/w1ZlXAHaqSj99geopyIP9dr/gg1a/Y/8AgkD8BowMBtBZx/wKeQ1+s5bIAr8sv+CG2z/h0R8AfL7+F1J/7+vX6o+Wv+f/ANdSB85ftijP7IvxXjI6+C9ZHHvYyjiv8VOFj9jiz/cXp9K/2vv2qbd7z9ln4mWqfek8I6sgP1spR/Wv8Ta3lxbIPRBQawHSffGD8vpX7ff8G4Vutz/wWW+DH2k/dub6QD3Wwua/EF8ltwwGr9uv+DcHcf8Ags58FV/6eb7P46fc1T6GbP8AVrIBjXA4wKrnGeKstxgdsVWc/vOBxREQpbOM9q5vxnLHbeFNXuT/AAWVw3/fMLn+ldFXFfEIEeBdcx/0Drr/ANENRID/ABPdTmVtRuZR0M8h/NzWFOuQfXn+f1q/qQK3U4/6aP8A+hGs2U4XJ4qFsaH6v/8ABB+4Fh/wWE/Z+llPXxXEgx/tQyqP51/rTyAbcYxwK/yR/wDghl83/BXj9n3b1PjC3/8AQHr/AFvpOUziqWopGdszmkVPl/z/AI1LTSrH6VZBDg9qjO3f1qzIG6LVRgB9aAHLlgR/n+lR1Y24Xiomxg/WgCB+oNVn61Yk4+Uc4qGJkbkipcQIqaMFalcDBIP0qLYv+f8A9dUh2IpRk4FRSL84HtVyq7/6z8KCeVDWXcKqSDbjbV2qxzjimkMh/DtVb/4iroXC9e1VlTuf8/rSAApjG7rUZ+UZ9TVioj9wUAMdAV3CoAM9Ksj7pqMhR70ANGep4xUZ5OasZ49qrsCG9BTW4Ddi0bFp1FXZAf/T/sApy8nBptCPyeOldBzk7gc1XjL7T6VKOVyWqNSw7YpJARN0FMqwcHsKj2k8jGKp7gMAJPFWYlwaYigLmnRgbzQtwJ6KauN2P4akAG7ijYCwo2Yx92ng/OQOlRKoPy9qf90/L9KQSiKCUOV+apKbENvX9KdQA+P0qwh5xVZPvVY/j/GgBxwBtXrViIOT2qr/AB/jVqL79OzAtKuXOO1OAGeKIwQSBipI84BWizAlhjOCG4xXz3+1P8QJfh/8Ib6SxkK6hqX+hWuCAQ0i/M3vtQHHt9a+jFG1vMPIK5Ix12nG0emcgV+SH7bPxGHiT4kxeCNPfzLbw7CY3Gcr58oDMQf9lcL+PtXvZFhVXrxVtj53ifHfVsK9dT5BtLWJI1CcBMBfoOlWjbxgYXC+wpYpI9gweO1WUUOCyANtHzbgf029P5V+qydNLR2PxNKc3oZclvF0kALL7VyHjb4f+EfiHor+HvGWk2mtWUinda3kCTocAnhZBtx9OSeOwzJ4p+Jvww8HIR4s8S6Rpbcgi7uoo8Y9QWzXl8f7V37MUr+QPiF4ZJ6bft0Az/4/Xm1atCekj1KGHxMdYI/Ib9rj/ghr8HvibZXXib9mWZfB+vHc66fMzPp03QBQWBktzn+L5l7be9fyz/Gf4E/FT9nbxxd/Dr4x6NcaLqtofnhlG3coHDxv910IIwVOD2INf6LOg+Pvh943USeEdf03Uw2MfY7qCVjx6Kx4PsM14p+05+yj8IP2rPAbfDz43aU0yhc2l3Gu26tnPJa3faT2GVOVbbgjnNfM5hk1Gr71N2Z9vlOf1qP7vELQ/wA7plbdk4P+70/QD+QpxTC5r9Df25v+CeHxY/Yn8TpPq4XWvCt/Mw07XLcFYZcYzFLlv3Mqc5Q8HGVYgHH54+ZuzzuPX5Rj9O1fF1qDptwejPvqFaFSKnHqQb2HGP8AP5UxWIIJopCwBwa5+VWNSbzQDle9SCVhIFLY4wc9wf6VTA/uGg9NgIxWgH9Mn/BG3/g4W+Nf/BP3VtM+C37Rdze+Ofg3NIIDbyMZL3SVyPnsJHO6SEd7VjtI/wBWUI+b/Sc+DPxj+E/7Rvwp0b41fAvXbXxP4Y16386xv7Fg6MuMsu370bqTteNlypXaVFf4gKyZGD6Y/pX7K/8ABIr/AILH/H//AIJWfFJLnRGk8S/DXX7hf7f8KyyERyjhTPak/wCou1AXD42uvysCNpWZAf1e/wDB2/8AsR/8LS/Zm8M/tqeErTfqfwyuv7P1h415bTL5gFY8ZK29xtx6Bz7V/nnROAoBwB0/LpX+yf4Q+IH7K3/BVn9i681f4e6nH4n+HvxH0mfSrzoJofOTZNFcR8mGe3dlLIRkEAr8pBP+RJ+1P+zt41/ZD/aR8Z/s0fEiMjWPBmrTaZLkY8wRnMcwHPyyxFZExwQahq47s8QPXn0qjJuIGasbhjBbOOAapup/CrtoIzyw5BpFJB4pJ0KkYFNTKj0oiB9t/wDBOr9rnxB+wl+2x8PP2o9FZvJ8LatE+oRL/wAtbKUeXdR4HVWhZvocDtX+zt4b8R6J4t8N6f4s8L3Au9N1W1jvLOdCCskMyK8Trjgq6HIPav8AC1VYnTA/iIwPzVvp0r/U9/4NeP2y4f2sP+CZmj/DDxDffaPE/wAH7hvDN6GOXazIMunSEkcJ5RaLPXMZ9qzlEtH9FqvlQRyfUV/PN/wc7/sryftLf8ErfFHiTRrPzda+GF5B4rtSFLN5MRMN2q7eg8py5/3a/oXOA+1K5Lxr4M8OfEnwhrHw88YQrcaXr1lNpt7CwyGhuUMTjlcYxyefbpSW5at1P8MW6iXDSdjgiq8OV57ZGR39MD2r6i/bK/Zy8SfsiftTeO/2ZvGETC68Fa1PpxLDBkhRyYJB6K8BRxjrnFfMESn5W6MKb3Ifkf6o3/Brf+0+P2hf+CTfh74falP5+r/C3UrnwzcJnLeRu+0WhPouyQJ9F4rhv+Dsj9pSf4Nf8EvH+FmiXLwX/wATNfttFYDCk2tuDd3A4ZTtOyNTgY5xX8+f/Bnv+1Ufht+2v4v/AGUdduPL0v4laJ9ss4yRt+3aWfM4B4y9u0gx32j0rrP+Dxf9plPHn7W/w9/ZU0ebNt4D0FtUvY92QLvU3+UZGcFIY17dG9KhblLY/jXJB6cen+fpSLEmQuMcfe6cHJJ5xgKBjilkfEm3rj1r62/YR/Zp1j9sL9r/AOG/7MujAiTxfr1tYSsFJCW7PvuHwP4ViRmPYEe9aSIif6YH/BtJ+xjP+yX/AMEvPCviDxDai28RfFK6bxbqG5TlYZ1VLJHz/CkAVuOm9vSv6A92AMAjAxzyag0LQND8J6DZeFPDtutrp+mW8dlawKOEhhUIqgegVQPwqfAxx0qCieXt5ZCnOM8Y7Hn0AG7P0r/IB/4Lkft6a/8A8FAv+Chnjb4kpePL4S8LXL+HPDFszHy4rGycx71HTdcTb5nI7HHIC1/q5ftY+NJ/hx+yz8S/H1mxW40Pwrql8jKcENFaSOuMc8Hn6iv8RN7ma7zdzNull/eM3qzfMT+fNVET2IyrHKHtxz6V0nhnwrrXjTxDp/hHw7ayX+o6tcR2ttbxL80s0rCOJEOQNzOyr9T0xWAgzxX7if8ABul8PfCXxE/4LD/B3SfFcUU0VjdXWpxRybdrT2lo8kPykYO0jcPf6U9hJan9SH/BNT/g1L/Zo+D/AIR0T4jft7pJ4/8AG00aXE+gh2h0mydgSIXEeHuWQHDsZFQEH5cAGv6nPhn+zZ8Cvgtpdtovwo8GaL4as4V2wx6ZZQW4AAx1VQw+pOG7V7lGAMSN96rCOI8qvGetYtvqUZMTyRxbPmVRwAOB+XarFv8AM3I56datvsccUkEDBuOKFuB+Bn/Bz1qS6d/wRg+J0XAa4vNHhXPctfxNgfgK/wAnxwN5/u1/pLf8Hg/7TegeAP2G/Cf7K8U4k1v4i+Ior5oVJyljpY3vKcHgGd4kGRg4OPu1/m3SKD8wGBjpWkNhcqM6Qjbmv9Dz/gy2Mbfsr/G9BwR4qsfyNnx/Kv8APElj6H+E9q/0Nf8AgyzTH7MHxyZuh8T6eP8AvmzY05Cif2kngE+9fypf8HfkoT/gmN4dXHB8faePyt7qv6r8KwJHav5Qf+DwWVU/4Jk+GAT97x/Y/paXX1rPoO2p/msqMnFP2qFx0NRxMODUmPn4qkEj/Rk/4M7Ili/YD+Jjq2N/j5u3pp1sK/re5E3T/OK/kr/4M7xu/wCCfvxHbGceP5B+en21f1oPndQKI2iiigoaxwM1/nL/APB4Zq32v9vv4faWnBtfAqH/AL+Xk5/9lr/RmlyRz0Ar/Nx/4O/Vcf8ABSDwc3r4CtSPTAurmpluKO5/KbNIu7k1UiG+b8/5VYuUABA6dqrWz7duPetOgra2P9fb/ghuqx/8EjPgHEO3hlfT/nq9fqkRgAn0xivy+/4Im25tf+CTfwEh6f8AFKQv+bMa/UUqTxwfapJPE/2jYmf9m/4hRjv4Y1Rfzs5R/hX+IxHIRGij0Ir/AG8v2iU/4x0+IITr/wAI1qWMf9ejj9DX+IIH2jA4Azj86DWBp4VzzwccV+6f/BtRaR3n/BaH4QGTpAdTl/75064I/WvwojbLZPav3g/4NpLmCz/4LPfCMykZkGpxrngEmwnwP6VTBbs/1SJV2AKDxUBIzgVaK5A3elVaOhkKOoriviWf+LdeIiv8GmXfI4xiBzXajqK4z4koG+HmvgnO7TLwY/7YPUiWx/iV3rZuHI5+Zv8A0I1lScocitNxmQh+u5v/AEJqpSRrzjpVJouzP1M/4IY8f8Fd/wBn328WwH8kc/55r/W9/wCWY+lf5Jf/AAQug/42+/s/oOR/wlMZ/wC+YpDX+tn/AAfgKS3HIrlctgU0qQalYr2+WmbmXrzVkDKrFOv1/wA96sM+UPrmk++OeBQBDUeF3VLtOM0HaB0HSgCq/DnHpUageWB0qXtzUeEI56elAEMg4qGp5AwQKPSomXDYoAbUJUbsVNUbffFADWGDVY8HirkvWqr9aAGVXq1gcVVoAMce1QswwFqaq9AErrhSKibqv0qRvuCqoOTg9hT6gPXqaY/3qMfLkGonO1/wpyQC+WvrR5a+tQ0VI+Vn/9T+vvew4oSRcFcc03oeKepJIb+70roOceM45pELZNHDHjpSgAdKaYC0gAHSlopB6D/Lby89KAuGAP1qUcqAelIgw2D6cVUQFKHIAHFFWKjKfvcDoaoCSDvS8scUwRkN8v3acQ2c/wAPaiyAljGBin0xBxmnKST6VFmBIgyfpVhFZH3H5hiq6DDfhU0XLnNC3Acq55NWEPOKao5AqePbn7opxAkjPO31q0jD/V/54qsF6bOKsxKwbAHXvVAcN8VfiFp/ws+HOrfELU/li0uAyoOgZjwgB92C/j0r+Zz4s/tGfDv4R6fd/Ef47eIbLRYbuR5pJLpgTIz7ydiqN77nGPlGRjGcGvQf+Div/gqr4e/Yr+H3h/8AZ48J2y6p468SD+2khY7Yba2hJSGW4I5IZwzRoMZKAk44r/O1+Lnx1+K3x+8Y3Hjb4p61c6rf3LdZWPy9tiIu1EXAAwuAMV7+XZlDBwfKvePmM0yeWPre/wDCj+i79pD/AIL76Tpk8vhz9lzw59sC5RdW1pSASveK2Q5I/wCujA46pX4nfGf/AIKI/tj/AByml/4Tfx3qX2KXOLW0k+x24HoI4toK9ucn3NfEYDLnA69ff8qc/OARXFiM1xFV++z0MHlGHw+kIF2+13VtUnNxf3EksjdXkYkn8SazXuLjs1PeHcfu0xYStcPtGekopaWLen+J/EWiXAu9Ju5rd4yPmiZkIPbBUjFf3Q/8GtPwW8aftRfCX4ofFf8AaN1XWfEHhzTry10DQLe5u5tkU6xme6kiLEjcqNCpBJGGwF7j+Fb7M0u2CCPe7nCqo5b0GB3LcDHPOK/18P8AgkZ+x4f2Gv8Agnt8M/gJewrDrkNimq67xgnUNQPnzqx29YtyxA9gnpTji5x2Y54anP4o3Ryvxp/4JX/Cn4neDNT8BrcjUtE1ODy59M1hVaNwNxXEqgMGXhlbG4cGv8/L/grN/wAEWPjp/wAE5PEsvj2w0271j4b305SDU1+b7I5HEF0yDaATxHJkBsYO1uK/1Z4xjIAYA+vHf0rN8UeC/C3j7QLvwr4x0+11fTNQiaC6s71VkglhO7KOjfKyEr83GR+NFTFzqr39TOjhIUJP2Z/hz4Y/KevbHA/KmuGAy36V/Zl/wXV/4Nur39n3TtW/bC/YF06W/wDA9uGu9f8AC8QaSbTUH37i04LSWvBLpgtFgkblBx/GyQsi5T+LoeOn0HFcyaOqKM/cCMBKhf0xitbytvSq5hyC1XzIkzxnOBV+Js8Ee1QGJhztpAMduKWgH7O/8Ebv+CtfxU/4JXftBw+IY55tU+GfiORYfFOgo25GiUlVuoFyFS6hByjdHUFGHIx+xv8AwdU/s9fD74j6t8Kv+Cq37Ps8GteDPilpMel39/a48uS4gUyWcrccNJbhomGAQ0O0/MtfxvLLIo+Tg/4dK/oq/wCCS/7UumftH/s2eOP+CJX7R2oqnh74mxvdfDjUrw/LpXiaEGa1iDfww3koVOMYkJA4lIrN7gfz2oi429e/SnvH6Vq+IvDniDwZ4j1Dwh4ptXsdV0u5ks7y1lXa8U0LGORGXqGR1KsOgxkVlPgdD+VNIChLESmapEYNajjKms2Reea1AhjlAP6V/Sn/AMGs/wC2Rcfs0f8ABTLS/hFr10YvDnxhtT4cuY9yhFvU/fWEhGOvmKY1x/fxz0r+aryz2rr/AAJ4t8TfD7xhpfxA8G3BtdY0G9hvrG4Q/NHPC4kjYDuAy5P0x0rKQ1uf7oUaN/y06jr6D8KlaNXXHWvj79gT9rLw/wDt1fsbfDv9q7w7tT/hLtKjuLyFCCIL2IeVdRHHIVJlceuMGvsUhguJVqCz/OY/4PCf2Sj8Nv2uPBf7YGh2mzTPiNpJ0rUZUG1f7Q07G3ccfekt2j+uw+lfx5Kw2j/9Vf6wv/Byl+ysP2nv+CTvj25sbUz658PPL8X6ayjLKLElbpVwM/NavISB1wvpX+TalwDyvIoG4n25/wAE9v2mbv8AY5/bZ+GH7TaOy2/hDxDbXd4I85a1ZvJukGOW3W7SAjv90V3X/BUH9qiP9tX/AIKA/Fb9pPR5mutI8R67KmlMwIzYW48i0wuMqGijVsdtxr88BIQd5+n/ANarMcoddzcGr5RLaw+Zl87J/lj9K/sD/wCDPb9lR/iH+1z43/ax1yyE2nfDrRhpunysPl/tHUm2/KSMbktkfOOQWHrX8fMzRr/reOnHQ+v4DHf2r/WL/wCDcX9klf2TP+CWHgGPXbVbbXviJv8AGOrMylW/04f6KrBuQqWscXA+o60MSVj97hOrdOMdKjU8g1UUHG1xjHFTq6r24FZSGeTftDfDuX4t/s+ePPhTD/rPE3h3UdLi/h+a4tpIlAI/2iP0r/D21PT77QdSudC1uJ4Lqxdre4iI2srxFkZcdiGXBr/dn8wrtkQfxEpu6AgKQPoCCa/yjf8Ag5C/4J9ap+w3/wAFD9f8c+HdPaLwF8V55fEuiTKu2NJpmzfWm7AXdHOxYIP4HWqjIGuh+Aybsc8V9hfsG/tW65+xB+198PP2qdCt3vX8E6vHfTWsZ2+dasfLnhBxgeZEXUHs5Ar45R84/p0/TirC7lOOmOmabZMT/b4/Z/8A2hvg7+1T8HvDvx7+BGrw654W8S2oubO5hzkj5d0TqMmKaJjskR+VZSrCvaABjJIPuK/xlP2Jv+Cnf7bP/BOjxE2t/st+NLrRrG7kEtzo86rc6ddNyuZbV8oWwAPMTbJwOcAV+9fhT/g8p/bu0fTorHxR8N/BOsXKDHnRi8g3AYwdqysB07YqeRlH+kPDGu8Y/h7V8gfty/t8fszf8E7/AIL3nxu/aX8Qx6PZIjLZ6fHta9vpl+7BZQcGR23Dc2dqcFyFHH+ev8Xv+DvD/gp98RdJl0f4d2HhPwN5ylftGnWT3NwvH8LXUkiA46fu6/nX/aA/aZ+Pf7U3jqf4n/tHeMNV8ZeIJwFN5qU7SMqkHCx7htRMdEQIo9DQkCPpv/gpb/wUT+Kn/BTb9rbW/wBpT4mr9htZFXT9E0hfnisNPiJMNuvXLMSWlfb8zsxxjao+AZJAT/8AXz+tfSfw3/ZH+LvxD/Ze8f8A7XunWQi8FfDy5stOvbyQELLdX8uyK3gA4Z0UmWTsq7d2N4z8wM3Yf5/Qfyq4KyAa5DoFPav9Dz/gy4hX/hlb42P/AH/FtiPwFmf8a/zwHfDAe3+e1f6Gn/Bl1qCN+y98b9PGPMi8U2EuPZrNgP8A0HFEhJH9o5OzttzX8mH/AAeIMT/wTZ8GqOh+IFnn/wAA7qv6xrqRVb+8tfye/wDB4GN//BMvwzKOfL8f2P8A6SXdZvcI7n+aukzcZq4spByxz7VirJhcn/P6VLESM1d1YOVH+j1/wZs3iTfsIfFSxzgxePgx9t2mwY/9Br+uaQjJPFfxzf8ABmXfxv8AshfGfTpDkQ+M7OXA/wBvTwP/AGWv7Ep8iU0gkKTgZpgfJxj/AD+VNZs49qbhqC+UlJyDX+cH/wAHhMaL/wAFC/h/KgwZPAkIP4XtyK/0eB0Ir/OE/wCDxAkf8FAPh6fu/wDFCRf+l1zTRMd2fycSt5i8GstCBNjIwPf2NWxIpiC/hWZI5Ryw6c/oDTkB/sYf8Ebrb7H/AMEqfgBD/E3gy0b/AL6Lmv0oaVUr80P+CNd8uof8Epf2fbqP/oS7UfTbuFfpHKwQ1Jmct8UrEa78KfFOghdy3ei3sDAdTvt3zj88V/hwahbtZ6jPZycGKRkI91bFf7nk0sdwHWYfumHlOfRWBDY46ba/xbf24PgNr37M37Y/xO+BHieAx3PhnxHeWQDLy0RlZoHA44eJkkXHUEdqDRanzChxx+Vfdv8AwTX/AGo9O/Yt/bu+FX7T2vIzaX4S16G41FUzn7HKDDcbQBlsRu7BRySMYIIr4Qj2pwBkDjNPaVVA2nDA9PpVOQKJ/t8+DPHXg34neDtK+IXwv1S21/w/rUCXthqFm++GeBxlGR0BXbggMCCQVxjduFdUqSy4MSllwSAAf144H41/jU/s4f8ABRf9uT9kbQJPCv7NnxT8Q+EdJkkaQ6fYXObbeSCzLbOWRGJALMqjNfQGof8ABZj/AIKqeP8AWbK38RfHvxaVaeKPEF2YR98D5hCqAgdc9wMd6m7sHKj/AF29vG5uD+X6ZrgfiXLs+HevuP8Alnpd1j/vw5NdLoV3Nc+HrC5uWLSSWkLMT3YxqSe3U1ynxMwPh/4i3f8AQLu+n/XB+lW9iYn+JleyCO7lX+5LJ/6EcVnvcL5dM1GVvt87esjcf8DNUHkGP5/5xUFH65/8EHn83/gsL+z/AOZ0/wCEpXj/ALYSV/rWZBgUDiv8k7/ggcEb/gsT+z+ZOAfE4/SCXFf61bEkbfSq6CkMY7TzTCwK9cU2T79NdvmAGFxVIgd0yT9KiLMCFHSnVG5bPFAD2k2gAUjOAcY/z+VMXg5bpTd+1tmKAIyQvzD7pqMfKcn7poJPI7Chm+THalzICOXHGKiozx7UyNtvXGaGgH0j/fX6UoYN0qFyd/4UwFfrUUpA4oY5YCo2zu5oAYTgZqCpZPuGqzfcFAElV6nzxzxULDBxQA05xxUIJPT6VPUZUBhigBU6bfSoWj+bmp1HJqB2HNNdgDC0YWoN/vRv96OVgf/V/r+ZATkU5E67fxopwzxnpXQc43GE8tRg5oxjirFM2hVLdT6UEx7DCNw3dO1Jg/eqQRZXJb8KEUg8n/P500igwfWpEA3Ugj+f/P8AjU8aYPNIB+RnpQEOMj/P61OFUjGN30p+0HG3p/tU1uBEo2jFGAOBUoVVYmnxxjPH+f1pARRgflUuAeDQkZ3GpChzxTswIR8jdParCDHXrTNrnvx2qwqMW5wMUgJFOf4cVKgx2+lKhp0YPmc0AKm4j3qa61DT9G0q71jXJ47Wys4WmnnkIVIo41Z3YkjAUIpLN2KkDjoibmHGOK+ev2uv2en/AGrf2bvF/wCzifFGoeD4PGFj/Z91qelJGbhLZmBliXccKsq5Vn/ullHzEU+oH+Ub/wAFU/2yLv8Ab0/bw8f/ALRgLtod7f8A2PRInP3NNtcwWqgbeN6oHbH8TEdK/PaNdq7DzkYbPPbFf6CZ/wCDPL9j6FMP8WvGLlehW2s1H5YqjH/wZ8/sjKePiz4ybA6eRZ//ABNCdgP8/wB43c8kVLlc9K/0BE/4M+v2QsY/4Wp4y5/6Y2X/AMRT/wDiDy/ZAKjHxY8Zg/8AXGy/+N1XMhWR/n9rtHFPG3PpX+gAf+DPH9kjzP3fxd8ZfTyLI/yQVNF/wZ3/ALJYIEvxd8YkHsIbIH89nFHMgsj+Zv8A4ICfsYxftnf8FL/BWieIrNbvwv4IJ8W62JFzE0NgymCFscbZrho0YHtu7V/qylWllZrjDMSSeOPm6jHp7V+Sn/BLv/gjl+zr/wAEq7fxfL8HtY1XxLqfjNrVbrUtZWLzI4rdX220fkhV2M5LuxH90YwtfrWibOD9Ki6GW4/lJUGrkLlRVGIgOfQVMjnsaltIDZMjRx7+rfexjK4IIB54C5Uhs9SMYxiv8+v/AIOO/wDghXpvwDvtS/b9/Y40NofBV3KZ/FuhWiHZpszn/j+hUY22cr5EqfdiYgjCsAv+gBG2Hz75/Hp/LisrxH4e0DxZoV94V8WWEOo6XqlvJa3llcRhop4ZlKyJIp3bo2TIbAA6jIIpdSk7H+H0sXmE9zTGh4wePWv9Czxn/wAGgn7IXiLxzrGu+FviZ4p0HSLu8llstMjhtJFtonYlIVkcb2VeFVm52gZrmU/4M6f2YZELP8YPFw9P9FsqrTck/wA+yWJR8nWoDjp0Ar/QRk/4M4/2YWx5fxi8XDB/59LI/wAhVX/iDZ/ZmP3vjN4sP/bjZ/40cyKS6n+fixAPXcDzWnpGoajo1/DrOk3ElrdWjCaCeAlWQxtvVlZQCrKRuVgeoAHSv7/0/wCDNL9l05LfGnxYD7WNn/jVuH/gzQ/ZbyGf40+LeOm2xs1II980m7jSP4mv2rvj1D+1H8T/APhf2p6ebLxR4itI5fFCxqqwz6nGvlSXkYVRtW9VFmlXGBK0mDtZa+aNin7hyBxn1r/Qc0v/AIM1/wBjmJiNY+L3jOdR0EcFjHz9djcV0f8AxB1fsRxruHxP8cfiLHH6R04sTVj/ADvmCjjvVCVCOf8AP86/0RT/AMGd/wCxe2QnxP8AGw/4DZf/ABuoG/4M6f2Mm4/4Wj40X/gFl/8AEUcyFys/zunBxjHXtSRhSFB4K9K/0Qm/4M2P2NLkbk+LfjaPbx/qbE/+06gj/wCDM39jUN+/+L/jg/SHT1/9pmldlcqPH/8Agzr/AG3xe+GfHv8AwT88TXY+02Ev/CWeHEkzzFLshvoV7bVby5cDszV/clLKo+aPkdq/mN/Ye/4Nlf2ff2Cf2n/Cv7VPwj+LPjKbV/C0ryG2uo7PybmGSNo5LeTy0D7HViG2+gwM1/S60pDeXU7DMnxl4Y0Xx54R1PwP4phFxputWsljeREZDwzoyOv3cYCsc/iOlf4nP7Yn7OHiL9kf9qv4gfs0+K0aK88F63daYC3VokcmCRh6SQlXBHYiv9uD78XbaeMfX+lfzuf8FFP+DbX9kb/go3+1BqP7UXj7xX4i8K63rNnbW17b6Olt5Mr2yMgnbzVZgzoqq3Y7V24+agpSP8q8yYPl4PHHPXj1qeKUAbScfhX+jUf+DND9hSTMh+Jvjnk+lkP08iov+IND9hkYC/E/xzken2H/AOMVWpJ/DJ/wT/8A2XNc/bW/bR+Gv7L+hxtJ/wAJbrcNtdMqn5LRG827kOOipAjnPsfav9o/SdG0Tw1pFp4f8PQJaafp9ultawxjCpDCqrGijsAoGK/BL/gmt/wbt/srf8Eyf2j2/aV+HfibX/FGtR6TNptqmti3aO2+0Eb5U8iNG3simPd0RS3civ368uRuXOAD04/px+XFHQDSWTcOBx2qZOtVVODmpgwPSpGkThQBwcZr87/+Cof/AATm+EP/AAU6/ZO1n9nj4m4sr5G+3aBrKoWfTr9VIjmVQAWjYfJPHkBkJwVIBH6FjqKlZA67TjbyMfXr+FLYR/iq/tp/sJ/tJ/8ABP8A+MV98Ev2mfD82i6lE7GzusZtb6IcLPaTnEckTAj7vzKxwwXGB8iuRu3L93t/nj+Vf7cn7R/7KP7PP7W/w1uPhF+0h4T07xboU/zG11CIMEY8h4HUb4n5/wBYjKc8c1/KR+0f/wAGc37N3jXVrjWf2YPibrHgdZm3Jp2rwLqdsnXhZVaGdUGB98sRTuhWR/ng3EYfcwH3uv4VivE6kR4r+y3xT/wZn/twWV40XhD4q+BtQiHRrn7dbMfXKCGQDH1r0H4Yf8GXnx51STz/AI0/G3w9pEWMeXo1lc3jYGP4pjbDGO/Y+tNSKsz+J7fnELnA7Yx6dcHjp15HHWv2s/4JNf8ABEL9p3/gqL45tdYs7Wfwh8LbKYf2t4ruoWEZQHJgsFYBbqdsEDZlI87nI4U/2w/sgf8ABqz/AME4P2adctfFfxLj1H4t6xakSRDxGyRWIbnlbKEKsgHH+tkYcD5a/pD8L+H9E8LaPa6B4Ys4bDTrFBDbW1sixRRIvARUUBFUDj5RijmYj+fT/gsr+xH8Ef2ZP+Dfb4jfs1fs86DHonhzwTY2WoW8KfPIzwXkDyzzyYBkmkOWeRjkk7QAoAH+VwsvYdB07cfSv9wD9rr9mzwn+2R+y745/Zc8cahcaRpfjPSJdMubqzVXmhSQht8aspTIK5G/IJ46V/KWf+DMf9jfJY/F3xoQ3QCGy4/Hy+lHMwP868MdxY8fjX93f/Bld49zN+0D8M2cBvL0bVEX2DXETEfQbc/THevoC7/4Myf2RhhLX4u+MlJ7tDYt+m1a/Vv/AIJHf8EJ/hJ/wSa+K3iz4nfDvx9r3imTxTpC6TcW+pQ28UCKJllR/wBz87MGXaCOAGwR0qZSGkfu3L8wCKMAcYr+U3/g75T/AI1faAxHTx9Yf+kt3X9WwZd/I4r86/8AgqT/AME1/ht/wVL/AGcLD9nf4leItU8N6dYa3Drv2nSEhaUtDDNCEfz1ZVT94W3D+JcGiKJe5/jN7sdBT0kHp0r/AEWE/wCDMr9ilSd3xX8bnH/TOxX9PLpX/wCDM79ipVB/4Wt449v3dh/WOmM8/wD+DL/UC3wD+OtivbxDpb/99Wsq/wDstf2iSkmT6V+UX/BLD/gkt8Ff+CSvg/xf4N+DPiLWPEkPjO8tbu6n1026lHtY3RVi8hEUZ3sTuz2r9XeM4TkDpng4oAZRSuSBxiohIe/+f0oKjsPY4Ga/zhP+Dxk7P2/fh22OG8CREfhf3X+Ff6OpkA4UcE1+Fv8AwVJ/4II/AD/gqz8Z9D+NfxV8beIfDWoaDoo0aK20pLZomiSWScO3nqWBLO4JztxgDDcFrcm6uf5RVscw4bqKqzArNtHQH+lf6K//ABBufsRovHxQ8cDHqtkP08risyX/AIM5/wBiZZQW+J/jgrnkYshn8TBQ2LmR+1v/AAQ/vzcf8EjvgA/p4TiT8pZB/Sv1IeTzAVB57184fslfs1+E/wBjz9mjwh+zH4Bvb3UdH8D6eNPtLnUChnkUuz7pPLQJhd5+6oCrjvX0Fvxlu+etIgiuwNo34/L1r+OH/g5Z/wCCMnxA/aMvn/4KB/sr6Q+teKdM09LTxboNqpa4vbaAbYr61RPmklhTCSxj5mRVZQSpB/sh271/Gm/ZgHB6bSWHtx2/M01uVE/w4Z7eWxmmtrpcTRMUZZFKspXIbcpI2sMdCM+1MkIjbbnO3gD6flX+u7+2p/wRd/4J0ft4tc658aPAUFl4pus/8VFoTfYL7PzfNI0a+XN6FpUc9sgV/Px8Uf8AgzS+FV3fPdfBv446pp1s7fu4db01LgrjsZYJYQf++Pzo5WaKx/A9LMW6/wCf51f0CTZq9q68FZ4z/wCPiv7Pr3/gzS+K8bn7H8eNEkQDrJpV0p/Lzf616j8NP+DNuKz1eO6+Kvx0eW2R1cromk7XKqTnDXE20H5QAdpA6kYFOJF0f26eEpPtHhLSpj/HZQn/AMhLWP8AEXaPh/rch6Lpt5n2zA9dHotkuj6NZaNG5kSzt0gDngsIlC5OAOTj0rN8VaSPEnhvUfDjzNbjUbOWB3jwWRJVZCwG0jKZ3cnngdKbRB/iEa00a6rdCM8CZwPpvPtWGJeoFf6DU/8AwZ5fsmTTvLJ8WfGOHYn/AFFlkEnP9ymD/gzt/ZFUqG+LHjL3xDZ8/wDjlKMS7o/lU/4IOztD/wAFf/2fSOp8WQr/AN9RyLj9a/1uMgda/mb/AGMv+DYz9lj9jf8Aaa8F/tR+EfiF4r1bVvA+qJqVpbXaWa28kqBwqybE3hMdSrDnuOlf0sq+F45+vFCQN9h0r4fioJGw/wDn/A1I2d3P3ahK5bPaqIJWclN/AOKiEinrTHXr6UzgHfUcrAn38bjTXYqMpg+tJyQBxUXygEkZNWBHvyCBxmmjkY7Chju4NNIwuVosgIpGAIX/AD/KoyBwc0j9M0J0p20AkBI6VAz5bj0/z2p/I44qvsydi9aQD+Qc0pOTmmk4GagoAfI2ARVUDgZNTM5PHtUFADsjOD0pzIAtInDZ9qiXj6EdKAJHAUArzTNuGzQvCim7iGw3f/PpQFhX+7VXHyjJqZ/vVVqogBT/AGl/SjZ/tL+lN2f7K0bP9laoD//W/sAooorqkc5LGOCakA24xUXJXanWpV59qS3JURfLb/P/AOunKnr/AJ/WpKUR87u4pFCRR9j/AJ/Wp40G8g/5/WkVcrk1KFIIIFAE0Ix7UlKvzcig5zzVRAVBt+lTVFjGOeKkJG7kcVVkAgBzkmpFBXgDg0InzY7VMnOMUuZARmH0+lOVAtTkOTjP+f0pkYOanYLdQ2NU0e4tjHakUYGKlRcYbNFwHpHuTk4IqdY+NlMBB6elPTPXNIA8sfSo1C5+bjFJuONtGQMSfhigBViU+gqYLtQL6VByw+lJQBawvrTkIHHp0qJFJ46U9iOFFTECTzPl5HH3fw9PpTfuv9aCSpyvzZ4oH3uBjFK7AsqV6/hU+8DAqnU46CkBYjYFuelWVIKnI4NUlcD5TVhWPUfSgBW+7830H0owzdajpOd3tQA4AA7amxwAAMVD34p5DA7qDSBIMM2zjAqSPg5qmjfPn8KtBtowBQKe5bQ7PmIzU4kyOnWqkT54x83p7VKvf60DJvkxSEJgNwNvFMooLsiwG+VR0oAUdKhQ44PSpAT+FVzEE0TqePTipo8A9KroqlvmqUSANgdamXkXInDAnFTIPlII4qJQCc9M1diWUru2MYxxnaQB9SOAPc8UEFcsqkBu1IXYHmnEDbz/AJ/Km7D/AJ//AF0AIduN23k0c4xigEA7e1SAEcfwmncBYwzLzTvvN5Y4xSUUik7E+Vp6sVPFVd+PlC04ORx1rMkuK44A4xUJRAcpxilRu9JQAhYMmB8vGPy6VEM559ads+bI6U0AHPtQvMBZGH+r7elV2kydv92lc4qI8tknHFaFRHxy8Yx0qJpDu/z/AIULtXjOaa7A8CgcRBg4VOD3/CgKGfOP8/5NNHHSgN/CO1AybKpxSkIpLf3uPwqAygxgn/P6UdeaBWQpl3Dk1W8z5fl2/L0pWPBHaoVBK+gxQCSFADHzCfmI2/ge304oMZ9f0/8Ar1OkMhGShHrxkfTjpUXlSsTGcqeRheeQOnI/kOKDO6K0hx8v+f8AP40x8D8KtSLtLCRShXqCCMf0x26VVOAMY/OgZATlAashgF2gcVXA24B6U8Z79O1BMhJGLrsLVnyrsXIq5wo96r7GoJK5TGDjkdPaojGCu3FW9jbxxxTZUAOaAK0YAGafSfK3AHSlqolLcgkjBzn+LjH0pGOTn15pWyeD2pgYE1RJWbG0FaUSIp+UYp7KmPl521BgjtQBYwBFxWcSCuD25q7u+Xb7VXKj0zQBVfKjzvXtUW5QoTHPtU0rjAiA4qIBfpQAH37U1DgFf8/5/GnAYGKQADpQAtRMuWyewqYDPAqF1w+CflFAERzs6dagwMYqz/KoXAHAoAVCvpimSNtJxRUTsA20dcVMQEHKrmof+WdPxlT7cVHtwmT9Ku2gFeRug/SmbyQMf5/Snv1plIB4xg1W3HduFS9uKg7elAEzNgVBlaV+Peq9AD33A8dDzUYIA2jtRkAZprcrmgB6EEZ/SmjaeAKi6Y/2alAwTQA6oAxZd3pUrHAqDgiqWgA7Dp7VULsFFSSHrVeqAm8tf8//AK6PLX/P/wCuq+xaNi0Af//X/r+UEDBowSMdKSI9eak5610HOPUHtUsfvxUMRXHAIqZc7h8vagCwoycVLwzZUYAqvlvSpRxtIoAmUZOKkO7dxSBVGdpz0qYY3YNADlJB20qpjrTQMPipaa3AKUdgelKVIGTTlAVgW+7in0HqO2KPepY1ABFVm7fSrEOMcUluIRjk5pFO1iPbipNinp1FN6EOe3FDYFhVxjNTVHGexqSkAIuDgUrxkE471JErZ9KefftQBWjiBOWOKeYmHO2nhMHP+f51JntQBHHGeg6U4wnoMBalWM7eDtqUrj60AQhCE29aeEAqZVJOX4pxTBBxxUczAi2gKB+lRFMHb/FVsd/lphDdcdaQ0MRckLU5+VyB6UxQFIGM+9SkgHcp5oEMYNt6VZiLAYHOah3ZHPbpUsRUUAScFc9DQn3sUyigAqdBwCe1MCnIxzV5IyIVlwAo+XkE5PPt0GR0HXjtQVEr+SAMmhRgcD61+Jn/AAUh/wCC/H7B3/BOHXbj4WeNLu98b/EC2X9/4b8OeW8lsWGQt5cOVit2wR+7G6UDBKcrn8c/Cn/B5j8ENS1xbLxf8B9dstPZvnnsdWt55VXPURNbxKcDtvGe2KB8qP7RIhtfdntVhcHha+Hf2DP+Chv7Jn/BSP4aTfEv9lzxE2orpziHU9KukEGo2MjAlFuLc7yqNj5JULRthlVuCB9V/E/4o/Dn4H/DvWfjB8X9bs/DnhjQLU3d/f3reXBBCp5ZmILNuJARV+ZjtUBi2KdmD2O78tyvFKvHyEfT1r+Pj4/f8Hjf7JHg7xTP4d/Z4+F/iDx1Z27si6nqFzDpUU2OjRReXPLsPT94qEf3a+9P+Cb3/Bx9+xb/AMFBfFr/AAfuNH1bwD8RZrSe403RtSkhmt9RaCIyGCzu12qZ2UZSN0XODt3cipcdQif0Jh0f5AOfb2qdUCdOjV/Pl+wb/wAHGn7In7fv7Wuh/sffCjwN4u0bxDrqXTJd6qLNIIfslu0zq4jmkbcdhVcLjdgZxXT/APBV/wD4L6/BH/gk/wDHPRfgP8SvAGueK7/XNDj16O50qaCKOKOWeaDy2Wb5i2Yi24DHKilEZ+9KlCeKmjKjjpXzR+x5+0fof7ZH7K3gb9p/wnpVxodn440pdVgsLphJLCrsyhHZOGxtyCAPeuH/AOCgH7bnw3/4J1fswa5+1d8WdL1LWtB0Oe1tpLTSxF9pdrqXyYyvmtGgCsfm5H0NUB9pJt35lO1VZQcD+H+I/d9CDn6Cv8z3/gqP+31/wWV+FP8AwWv8T+EvBfifxTo+uaV4kW08EeGNPMx0+605nAskisl2xXUd0m0yOyNuYuCwK4X+yr/gk9/wWj+Ef/BXHV/Hdr8JPBOs+FYPAi2jzvrM0Enmi7MoVUSD7uwRsxDZHOBXwh+2x/wctfsh/siftneIP2ZPG3wk1zxD4u8C6oukf2tbtYhf3qoxMEr/AL6NSJMFMDkdutA7s/p18K3HiPUvCOlah4utEsNYurKCS/to23JDcvGpmjVu6pJuUH2raeFQN2eP0r4K/wCCjn/BQXwJ/wAE0/2UZP2sfiT4d1LxFpFtqFnYtZ6U0SzBrwkI+6QhNiEANznJHqa/PH9mL/g5B/YW+OP7KXj/APa+8f6R4i+HnhP4e39rpcj6qkE8t9dXSO8dtZrbuQ8oCZZDtwpDMVUEhbCP6BDEB1/z/KnRqG+XPT1r+LTxV/wegfs1Wfi17Xwd8FPE2oaMj7Rc3d/aW0zKCRuECpKq8cgGQ+nFf0Hf8E0P+Cu/7Gf/AAVH8N3upfs+aldWXiXRoxLqvhjV1EOoWyHgOEQuk0BLBfNiLYOAwViBU3e4H6fNGRz/AJ/nSFezHtX5hf8ABWD/AIKtfCT/AIJMfCXwz8V/i14W1fxTbeKNVfSbeHRWgUxOkJm3u0xUFSBhQM5NfBUX/BzT+wna/sN2X7bHjvRPEehDXdYvND0LwuBDLf30tiiNLKjBhClsnmIskjsApKjDNgEbA/ov8sHpUqx5IX2/L0r+Ln4d/wDB5n+zzq3jiDTfiZ8F9f0bQZ5NpvrDUILyZE5+Y27RwbsD+FXU8cE4xX9Af7SH/BZP9gL9mT9jzw9+2x4t8Yrq3hTxlFv8Mw6UokvNUba2YYYG27DEflmaQoIWGGOduaUe4H6kpESOmP8AP8qUxnd0FfxS2/8AwemfAKbxULaf4F+IxobPtFxHqdq1xs55EHlBN3+wZsccGv6of2HP27f2af8Agon8FIPj1+zBrn9raRvNpdW8q+TdWdxgEwXUHzGOTBBTGVYfMhdSDScQPrjYV+lQuO+fwrwX9qP9qL4Ffsb/AAf1T48/tJeIrbwt4Y0YAS3M7ElpG3eXBBEmXuJnxhI413YBPRTj+TL4s/8AB51+zXoniqWw+DHwX17xJpUTsovdT1C309nUZwywol0UHoHcE9wDStcD+0A4HGOKhIyK/m2/YM/4Oif+Cfv7Zfj/AE/4QfEK01L4Q+KdXmW1sU12SKbTriRuEiW+j2+W7E4XzYkUnau7cQD/AEU+PPEsPgPwfrXjbULZ5oNE0+51B4IuHcW0TSNEu4KAxVQFYnGSKspOx0a2y/eP4elM8oY9K/ms/Yl/4Oh/2Of2zPjvH8II/BniDwTZW2lX+tX+u6xNaNaWlrp9u9xLJNsfIXam1eCN2BgkgV8ZftD/APB5F+y/4M+Ic/h39nD4Wat450G1k2DWdRu001ZgpwWgtzDJJs9DLtb/AGFoFdn9kAjXof8AP/1q4X4mfErwj8G/h5r/AMUvHUslvpHhrT7jVb+RE3sLa0jMkpSMD5yqLnGR0wM5r8Rv+CXf/Bw/+xt/wUr8dW/wTks7v4a/EK7GbHRdZmikhvtoP7qzvBgPLt+bynRWIBKbtpC+N/8ABfr/AILC/Cz9hjQdY/Yw8X+DdY13Uvin4C1B7bVNPmhhitftYns0SWOQZZVdd7ODwMBVY9J66hdn3H+yN/wXN/4Jp/tzfF7Tv2fv2bvF9/qvi3U4Zrq3s7rTLq2BSBPMkzLJGI12IMjJJOMDrX61qN/3DkHpj/I/lX+PP/wR4/bh8F/8E4/23NC/ao+IWiah4h0zSdPvLGSz0t41mL3MXlhlM+Ewv3jyPSv9PH/glb/wUw+Gn/BUf4G618c/hb4a1PwxY6Lrb6DJaaq8UkjOlvHN5gaDKqpD7cZyCD6CqBPU/Sryz6V+ZX/BWz/goRp3/BM79izxJ+0fDYR6rryyR6XoFjNnyZdQuc+V5uNpMSIrPIFOflxkE8fqC/mvcrEFGZGCnsPmyewONoIJ6ZGOa/zkv+DjL/gtH+zz+3r8MI/2QPhb4Z8Q6PrvgHxzcS6ldaklsLWVLNZ7NhH5Ujvud8OgKptVTnmmgbPhn9nX4wf8HC3/AAVt+I3iTXv2avHvjjxBcabIs+ptYasNJsLM3G4wxKGmt4UDbHKRpk7VzjALV/V5/wAFVviz/wAFKf2VP+CEXgpfAEmrW/xO0vS9H0v4ia7Zy/adQs4/Idb2dbiMsSzXCIklwhIVWPI+8P5rP+CEn/BcP9n7/glD8EPH/gH4o+B9f8U6v4w1uHUoZ9Ie1jhWG2t9gjkadlfcHDMNqlTkdOlf3D/tj/8ABTv4P/sjf8E9vC37f/xH8K6pqvhrxdFpbro9qYDcoNXhMyK7SlYmEQwJOoY4C8U5E7M/E3/g1N/an/by+PXwr+IehftFXeqeKvh5ocsH/CO+IdYd5Zlu5GYXFlFcS5aeIRgSN8zCM4GRuAH9ekvzP/h/kfyr8hv+CSX/AAVl/Z4/4KqeHvGGn/AHwVqXgey8BSWsUttqC2yqwvRLtaKK2LKm1kbcG6naRxXwJ8df+DmH4O/AT9u/Vf2FNS+FOu6pqmleJ4fCz6jHeW4haaaZIjKkaoXKjzMqmQTgD5e0ctwbP6cvMRVyVqPzVc7FHHb6V/Lt+3//AMHUH7Gf7JfxV1n4I/BTwxqfxV1fw/cvZahf21zDZacssZIeOOfZI8zIw2OyRhd3yq5xXL/sU/8AB2B+xp+0T8RdM+F/7Q/hXUPhFcatOttbarcXUd9pgdztVZ5hHDJbLkBd5jZFJyxVQcUoiUT+rIorA+o4qrIp2gg49u9aZ8h4hMvAI4wMj1GMcEY5z3GMV+HX/BSf/gvL+w9/wTY8Wt8KfHc2oeL/AB/FGk0vh3QBGz26su5ftlxIwigLKwYIoMu3B2gFcoHE/bRdygEDg9c9KaY/M/2f/rV/FfpX/B5z8H21Pytc+A2swWbEhpLfWLeWUD2VrZFOB0G4Z9a/o+/4J0f8FVf2Pf8Agp/4NvfE/wCzVq1xHqukBW1fw9qiLDqNmH+VHaNS6SQMek0ZK5GGwxxQDTP0P8v6UhiQLwea/JX/AIKuf8FiPg3/AMElLTwRc/F3wfrHikeOTeLZnRXt1EJsvL3iQTsu7IlUptznBBNfLXj7/g5U/YK+Gv7GHgn9qrx1pXiGz1X4hpdTaH4PhWCa/aG0uJLZp5ptwhigZ4yqOzAtn5VfacA4n9BC2+761G8fYDFfxleHP+Dy/wCAV14njs/FnwN8RWWjF9r3NpqVvNOinPSF4Y0Y+i+aDkda/qv/AGSP2v8A9nj9uf4M6f8AH79mnW18ReHL4tDuVWjnt5kX95b3Nu3zxTR7l+Vs7gVZWZdrEE7n0C0QXn160gQBq8X/AGnf2nf2e/2NvhBqXxy/aZ8S2vhXw1pnyyXE5LNJI2SkFvGoZ55W/gRBnCnsDj+WH4pf8Hin7LOi+J5dN+DXwf8AEnibTYn2rfX97a2DSryMrAsVwwBxxufI7jNBJ/X+YiCR/e/SohGpHXrX86H7D3/Bz1/wT/8A2t/Gll8LPiBban8JvEeoyCCwHiB4pNPnlfIWP7dGFELMcAedGi52gNzX9HDoikgfKMN15IIzj5R/CB6ZJ49afoBmyBkO08iq7Yycjt2r8Qf+Cjf/AAcC/sLf8E7PGl18I9ckvvHnj+y4u9B0AxkWh27gl5dyHZEwUgmNFeRR95R8ufx98J/8HjvwpufEiW/jj4D6tZ6Tn5pdP1iGe4UDIJ8p7aJHI67dyZA60czHys/s+3DC44x/ep7rlR/SvjD9hr/goF+y3/wUc+FcvxV/Zb8QjUks3WDUdPuY/KvrCRgSq3Nvk4VsfJIhdHAIRsg4+1Mf3ePbsKcREYPBwMVWwC+DVp+VOahqgIyuFyf8/rUD9Kt0zauetAFMAk4FRyRjzV+lWgADx6CoKAIth2Y9/wDPeo3x+FSsMHd2FROMrn3/AM+lAEG3I3HtUZTqTx6VaAYdKifp+NAFWRSEFRlWUYOefYVYcNjPX2qArkEsaAIvKZTtzzioduBkdKlwQhOeM0jo44PT2p20HfqRUm3JGelShVUcimEc4FO62ERyKobaelIhI4XpT2Xnj5fam9F4GKkBr56GoXIwDnFSY48z8KaVHcVUQI3AMfPpVcpnlatOABxUfl89MVQFaipst6UZb0oA/9D+vqILt5qbjORziq8a9jU6Z6HgV0HOSqd3y55qSmIMDjvTyj5BA4p2YEqZxzTwMDFR4Y/hxUiMCOlICzGVAAHWpI3yxx1/z7VAgwcjripo1UDigCaE5wo4IqaoU+9U2McUAFOwMim1IvyHd1FNbgDKSM/5/nU0X9KbTkXn2FPQCRgSMCk2Dj2p9FJodrD42jf2xT+3Wo0bsV4FSqowMdOlIRYTHB9KkOMk9KhTGKmj6e9AD0AHUUh+Z+B3p9NUHnpQA9R8wp//AC0pirkc9aesvK5GP8/SgCdBk/SkOQ3tURfGMU9xnkHtUWYEq/eIpq7cc1GucU8DK46Y/wA+1IB6uMYxigD5+opgwQSetC9emaAHup8wgYIpFGJAP8/1pzLmmx5zgUAXAFHA6VEVJOKeneMf5/z9aE+7QBPFjaK+Cv8Agqh+2BJ+wd/wT++JH7UGmGMazomm/Z9GWX7p1C6YW9r8pHzKjvvZR/dx0Jr70jb5QK/nT/4OqPD+s63/AMEgvEOoaNE0kGl+KNHubsqPuw73j3cfwh3XnIALdRjFBofx8f8ABBv/AIJs6F/wVj/bH8R+MP2obu81LwV4RiGueKWWV1udSvLuZhb27Tg7l85xJJLIhDbVKqQzAj+8P4nf8ELf+CS/xT+Gd18Lbr4J+H/Dsc8Jii1TRU+z31u+G2ywzq5LOp2krJuVujKRkV/nif8ABJP/AIJXftM/8FK9Q8Y237OPj/TvA0vhH7IdQW7uLmFpftZcQsi2ytuVNhyW6HtzX7Uy/wDBq1/wVPhObL9oLRyc8Zv9UU/j8uOKAdj8zf2JfiL8S/8Agip/wXFh+E1xq7ahpmi+Kx4I8QmPKxX+lXkqosjoDtBRWiukBY7XXjK9f2h/4PG/2zfEdjrnw8/4J9+FbySDT5oT4q8Qqp2idy7W9gj/ACjKJskkA5BZlP8ACK+d9D/4NBP+ChB8X2njjUPij4Ovr6G7jvDLcNfO0rRsrbmkMJIJ2nknHGOAa+Vf+DuDRte0v/gq7a3GqplbvwNpTQMuSrhWnjYqSAMb1PTsPen0sLqfod/wb0/8EEv2bvj7+zVa/tp/tq+HB4tHiqWb/hG9EuXmitIrOBzEbudYSjyvNIriNC5VVUHblgV+m/8Agsx/wQK+Bfwz+Auoftx/8E39Gl+GXxA+Fqf2/cWOjTTiG6tbY75ZIFZ3aG6t1UyJ5ZCuqMpXcVNfvH/wRj1Lw9r/APwSs+AVx4c2NYjwXZRN5eAPNhykw46HzAwbuK+wf2l9U8PaL+zn8Qdf8YNEukW3hbVZr0yhQvlLZybt244xjj3HA7VLYJH+Zx/wbFXlxJ/wWp+F1zI5d54dY3N67tNnYnt3NfYX/B48c/8ABR7wID/B8P7QfleXZ9vWvjn/AINfIt3/AAWj+FGBx9m1bn0H9mz4/KvsP/g8Wjz/AMFIvBq8/L4As/of9MuulUthrc/tY/4Idgf8OjP2e42UHZ4Ntv1Z6+Kf+DqJSv8AwRt8cxkZH9uaN/6VCvtT/gh1NFcf8Elf2f3iIwPBlouAcjIZwT+BUgjtXxD/AMHVeo21h/wR+8VWVy+19Q8RaLBEvHJ+0btvPcqrdOg57VEhLY/G7/gylVRe/tBk9Vi0T/0K6r+ej/gtxC1x/wAFv/jSRwx8bogI/wB23H9a/oU/4Mq4s6n+0Jjo0Ghj/wAeuq/nx/4LWsZP+C4PxpK8n/hPFA/D7OP6UdSrdD+4z/g6zOP+CMutRqPmbxDoP/ow1/FF/wAEJv8Agmtr/wDwVO/aIf4L+P8AW9TsPhD4HA8T+JLa1lZVlmcC3ghgUZVLi427DMFLJEj45Civ7Zf+DqqNpP8AgjTrzgfc8QaEcdMZmA/9mr8j/wDgyy1Lw4ujftB6NmM6v5mg3BU4DNbAXYz67BJwcdMj2p6biZ+23xm/4Nv/APgkr8V/hRd/C/w98L4PBWoi38u017RZrkXts4yFlbzJXS4AJ+ZHDAjg44Zf89fwN4i+PP8AwRZ/4KjFYtQEfiL4Q+KH0/UPIJEV9ZKypOjKGB8i6tmDBTnG4fxLmv8AYOKDy/JcfuxwBj24GO3Oa/yav+Dj/WtE1r/gs/8AHCbQXVo4ryytpSnI86HTrVHHuwcEH3GO1LmYkj+ov/g8k13TvEX7CHwY8QaO3m2l94w+1QP1/dy6e7qc+6kdK/LP/g2X/wCCRfwc/wCCgPhrxB+0b+2LG/irwN4FvX0DQPDFzLKtqbyaJbm5uHWNlOxVdPkUjcxLMcKFP3J/wdHWep6d/wAEiP2YdL11Nt7b3Omx3Ct1Drom1h9QRg19lf8ABndbRj/gmX4smwNz/EC7B4/u2VtinZAtj8//APg5O/4IZ/sZfsyfslv+2l+x94Z/4Qe98O6na2uuaTaPLJZT2144hWVEmZ/JkjkKDCEAqzZXhWr8wf8Ag3X/AOCbvh3/AIKnfFy/tf2sdQvdc+E3wRsxJZeGzcypDJearMz+Suxw8UUjRvLNsKlyFUkckf18/wDB0PGq/wDBGL4lOqgZ1HRj06Yv48fl2r8Zv+DKeKOTwf8AtDOwBK3ehD8Nt3x+lMFsfTP/AAXJ/wCCA/7AHg/9gbxt+0V+zB4It/h94r+G+nNrIk0tpjb3ttCyieCeKV5F3FGLRyqAQy45U7R+V3/Bm78VPFmifts/Ev4W2Fy50TXfB/8AaFzbZyjXFjdxJBJtGPnCTyJ0+6x9K/sx/wCCw+D/AMEtf2gBtGP+EF1L/wBF1/D1/wAGce2T/go54wWTBLeALrr6Le2X9Bj6Umx7HL/8HMn7Y3xL/bd/4KYR/sZeBJpJvDnw61CLwxpOnxsQtxq915a3NwygYLmRkgjPJVUYDaXav6yf2CP+Dcv/AIJyfsv/AAT0vw18XPh9pPxR8atbq+ta54igaYSXBU70tbeRtlvEhyiYG4gBmZifl/z/AP8A4KMfC/xf4z/4LT/FX4SR6lBoura98Ubuwt9Qu2aOO3e7vdsEzuo3qqb1fcgYj+EHgH95If8Ag1F/4KvRMMfH7Q4XXjC3+rcY/wCAflTE9jhP+DnP/gi78Cv2INP8Mftk/so6Wnhnwh4m1L+w9c8P2+5rW2unjZ4Z7YFiY45VjkDxg4VlUrgMVX9/v+CMv7bnj39tP/gh14ou/iRdvqPi74f6JrXhK8vpmLSTrb6ez2UsjZO5/s8gRjjLFSx5Y1+GHiX/AINMv+CrfjrSV8O+MPjv4f1nT0kEwtL+/wBUmhVxwG8t4WXcOxxmv3Y/4JW/8EoPj5/wSk/YS/aA+GPxv8S6F4gbxZYT6lYSaE05WIRadNHL5gmiRhn5cbQfunpmgOmh/npf8E3/ANkv4j/tvfth+Dv2RfhvrL+HpfH0rWGo3wLKqWMai4utyKVLhVhyIyQGZQOAeP8ASX07/g26/wCCOegfC9fhzL8J/wC0WitVhk1ee/vDqLHaU+0eYrom8thsLGFzwqBcCv4m/wDg1pW1l/4LM/DvOG8rS9V29O1m/Iz04r/VDniVodo+7t6fgaB2P8b/APba/Zv8Xf8ABKz/AIKQ+Jfgn4T1t7q8+G2vWt9ourDCSNGwjvLOQ7SAsoR1DjpuDAcV/pX/APBSf9j/APZJ/a2/Y68V/tdfG/4d6P4o8d6J8L7u70bUtQEzNa/6E93EEjjkC/JK5dG2ls98V/Ad/wAHMx/43Q/FnywOE0oED/sGWw/Wv9HP44IT/wAErfGNrIPmPwjudw+migU5NCsj/N4/4N3v2ZPgT+13/wAFONA+CP7RPhq28XeFr7QtTlm0688wI0kNvvhb9y8bblb7uGHFf6gv7Lf7H37N37FfgO7+Hn7MnhHT/BuhX14dUuLOyaQrLctGIzMzTs7Z8uML1AAUcZr/ADa/+DVCI/8AD4jwgx/6F3Vh+dtj+tf6k/8AArAY4B/KldWDqWfNMRV9wVlPynqPlORxtPAK8kcHPWv4XP8Ag5+/4JpfsQfsvfsgx/tM/AT4fwaH438UeP4hquqxzXUjP9rjubidfLkcxKkkoU/KgwRhflNf3MKxUbelfyzf8Hdalf8Agl5pEnGR4607P/fi6/xoWgz8cf8Ag2R/4JqfsS/tzfs//FHxX+1f8P7Xxfe6P4gtNPsJ557iExQyWxd41+zzRg/Nhsnv3A4r9kP+DpjwnoHw6/4Iy6X8L/B1othouheJtD07T7cEkRQW0c0USZOSdqKBk8182/8ABm8ij9j/AOK8gAy3i63X8rJR/Wvrv/g7Oi3f8EnJ7k9E8YaSf0lFBK3PzL/4MsbaFND+P82BzPog59D9p4r+ZX/gsXbaxd/8FgvjrD4eL/b5PHV0tsYjtcStIoTaR/FvI2+lf05f8GWibvD3x/x2uNC/LbdV/Of/AMFS41h/4Ln/ABURhlf+FmKcH0NxCf5UDe7P7Uf2I/8Ag2x/4J6/BD9n/RfD37TXg20+Ivj26s4p9e1TUZp9guZVJaG0SJ0CQR7tofG5mBZm5UL/ACQ/8HDH/BL34V/8E0/2ovD5+Aaz2/gT4iadNqFjp9y5ke0nt5Alxbo5+dofnjZN/wA2CRkgCv8AUWeANdOCOD2PTkLmv4Qv+DzuRk8dfACE4CHTNYb3J8+3oWgru5/Rl/wQg+PXxa/aL/4I5fDjxoJI9S8XaVpN94dtJtQc+VLNpUjwWTTuNx2BBGrsBuwCcEgCv59PgL/wau/tS+Mf23Ifi7/wUs8T6J4w8IateXet+Iz4ev7h7y+vJCzrCfMt4XWOWRsu6AbUUqNpKmv1L/4IKftDfD79kP8A4N6tJ/aR+Kpkh8PeEv7f1W/EILSyIuoOqxxgkDfI+yNOQMuO1fzi+Kf+CrP/AAW0/wCC137R9z8Ff2OLy/8ACWnSxvcweH/C0q2UVrZowXzr7UCFkYgsiu7MiljtVAcCh+QRP7Dfi9/wQY/4JV/E34W3/wAKYvgro3hiS+tjb2usaNDJBfW0hXEc8Uu7MjKRllk3BgMbTnFfwK/8EO/FPjT9mb/gtj8LvB3hTUnDTeLJvCOpeVkJdWs7SWsquoOCjEBwCTtZQR0Br9drf/g2y/4LmePYo77x78ddPt5ZTlo7jxDqVwwJ552oy9B2JH0r8Jv+COmiXvh7/gsj8EPDupSLPPYePraCZ1O5XeKV1ZgT1BKkg96TVrDWx/Sr/wAHpkbDRf2fplHAn1xBn/tyNfMf/Buv/wAEUfg3+3f8Krz9rz9tiK68UeF9MupfD/hfw89zLFCRbKJLiaZo2WRYkeTbHEjKpYsxBwM/WH/B6XIP+EZ/Z+G3n7Vrh/NLOv1a/wCDWu2iX/gj14LkwMya3rXIH/T3ik9wtoj8w/8Agu1/wb0/sYfCj9jrxR+17+xzobeAtb+HsCajqulRTTz2N9ZPKsMmxZ3kaGePeHUq4UhWUrnDj5I/4M6fjb4o0b9ov4rfAaG5kk0XV/D0Gu/Zj8yrd2NwkKyKo6MYpyrEdcL6V/Wh/wAFrjGf+CTH7QRkA48HXOOOhLRkfyFfxn/8GeVqsv8AwUT8YyTLlIPBUn5Nf2v8jVrcHsfNH/ByB+278Qv2zP8AgpFrX7Peg3Usvg/4W3reGNE02JtyyX2UjvLgoCAZpZv3YOeERVGOc/1XfsBf8G2X7BPwL/Z70i1/ac8EW3xH+IN9Zpca7f6o87QwTSJuaC0hRkRUgyIy5UszAsTgqq/w+/GYx+BP+C3HiD/hY4Cw6Z8ZJGv/ADeF2JrW5ixPYJz6Y5r/AF2Pvs8rYO5mYEe5yMY7EY/Sqirkt6H8C3/Ba7/g2u13wl4k8OfFz/gl34D1HWLDXpZrTXfC+nM06WLKqvFcQtMwkWFxuDIWfawXBAYKP1X+HP7Zn7b/AOwV/wAEDPEHxI/bG8Mat4b+K3w3sm8MaM+sbTNdGR0g0y7dt8m/7Oj7dxxu8kcnJI/qB1DU9H0ePzNauoLVGbbunkSEMcfdBYjPHQLk/lX843/B1W9/q3/BJXWD4d8ue3tvFGky3jr82ItzqmNmVH7wjOegzjqKHsKJ/Iz/AMEGP+CXejf8FXP2q/E/i79pK81C88DeD4hq3iR4HdbjUr28kcQW3n43x+a6ySTSZBwpVSrMGH9xfxl/4IY/8EoPi38Lb34R/wDCo9B8KC4gENrq+hp9nvrRvnCzxzByZHVsb0k3K+MbcHNfwJ/8Eif+CWf7UH/BSXTPHEf7OHxO0/wGPDEtouoWl1cXkTXH2gOYmC2qsGRdjDL52ngda/Yl/wDg1S/4KQIwaT9oDRFkB3grcapkH1zs6+hpRa7FNO+5+Uf7A/xV+J//AARw/wCCzkXwu1LUTcWekeK38DeJVTcIb6wmuFhEhjGR8uUuIwSdpUYNf6nOJ4JGjn+byyRn1r+Anwr/AMGkf7dlt8QdN8dan8U/COqXVrfwX7tcNfmSXy5FZmLNASThTkk9sE9K/v4dzKB0w+OnrjH5UoiktSJ2yRjtTKk3KwqNlBP0qxBVeplGCSabt+fFAEL/AHahPPtViUYAxUbIMbzwB2FAEdQsCfucYqxkfexxUJ4b2oAYsbbRUTx7Fq3kY46VBIOPl701uBU8vg9uaFQDgLxU4+4c1F91cA4pAVyvUU3b5Yz+H+etShQV+Y84qNicdM0AQ1Fg76mbH8NBxninZgQMOfY+n/66bUowh9VpHHeizAi28Y7VGR8gqWkIyMU4gVTIuKIyTyaXapoCBelEQIcY4oooqgP/0f6+FPYdqsIe/wDn+VVRz8nNTp0rp2OcnjODVwEEZFU0ParCdearmQCx8c08AAYFJkA4pal7gWE7VOAB0qomc59Km+b3pAWE+9VgnnHpVWP7h+hqWM5WgCRTs6U4AA7c8UyigCdfzqYNj5cVXjIDZHpTwT5nPpV2AsIc8rzRTY2H3Y+DTqnUAQHfg1YTKjaMYNV8HO78KnRSBj1pATRjC1OhAGc1BGMDFPoAsU0rjIp0TqAAev8An2ooAFPQ+2Kdt+QE9qbSrJ+hoAdjLbx09KlqMsAMLU0e0EgVMgGqgH1pyBSpOe9NoAPQVIDmGDikXqfpTn+9TFA3fKcfhQBIhPSlJwwpg+Vv8/8A16Rjk5oAsgfP1qY8ZA/CqidKsKemfpQAKXXAr53/AGyf2YfCn7an7JvxB/Zb8ZS/ZrTxrpEmnpc7N32a4UGS3nUAcrFIqufxFfQ5yDnGKtQN/fGVPHP+elNblJn+VL+x5+0l+1N/wbv/APBQ7VtK+NPhOeSW3hbRfFGgMxhi1GwLh4bqzmI2uAVEsMnK4JUgbiF/qG+JP/B4N+wLpXw1uNd+FvgnxjrXinyz5Gl6nDbW0JkGNnnXCzS4TI52IzbQcDPT+iT9sf8AYY/ZR/bn8GQ+Bv2n/BOm+LreyVhaz3S7J7bfkn7PcRFZoQeN21tpP3lr8lfCX/BsR/wSJ8J+JU8RXfgLUdWSJjItnf6teNbkKCcMi7WZemPm9jRdj07H81n/AASz/aP/AOCzf/BW/wD4KBR65bfFXxfoPw2ttcTXfFz6bdzwaXZWkcomFhAobaGmCrBHECW2klhtDmv18/4Ov/8AgnL4+/aY+E/h39tr4NaTLqGs/DO3mstfsbVd0jaTMwkW4RVG9/ssu7eOyOWIVVr+qD4QfBz4VfAPwZafC/4KeG9L8KeHtNTNvpujwRW0MYHJfy1xuY4H7x85xnrXpzQJJDt2LICOg4GMMOCe2OD6ipsgb1P8yb/gi3/wcVeJ/wDgmr8N5v2d/jT4VuPHvw8S5kvdLFjMsV9psk2TLHF5gMbwyuN+xmXYdxBw22vrL9v/AP4L5fH/AP4LH+Ek/wCCfX7A3w2v/Ctp4xBOuXd7cpNd3FnbL5zxExokdtaoELzuWYsqhQVUkN/VZ8ev+CCH/BKL9ojxhN4/8d/B7TrfU7pzLPcaJNcaYsrNkl3jtZEhyW9IwxOOOTXo9t/wTz/Y1/YZ/ZT+KVh+yr8ONJ8Iy3fhLVIrm9gV5rydPskzKkt1KWlZA38IcD1FHKOx/AB/wbAIIv8AgtL8MNpBCWescr0+XTpxke3pX7gf8HhP7FXj3xavgD9vHwXYSahpHhyybw14kMK7vsqmXzrOd9o+WJy8kZf7oYqCRuAP4f8A/Briiy/8Fm/hup/g0vWD69NOmHav9SfxB4T0LxTol34b8TWMF/p2oW7W9xaXcayQzROuGSRXUo6HByG+U/dxwKuQWZ/nX/8ABHb/AIOcLL9gj9mnTv2TP2lvAt/4v0LwqJY/D2o6LNElykE0jTNbTxz4SRUdm2OrKQrbSp2hj4R/wWM/4K+fHj/gst8O768+Fng258F/BP4SywajqEd1KJZbnUL1/stq1wyqqeYoZxBbJuAXe7seg/rz8ef8G2H/AASN8c+OJ/GTfCoaaZDve00zUb21tCec7II5NqDjlVKjtX6DS/8ABMr9gy6/ZeP7GcXwr0SH4cTXUd/PolqJYFmuYDujmlmRlmldSv33lJONvTikkuokj+VD/gynhxe/tAyEbVC6Ivr0a6P8q/nW/wCC1cog/wCC3HxtnA+WLx0HyeMAeQf6V/p4/sg/8E+f2Pv2CG1w/sleC7XwcPEzxf2k1rPcSrKYC4i3ee7BFXLYOAOWHPFfPPxn/wCCJ/8AwTG/aM+MOv8Ax8+Mnwos9Z8XeJLk31/qMt7exvJOFAWQKkqIo+ReigY5wc1NtSnpofEH/B1TqYT/AII3apGP+XnxFoK/TDh/6V/C9/wSy/aK/bK/4J96xqP/AAUg/Zq0IeIfCPhK8h8OeMrBy/kS2uoIZYo7oJlo4meDdHcbcRTKoOdwVv7if+Drr7PF/wAEfNUhQbVXxVoqJjoArOq/X5FFfll/wZn6R4e8Y/DH9pHwf4ms7bUdPv5NFiurW6jEkMkci3aFJEdSrIRkMGG2lER6J8W/+Dy/4OD4RXMvwC+D+up47mt9luNfuLc6dBKQMOxt8yzonLKgWLdjBZRnH86H/BKb9hL4/wD/AAWP/wCCiK/ED4jrdal4eGvnxN8QfEMqkR7Xm854N4GwTXT5ijjHKqS5AVcj+8Pxb/wbof8ABH7xT4zfx1dfBu1tZZJBJJaWF7fW1oTjJxbxShFQnHyJhfav1u+CPwG+Df7OHgG1+FHwN8L6Z4R8NWAYw6bpUCwwqSCHcqvzO5yA0jkt6mmkB/Kx/wAHmKQ2/wCw/wDCS2tohEf+E1cJGgwoRbCTaFHYAYFeuf8ABnexX/gmZ4ujIyB8Qrv/ANI7av35/a5/Ya/ZX/bv8I6b4H/a08H23jLSNEvG1Cxtp554TFOUMbOr20kf3gQhySuenSui/ZW/ZE/Zw/Yj+HUvwl/Zb8J2vg3w3dXsmoTWVq88ge5Mao8he4aQ8KiDl8bV4GTTGkflD/wdDPt/4IwfEoMet/oy/j9ujr8X/wDgyl3Hw5+0RbgcCfQWDds7bziv7IP2l/2bfgV+178G9T+Av7RegReJvCeqNDNd2Ess0Ku8Ll4W3QtHLhXXOcjlQOQa8y/Y+/YD/ZB/YI0rW9N/ZL8D2ngyDxG0cup/Z5riU3Btg/lE+e7cRhzh02r8x44pabjtpc8l/wCCxbiD/glZ+0HJn5V8C6kfyiFfxE/8Gb1k0n/BRfxzdMMpb/Dy6zwejXtmMV/or/Fv4YfD/wCNfw01/wCEPxT0lNZ8NeJrCbTdUsJmKpNbygq6FoirDI+XerDkDkdK+PP2RP8AgmB+wf8AsJ+LNU8f/so/Dmy8HazrFj/Z95dwTXkzSW28S7CLiSUKu5EJYBc7cZHSiRJ/G3/wdV/8Etfin8Pv2h7n/gpb8F9NlvPCnibyB4nkskJk0zUrdEjS5kCj5YbhFQ+YeFkUhipZSfqD9hv/AIPCfhTpnwW0jwX+3j4K16XxbpFvHa3GueHVgnh1AIoVZpoJ3jaKZgPnCMyliWGPuj+2fWdH0zWdMudK1m0juLS7iaGeG4jV4njOVKyIwKuh5Vty7SK/FD4pf8G6X/BIn4s+KZfFWt/CO00m5uXLSLol3d2MLHdliIIpNic/3Qo9qSfQbt2P5X/+Cl//AAdB/tMftieJdA+DP/BM+y8R/DWwW8Um8tWT+2tTmb5Y4FS3D+XHz9xGdnbaTgDbX9aX7Evwf/bA+D//AASw8Tzf8FAPGep+NfihrvhvU9U1c6pIJX01Gsn8qwQjCbo0wZMZ/eM452ivpH9kb/glT/wT6/YX1IeIP2Zvhfo+ha6qBV1aZXvL4A7gNlzcM7IOuShUkdc192+K9B0Pxb4Vv/CeuQB7HUrWayuImbAMEyMkikrtZQytjfgbTwKPMa9D/LI/4NYpVH/BZfwBzwdJ1bHt/oUn8gtf6pssg2l/b+Yr8yP2YP8Agjd/wTZ/Yz+K1n8a/wBmz4WW3h3xdp8c0NvqMV5fzPGsytHIoWaWVdroSuSvTJB4FfpdI29QT8vHP4dMCqJP8nb/AIOR5Gvv+C0nxjXrsuNNhPH93TrWv9N7x58Mta+JX7E2qfCLw7hb/wAQeAZdFtdwIBmudMEMY6dC5A9Oa+b/AI4/8EYv+CZH7Tvxj1n9oD4+fCTT/Evi7XpVmvtQmu7xTK0UYjTdHFcRooCRoowoX2LZr9NbLTrDTbCHR7CPyra2hW2ij/upGoCDPXAAApcqA/x/f+CYv7Zurf8ABJ3/AIKA6H8ffiH4UudVk8Jm80bW9ELC2uU82M286qHGBLEy7lRxhiACVBJH+nx/wTI/4KZ/Cf8A4KmfBHWPjh8GNB1Pw7pmg6w+h3FvrOwzGVYEm3L5DsgTEmzls5BOOlL+0t/wSh/4J0/ti+LLjx3+0T8INB8Q6/Og+0aoFktbuXAIXfPavEzkAAZfceK9m/ZA/Yi/Zj/YP8CXvwr/AGVPC6eE9D1G/bU7m1imuLhpbgx+X5m65MhA2RKvDbePemB9ZSt1x93tX8q3/B3nd+T/AMExfD9r/FN46sccHnFvcn9MV/VAzA58s4FfMf7Uf7IX7Nv7afgC3+F37T/hK18ZaHYXq6jBZ3byxqlxGjqr/uZI+NrkZLFRuPHFAH8vv/Bm45H7IPxah/ueMLYZ7AGyQjH1xX1v/wAHZ04T/gkpMF483xjpCj8pm/pX7gfsufsWfsq/sS+FtS8F/sr+DLPwRp+t3Ivb6CxaQiWeNCiu3mM+CEACkEL7VsftNfsqfAT9sf4ZSfBf9pzwzD4w8NNexah9guXkhUTw7xG5aFlchckZBx2bNAktbn8gP/Blam/Sf2gIAfuz6GTjpyt1/hX87H/BWg+R/wAF0/ixOPuR/ElSf+/1uefyr/Th/ZG/YM/ZI/YLTXR+yV4HtPBcfiP7O+o/ZHnkE3k71gY+ezgBd5ycgfMTyRXiPxJ/4I7/APBNT4x/GnVf2iPir8HtJ1rxnrl//aV9qM094GkuVORLtWVUXmNRwAueME0lsVY/SdrYFznG4dT/AMBFfwR/8HnayN8S/gBbbDxpGrtkDj/j4txX99DyqSe/vXwv+19/wTf/AGKv29NU0LVP2sfANp4xu/DsMtvpks891EYY5mDyKPs8kI2syD5mz7Uybo/nR/4J1fsw+NP2zP8Ag1RvP2ffhrGreJNbh1k6TCTgTXVrqj3McIPODKU2LnuwHFfzF/8ABGH/AIKgj/gj7+1P4m174reCbrWdF162/sLxDYR4g1CzNtNv3RJJhTIjqY5IpCoYE/MGWv8AUR/Zr/Zw+Cf7JHwX074Ffs9+HU8M+EdMeSW2063eWUKbp3kdg9wXcBny7Hce+AOK+MP2uP8Agjz/AME9P22fF0nxB/aA+GWnaj4knGJtXs2l069mCjaPNktmQSkKMBpNxx0NPqQfhf8AHz/g6G0v9q7w7/wyt/wS4+GXinWPiz8QIW0bSbrVEt7dbOS5Xa0yRwyTF3RdxDuyRpjcx2g1/Jj/AMElNF1PwV/wWQ+DHhnxBIr3+lfEK3sbp1O5TLHK8chB/iBbPPev9OP9i3/gmb+xF+wD9qvf2X/h5p3h3Ub6Iw3GqSPLcXskXJ2NdXW+RYvlGVTaDxuyRXj3gn/gin/wTJ+FXxk039oLwB8KLTTfFui6j/a9nqK3N4WjuldpPMCNIUJDZbBUrgYxRZlRasfzif8AB6NPv0z9n224yZNab9LQV+t//BrPIx/4I9+C9wwBrushcdD/AKZX6pftcf8ABP8A/Y9/bsGix/tbeBbXxoPDJmOnC5muIjbifHmFWt3iJV/LUZbPK8da9e/Z3/Zz+Bf7Jnwrsvgt+zn4btfCvhPTZJpodPtpJnjV5iWlYNMzyfMeS+7AxwMmpsh3VkfD/wDwXDmW0/4JG/tAEHr4SmX83jX+tfx1f8GdUbP/AMFAPiKcY2eApiPbN9agfqa/0GPjB8Jfhr8efhprXwc+L+kQeIPDXiG2a01LTbkuqSw5DbWMZjYLkA7gw6Dp0r5W/ZR/4Jp/sM/sNeMNW+IH7Kfw5svBWra1ZHT726tZrqYvB5gkEZW4klVV8xFO4bdx2rnHFO3USatY/iz/AODov/glf8R/hT+0fq//AAUQ+FGkzX/gDxyyP4iktULHS9UCLE7zhANsF0FWSOXlRKGVsMVz9OfsDf8AB214L+GvwB0T4Uftv+Cdc1rxN4dtEsote0EwN9uhgXYr3EU7psnCKEd0LKxBb5eRX9xGsaTpWuaTdaB4hs47uzvomhuLW5jWWKWNty+XIjIQ6N0bcu09PSvwo+Lv/Bun/wAEn/ip4nn8US/DEaFPMTJJHoF5dWULNk9IFYomOcBVUYHQZoXkD9D+Mz/gr1/wWT+Nf/BZf4neEvgb8EPCOoaF4Q0u9P8AYnh6A/aNQvr+YeWJphEDl1HyRRJuVVLfMeo/sV/Zf/4I4x+HP+CItx/wTS+NV0kfibxpYzalrN6uZlsdZuJFuLd0IJ3rZukaPswH2vg/MK+9P2Ov+CXX7DH7C8/9vfs5fDrTdC1nyyh1eQtdX5XkYW5uSzovr5WB6iv0F27hsIGPQ/5/pVJAf5Sf7F/7U37U/wDwb+ft+a1o/wATvCsr3FujaJ4q8NzsYkvrQyB45raQfK21gJLaUblYHbjDNj+nD4pf8HfX7F9h4HfVPhP8PPFmueI3j/d2Oqi0tLcOoBUS3CSzNsz94JHnA4POa/o6/a0/YT/ZR/bX8PR+Hv2mfAumeLUtY2W2uLuH9/ADn5be4iKTxD1CvtPpX5O+Hv8Ag2X/AOCU+geJ08QnwLeX6wsHFjearetA/BwrLkMUPH8WOKLMV11R/OT/AMEp/jp/wVh/4Kxft/R+K9c+JPi+x+GGmauNe8VxaZe3EGk20CSCaLT4ERti+aVSNIuT5e5m+VS1f6IzytuL4C57Lxj6V5p8IPgp8KfgH4Cs/hr8G/DuneFtA09cW2n6ZBHbQxgklm8tc5zxud8sT3r0zywAMY49On4e1NKwiJABgYwKc23HFTEDHvUGGpgLswAe1NowR1pCcDNAFeTrjPy0xhtwakpqsGGKeoDZHG3dULtxkVKwwNi4NRhdvFIBRgfLVd9u3Ofyqwefaq+wDnFAEf7umt0/2asMvQioHBzz0oArFQOV6UwoQcnp2qeQCMYXvUar8wFAEKgZLVC4I/4F0q2YxvP8qiIBAyMYquUCOkJB/Clx+lQtg9KXKwG9U9DUZPyBT1qTG7kdqjfb+NC3AYcduaY2NtPYA4+lMf7tHMwKfze9Hze9TUUczA//0v69wu3lOtSr83HQ+1R05Dhga6Vuc5OMZ5qYcv8AhUQ+VqlRsr9OlOSAsqOmakZPT/P61HUqt5i1CQCR96sL93rVdVIp6tjFMCZepqWMjOBzUKcZp+7uuM0AWQQRkUU1eVFOp2YAox92phw/qKhqcKAcih7gOH38Dj6VKMd+1Q1JF9yi7AfwR7VMnSoqfGwUZP6UgLgAHSgNluP4ai3DIC9DTaALW5Sfl7U4sScfyqDcOAtTxMq8YwVoAco2qM0MrYySOKdSHHegB0ar0an4j8zC+lR0UAWgQBtGMCm0wHIDYyBx9P5U4nAyajlYEijJ57U4DJ/CmK2VyKFOQCfSkAijJxUh+UeXjmo1OVyflNSDl89hQAIu0YoGScDjFJvxx/F/n2po+VvSgCyr5yp496cp/h/z/n8ahA468UA5FAFj5cbQBtFHykD5Rx6U1HXdtxT6AHJ02+h3UBiX3e9NooAsrJlue1cz8RPDNv47+HWv+BZJhbprGl3Vi0oXPlLcwvCWK9CE3buvPTiugTrUqv0ZOMHI9qDWex/LH/wSz/4Nr5P+CZ37afh79raX4vr4vGgWt7af2Z/ZBtd/2u3kg3CY3UqrsJ3YZMEDG7tX9VJOE256cVmn92+MfKBj8OuPp7VIDuPB4/SgrQmEmEEadql8wkhjVQAqTS0AtibAJyep/wD1fyoPZffNR9MGmkZbdQQfnZ/wVM/4J76J/wAFQv2Trj9ljWPFk3guGTV7XVWv4LVbtv8ARA5WPy2kiAB3fe3HGMY5r5u/4Iz/APBGPTf+CQ9l8RNN0fx/J4/Xx3PYSfvbAWJgNj5wADedKrhzLgt8qgBcA5r9p1cp+RH4HrTtwZcbB1zQBceZdg8pty9j0/TtS54/z9Kq0oODmgCxv/wpd7VCzgjAFAfop5oAnLEjGPf8hj+XH0oDFWyOp5pme3pTCQB2zQA8e/8An/OBSh+f73/1qrU7IB5OKColnzlH3OPp7UCZj7YqpSgkdKB8qLG7jH8PpSGUoDtP+RVV/u0BDt49KCBNykAHt2qQlmO48mq3QY7VKCAAKAJ0coc0qso6cVFUTNz8oz60AXDcYXHp0FVGmL8/pTgqkZpuOfQUAAfA/wA/4UokIAROi/pmkYjG2odwUYBoAkd8E7j1qqzDb8owvpSycnB5pKC7oRupbHNRbiOo+7/XrT2YKCR9KiYsAQf8P5UE86HmRic03d6dc5/GoSw8sAD/AD+lKD3PAFBPMiXccFhyT19T2/lUXmKDtXgdaiMqu3y5GOtLTuwa6j0fAwBj/P0o3LnfsG6mUUczIH7/AP63+fwpnQ59Mfp0/KnZ46U2jmYAWIU46VDuIGKWUkLxSbjjH+f5URkArtnrxn9e1QSttwAf8jpTnb86hIyMU4gN+XGOMUpPGRShUA5qPDA8VasBEBjPvTgoC8+v86kfpUVPmAQ4U+x/nUTKSelPbnCCm7iMr3H5YqQI2I2/KKi8xv8AP/6qkGCCR3pg+VsGqiAjMTx/n+QqOTaQdnHNWDtHWoWUE8dBUgVnO3gjpxUI6fu6usuf8/8A16rPwMUAQn/WGloooAKaJATj/P8AKnVDGuOnFO2gD2GEIqqWz97pVpyMYxUHy7faphuBDTW/1g+lTvt3Z7Dj/PWoqvQCvTH6VO46EVA23O0npS5WBCSP9XUDfIeanYR7eRVfaDT2AC22mNtKfd+bNOKKRikJ3DatUBGwwcCo36VY2qE5PNRVDjbUBnlj1/T/AOvR5Y9f0/8Ar0vmL/n/APVR5i/5/wD1U7oD/9P+vinKQGFRn7wp1dBzlinoOarrLuOAKeDu69qAL0ZyKcj4JKioE4I9Klj71aAm3Zxnr+lOdSG3N29KRc/dWmVKQFyM7hu/hpAm05OKVBhdx60fu6uyAlXJbrU9VgQuAKnUkdTS5kJIeMA5IqRSpGKip69mXp0qdRktPiYEYHWmUDjpSAsU9WCjmodwCj/P9KcAB0prcCcMDTqjVnPXpUlIBR1FTBhnBXg1BSrgDJPFAFtGHSn4B6fequuVA9an3rQA7joaQYA9qUHuKQmP0oAUHIzUuQfmNQgg/L6UqlQOlAFuLGOKXgNUCdKmTrUyVgI0PPIqbDe1NDnbjAqMEknNSBLtRulDjH4U2MANUpGRigCIHB9RUoAHSoABuAI6VMWUEUAOHHSrAYdB1qvT1K54XmgCQYxxS0nytxS0AKSUPNNj+RvUUjAsQfSnUG/QXJDHHGeKnUJs4/Kq9KPbigzRNuAGaRHG/wBBiolxkVM5GPmAoKTXYWimLgn8KFDBcnpQVZD6d9w+Z1xTacuMcYoIJQQMA96WoOd3vUitg46UAPpSSMHjBpCcDNNCoynnJoAdnPTvRQo2gdOKKACmnvnpTqb2weKAAe3SnUwNt+Vh/n/PvSgoTk8UAPOO1QNJgcCl3YbjpTKAFzu+f7uKYJMnzDz7U6gAZAoKiKM+/wCQqaMYGDxRhaWgkQKB0pH+7TGIHEfJ9KgeUt7UD5WG7AGP8/zqOiigQ3aB04oLKtNaQJyR7UzJzmgzGt79KjU4yQcVKoG4n2oVjt5FA7sg78VGZMkxsOPWpGbeOOCKQIxyD1/TFAhgKqOKVWB4oCJt4pUj449f896B8zHqvUmm1I/Hy+lIF7/dFAhoJHSmMp3Ag8VKWA4HSozjtxmgCJzg5NMIA5HpSycdeaiZg64FWtgGg7+nWkpAMClqlEAoophbseDRZgMYkmm0Uzn+7SAcWC9agpzEHoMU2gBAAOlMPzkj0/z7VJURUDLGmtwF3fJtI+ao6C3QGmOSuO1IBxIAzVR+SBU7MCMAVAW+XI/hoAjPHTmhfm6d6KUdRQA1hh8e1AGBinP940lAEMnynJGKbx2opADySaAI3wARj3qMHIzT5f6UwdBTtpcBA/AFQyhmNS8nnHSoC38bcURYEToP8/8A66Yyr9Kexyc1GSRkVYEYBPSosbDnt/n61KGGAo7daa4JHFTHQCuehwKaC+OB8tPpyop/CmgG0U7y2/z/APro8tv8/wD66OVAf//U/r3x81LSd6WulbnOFSR96jqSPvV2QFyH7hp6daZD9w09OtTICdPu/jUuFqJPu/jU1SAwffCdqsp92qw/1oqyn3aAEP3wKsL1NVz98VYXqaAH0If3rR9vSikT/j4b/PrQBLH3qVBnGaij71LH1FADj9wVOPumoD9wVOPumlEBtTn7g+lQVOfuD6UwJ9i+X0HSqy9x6Vb/AOWf4VUXqazAtj7gooH3BRWiAnHQUtIOgpaAEY4GaWmv92nUAPTrT0+7TE609Pu0ANj71JUcfepKmQEmMOMVJTD98U+pATC0xRmT8akqNP8AWfjQXEeOp+tLSDqfrS0EDk+9U1Qp96pqACiiigAooooAYv8ArT9KtDoKqr/rT9KtDoKC1uSx96b/AA06PvTT92szUQdRSsqqeKQdRTn61ogGVYqvVigzK9FFFADt7U2iigBQSOlSN1FRVK3UUANfrTKe/WmUAPP3BTKefuCmUAFFFFAFioSTuzU1QHqaDQicndUdPfrTKCJBUcnapKjk7UGRX+8xB6VNGoIqFfvmp4ulBoIn3qZNwRinp96mT9RQZkFFFFABUyDCioamT7tAA/3vwpv/ACzpz/e/Cm/8s6a3AgTpSSdqVOlJJ2pCWxDN96oamm+9UNaIYUUUUQAQ9DUUv+rqU9DUUv8Aq6AG0u1dv40lO/g/GgCrUTEhjipahf71AD0JOaJOi/Skj70snRfpT6AV26ih+lDdRQ/SkAP0qHAxipn6VFQAmFpjqAKkpj9KAIqjcnNSVE/WgBlFFFAEM33abTpvu02rkAxPufjUD/dqdfuH61A/3aXQBiKuBx2plSp0X6VFVAQfdJxRkkYoPU0lS9wK9Tx9BUFTx9BVALRRRRZAf//Z";

// ── DEMO DATA ─────────────────────────────────────────────────

const DEMO_ACCOUNTS = [
  {id:"acc1",biz:"Torres Towing LLC",contact:"Miguel Torres",email:"mtorres@torrestowing.com",phone:"(555) 234-1122",address:"45 Main St, Nashua, NH 03060",industry:"Towing & Recovery",dateStarted:"2018",notes:"Strong credit, loyal customer. 8 years in business. Fleet of 6 trucks.",createdAt:"2026-02-18T10:30:00Z",vault:[{id:"v1",name:"Torres_DL_Front_Back.jpg",at:"2026-02-18T10:31:00Z",by:"admin",fromDeal:"d1"},{id:"v2",name:"Torres_CreditApp_2026.pdf",at:"2026-02-19T09:00:00Z",by:"admin",fromDeal:"d1"},{id:"v3",name:"Torres_Bank_Statements_6mo.pdf",at:"2026-02-19T08:00:00Z",by:"admin",fromDeal:"d1"}],activities:[{id:"aa1",type:"call_cust",who:"customer",detail:"Initial call — great rapport, expanding fleet",at:"2026-02-18T15:00:00Z"},{id:"aa2",type:"email_cust",who:"customer",detail:"Sent approval details and next steps",at:"2026-02-22T14:30:00Z"}]},
  {id:"acc2",biz:"Granite State Excavation",contact:"Dan Murphy",email:"dan@graniteexcavation.com",phone:"(603) 555-8877",address:"120 Industrial Way, Concord, NH 03301",industry:"Excavation",dateStarted:"2015",notes:"Spring project deadline. May need 2nd piece of equipment.",createdAt:"2026-02-20T08:15:00Z",activities:[]},
  {id:"acc3",biz:"Apex Hauling Inc",contact:"Sarah Chen",email:"schen@apexhauling.com",phone:"(555) 901-3344",address:"",industry:"Hauling",dateStarted:"",notes:"Website inquiry — not yet qualified.",createdAt:"2026-02-23T01:00:00Z",activities:[]},
  {id:"acc4",biz:"JR Builders",contact:"James Richardson",email:"jr@jrbuilders.net",phone:"(555) 776-2100",address:"88 Elm St, Manchester, NH 03101",industry:"Construction",dateStarted:"2012",notes:"Sent credit app link, waiting on docs.",createdAt:"2026-02-21T15:45:00Z",activities:[]},
  {id:"acc5",biz:"Coastal Recovery Services",contact:"Mike Devlin",email:"mdevlin@coastalrecovery.com",phone:"(207) 555-6600",address:"310 Harbor Rd, Portland, ME 04101",industry:"Towing & Recovery",dateStarted:"2019",notes:"Good relationship. Looking to add a 2nd truck next year.",createdAt:"2026-02-10T12:00:00Z",activities:[{id:"aa3",type:"call_cust",who:"customer",detail:"Confirmed equipment specs with Mike",at:"2026-02-10T14:00:00Z"},{id:"aa4",type:"call_cust",who:"customer",detail:"Discussed next truck purchase for Q4",at:"2026-02-22T11:00:00Z"}]},
  {id:"acc6",biz:"Summit Earthworks",contact:"Tom Healey",email:"tom@summitearthworks.com",phone:"(802) 555-9900",address:"5 Quarry Rd, Burlington, VT 05401",industry:"Earthwork & Grading",dateStarted:"2010",notes:"Funded deal. Has 3 more pieces to finance this year.",createdAt:"2026-01-15T09:00:00Z",activities:[{id:"aa5",type:"call_cust",who:"customer",detail:"Discussed upcoming equipment needs for 2026 season",at:"2026-02-20T10:00:00Z"}]},
];

const DEMO_DEALERS = [
  {id:"dlr1",name:"Northeast Truck Sales",contact:"Rick Brennan",email:"rick@netruck.com",phone:"(603) 555-2200",region:"New England",specs:["Tow Truck","Flatbed","Semi Truck"],code:"NTS2026",active:true,referralPts:3,salesRep:"Tommy Gallagher",salesRepPhone:"(603) 555-2210",salesRepEmail:"tommy@netruck.com"},
  {id:"dlr2",name:"Milton CAT",contact:"Angela Ruiz",email:"aruiz@miltoncat.com",phone:"(508) 555-4400",region:"Northeast",specs:["Excavator","Loader","Bulldozer"],code:"MCAT2026",active:true,referralPts:2,salesRep:"Jake Moreno",salesRepPhone:"(508) 555-4411",salesRepEmail:"jmoreno@miltoncat.com"},
  {id:"dlr3",name:"Atlantic Truck Center",contact:"Dave Kohler",email:"dkohler@atlantictruck.com",phone:"(207) 555-8800",region:"New England",specs:["Tow Truck","Flatbed","Semi Truck"],code:"ATC2026",active:true,referralPts:0,salesRep:"",salesRepPhone:"",salesRepEmail:""},
  {id:"dlr4",name:"Bigge Crane & Rigging",contact:"Pat Simmons",email:"psimmons@bigge.com",phone:"(510) 555-1100",region:"West Coast",specs:["Crane"],code:"BCR2026",active:true,referralPts:1.5,salesRep:"Dennis Park",salesRepPhone:"(510) 555-1108",salesRepEmail:"dpark@bigge.com"},
];

const DEMO_DEALS = [
  {id:"d1",accountId:"acc1",biz:"Torres Towing LLC",contact:"Miguel Torres",email:"mtorres@torrestowing.com",phone:"(555) 234-1122",eqType:"Tow Truck",eqDetail:"2025 Kenworth T370 Jerr-Dan",eqYear:"2025",eqMake:"Kenworth",eqModel:"T370 Jerr-Dan",eqVin:"1NKZL70X5RJ412885",eqMileage:"0",amount:185000,stage:"approved",source:"Jotform Application",notes:"Strong credit, 8 years in business.",createdAt:"2026-02-18T10:30:00Z",updatedAt:"2026-02-22T14:00:00Z",dealerId:"dlr1",dealerName:"Northeast Truck Sales",code:"TOR-7721",lenderId:"l1",terms:{amt:185000,pmt:4082.62,months:60,rate:"5.2%",buyRate:5.2,points:10,feeAmt:18500,dlrPts:3,dlrFee:5550,financedAmt:209050},docs:[{docId:"credit_app",name:"Torres_CreditApp.pdf",at:"2026-02-18T10:30:00Z",by:"customer"},{docId:"drivers_license",name:"Torres_DL.jpg",at:"2026-02-18T10:31:00Z",by:"customer"},{docId:"bank_statements",name:"Torres_Bank_3mo.pdf",at:"2026-02-19T08:00:00Z",by:"customer"},{docId:"equipment_quote",name:"KW_T370_Quote.pdf",at:"2026-02-18T15:00:00Z",by:"dealer"}],accepted:null,taxChoice:null,emailConfSent:"2026-02-18T10:30:00Z",emailCodeSent:"2026-02-18T15:30:00Z",activities:[{id:"a1",type:"call_cust",who:"customer",detail:"Verified business info and equipment needs",at:"2026-02-18T15:00:00Z"},{id:"a2",type:"email_dlr",who:"dealer",detail:"Sent Rick the app status update",at:"2026-02-19T09:15:00Z"},{id:"a3",type:"call_lndr",who:"lender",detail:"Followed up with Channel Partners on approval timeline",at:"2026-02-20T14:00:00Z"},{id:"a4",type:"email_cust",who:"customer",detail:"Sent approval details and next steps",at:"2026-02-22T14:30:00Z"}],history:[{s:"new_lead",d:"2026-02-18T10:30:00Z",n:"Application via Jotform"},{s:"contacted",d:"2026-02-18T15:00:00Z",n:"Called Miguel, verified info"},{s:"app_submitted",d:"2026-02-19T09:00:00Z",n:"Sent to 3 lenders"},{s:"in_review",d:"2026-02-20T11:00:00Z",n:"Under review with Channel Partners"},{s:"approved",d:"2026-02-22T14:00:00Z",n:"Approved — 5.2% / 60mo"}]},
  {id:"d2",accountId:"acc2",biz:"Granite State Excavation",contact:"Dan Murphy",email:"dan@graniteexcavation.com",phone:"(603) 555-8877",eqType:"Excavator",eqDetail:"CAT 320 Next Gen",amount:275000,stage:"in_review",source:"Dealer Referral",notes:"Needs fast turnaround for spring project.",createdAt:"2026-02-20T08:15:00Z",updatedAt:"2026-02-22T11:00:00Z",dealerId:"dlr2",dealerName:"Milton CAT",code:"GRA-4455",lenderId:null,terms:null,docs:[{docId:"credit_app",name:"GraniteState_App.pdf",at:"2026-02-20T08:15:00Z",by:"customer"},{docId:"equipment_quote",name:"CAT320_Quote.pdf",at:"2026-02-20T08:16:00Z",by:"dealer"}],accepted:null,taxChoice:null,history:[{s:"new_lead",d:"2026-02-20T08:15:00Z",n:"Dealer referral from Milton CAT"},{s:"contacted",d:"2026-02-20T10:00:00Z",n:"Spoke with Dan"},{s:"app_submitted",d:"2026-02-21T09:00:00Z",n:"Submitted to lenders"},{s:"in_review",d:"2026-02-22T11:00:00Z",n:"Pending with two lenders"}],stips:[{id:"st1",text:"Bank Statements (6 months)",done:false,addedAt:"2026-02-22T12:00:00Z"},{id:"st2",text:"Tax Returns (2 years)",done:false,addedAt:"2026-02-22T12:00:00Z"},{id:"st3",text:"Profit & Loss Statement",done:true,addedAt:"2026-02-22T12:00:00Z"}]},
  {id:"d3",accountId:"acc3",biz:"Apex Hauling Inc",contact:"Sarah Chen",email:"schen@apexhauling.com",phone:"(555) 901-3344",eqType:"Semi Truck",eqDetail:"Peterbilt 579 Day Cab",amount:165000,stage:"new_lead",source:"Website",notes:"Website inquiry.",createdAt:"2026-02-23T01:00:00Z",updatedAt:"2026-02-23T01:00:00Z",dealerId:null,dealerName:"",code:"APX-9102",lenderId:null,terms:null,docs:[],accepted:null,taxChoice:null,history:[{s:"new_lead",d:"2026-02-23T01:00:00Z",n:"Website inquiry"}]},
  {id:"d4",accountId:"acc4",biz:"JR Builders",contact:"James Richardson",email:"jr@jrbuilders.net",phone:"(555) 776-2100",eqType:"Loader",eqDetail:"John Deere 644 X-Tier",amount:310000,stage:"contacted",source:"Phone Call",notes:"Sent credit app link.",createdAt:"2026-02-21T15:45:00Z",updatedAt:"2026-02-22T09:30:00Z",dealerId:null,dealerName:"",code:"JRB-6630",lenderId:null,terms:null,docs:[],accepted:null,taxChoice:null,history:[{s:"new_lead",d:"2026-02-21T15:45:00Z",n:"Inbound call"},{s:"contacted",d:"2026-02-22T09:30:00Z",n:"Sent credit app link"}]},
  {id:"d5",accountId:"acc5",biz:"Coastal Recovery Services",contact:"Mike Devlin",email:"mdevlin@coastalrecovery.com",phone:"(207) 555-6600",eqType:"Tow Truck",eqDetail:"2026 Ford F-650 Century",eqYear:"2026",eqMake:"Ford",eqModel:"F-650 Century",eqVin:"1FDNF6FC0RDA09344",eqMileage:"12",amount:142000,stage:"docs_out",source:"Dealer Referral",notes:"Approved with Navitas. Docs sent.",createdAt:"2026-02-10T12:00:00Z",updatedAt:"2026-02-22T16:30:00Z",dealerId:"dlr3",dealerName:"Atlantic Truck Center",code:"CST-3318",lenderId:"l2",terms:{amt:142000,pmt:2975.52,months:60,rate:"6.1%",buyRate:6.1,points:8,feeAmt:11360,dlrPts:0,dlrFee:0,financedAmt:153360},docs:[{docId:"credit_app",name:"Coastal_App.pdf",at:"2026-02-10T12:00:00Z",by:"customer"},{docId:"drivers_license",name:"Devlin_DL.jpg",at:"2026-02-10T12:01:00Z",by:"customer"},{docId:"bank_statements",name:"Coastal_Bank.pdf",at:"2026-02-11T09:00:00Z",by:"customer"},{docId:"equipment_quote",name:"F650_Quote.pdf",at:"2026-02-10T14:00:00Z",by:"dealer"}],accepted:true,taxChoice:false,emailConfSent:"2026-02-10T12:00:00Z",emailCodeSent:"2026-02-10T14:30:00Z",activities:[{id:"a5",type:"call_cust",who:"customer",detail:"Confirmed equipment specs with Mike",at:"2026-02-10T14:00:00Z"},{id:"a6",type:"email_lndr",who:"lender",detail:"Submitted to Navitas and CPC",at:"2026-02-11T09:00:00Z"},{id:"a7",type:"call_dlr",who:"dealer",detail:"Checked with Dave on title status",at:"2026-02-22T10:00:00Z"}],history:[{s:"new_lead",d:"2026-02-10T12:00:00Z",n:"Dealer referral"},{s:"contacted",d:"2026-02-10T14:00:00Z",n:"Verified"},{s:"app_submitted",d:"2026-02-11T09:00:00Z",n:"Submitted to Navitas & CPC"},{s:"in_review",d:"2026-02-14T11:00:00Z",n:"Under review"},{s:"approved",d:"2026-02-19T10:00:00Z",n:"Approved — Navitas 6.1%/60mo"},{s:"docs_out",d:"2026-02-22T16:30:00Z",n:"Docs sent for signing"}],fundingItems:[{id:"fi1",text:"Final Invoice",file:"F650_Final_Invoice.pdf",done:true,addedAt:"2026-02-19T12:00:00Z",resolvedAt:"2026-02-21T09:00:00Z"},{id:"fi2",text:"Title Copy",file:null,done:false,addedAt:"2026-02-19T12:00:00Z"}]},
  {id:"d6",accountId:"acc6",biz:"Summit Earthworks",contact:"Tom Healey",email:"tom@summitearthworks.com",phone:"(802) 555-9900",eqType:"Bulldozer",eqDetail:"CAT D6T LGP",amount:395000,stage:"funded",source:"Dealer Referral",notes:"Funded and complete.",createdAt:"2026-01-15T09:00:00Z",updatedAt:"2026-02-15T11:00:00Z",dealerId:"dlr2",dealerName:"Milton CAT",code:"SMT-7701",lenderId:"l4",terms:{amt:395000,pmt:7002.32,months:72,rate:"5.8%",buyRate:5.8,points:5,feeAmt:19750,dlrPts:2,dlrFee:7900,financedAmt:422650},docs:[{docId:"credit_app",name:"Summit_App.pdf",at:"2026-01-15T09:00:00Z",by:"customer"},{docId:"equipment_quote",name:"D6T_Quote.pdf",at:"2026-01-15T09:01:00Z",by:"dealer"}],accepted:true,taxChoice:true,history:[{s:"new_lead",d:"2026-01-15T09:00:00Z",n:"Dealer referral"},{s:"contacted",d:"2026-01-15T11:00:00Z",n:"Verified"},{s:"app_submitted",d:"2026-01-16T09:00:00Z",n:"Submitted"},{s:"in_review",d:"2026-01-20T10:00:00Z",n:"Under review"},{s:"approved",d:"2026-01-28T14:00:00Z",n:"Approved with Amur"},{s:"docs_out",d:"2026-02-03T09:00:00Z",n:"Docs sent"},{s:"funded",d:"2026-02-15T11:00:00Z",n:"Funded!"}]},
];

// ── UTILS ─────────────────────────────────────────────────────

const fmt = v => v ? new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(v) : "$0";
const fDate = d => d ? new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}) : "";
const fDT = d => d ? new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}) : "";
function relT(d){if(!d)return"";const m=Math.floor((Date.now()-new Date(d).getTime())/60000);if(m<60)return`${m}m ago`;const h=Math.floor(m/60);if(h<24)return`${h}h ago`;const dy=Math.floor(h/24);if(dy<7)return`${dy}d ago`;return fDate(d)}
const gId = () => "d"+Date.now().toString(36)+Math.random().toString(36).slice(2,6);
const gCode = n => {const p=(n||"AVT").replace(/[^A-Z]/gi,"").slice(0,3).toUpperCase();return`${p}-${Math.floor(1000+Math.random()*9000)}`};

// ── ICONS ─────────────────────────────────────────────────────

const I={
  Pipe:()=><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><rect x="3" y="3" width="5" height="18" rx="1"/><rect x="10" y="8" width="5" height="13" rx="1"/><rect x="17" y="5" width="5" height="16" rx="1"/></svg>,
  List:()=><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><circle cx="4" cy="6" r="1" fill="currentColor"/><circle cx="4" cy="12" r="1" fill="currentColor"/><circle cx="4" cy="18" r="1" fill="currentColor"/></svg>,
  Plus:()=><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
  Search:()=><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
  X:()=><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
  User:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
  Truck:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>,
  Edit:()=><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
  Trash:()=><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
  Phone:()=><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
  Mail:()=><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>,
  Bldg:()=><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="9" y1="6" x2="9" y2="6.01"/><line x1="15" y1="6" x2="15" y2="6.01"/><line x1="9" y1="10" x2="9" y2="10.01"/><line x1="15" y1="10" x2="15" y2="10.01"/><line x1="9" y1="14" x2="9" y2="14.01"/><line x1="15" y1="14" x2="15" y2="14.01"/><line x1="9" y1="18" x2="15" y2="18"/></svg>,
  Eye:()=><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
  Check:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
  Send:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
  Copy:()=><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
  Back:()=><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
  Archive:()=><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></svg>,
  Refresh:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>,
  Shield:()=><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
  Doc:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>,
  Upload:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
  Download:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
  Dollar:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
  Gear:()=><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
  CheckCirc:()=><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
  Star:()=><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="1"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>,
  Logout:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
  Alert:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
  Clip:()=><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>,
  FileText:()=><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>,
};

// ── DATA CONTEXT ──────────────────────────────────────────────

const Ctx = createContext(null);

// ════════════════════════════════════════════════════════════════
// MAIN APP
// ════════════════════════════════════════════════════════════════

export default function App() {
  const [deals, setDeals] = useState(DEMO_DEALS);
  const [dealers, setDealers] = useState(DEMO_DEALERS);
  const [lenders, setLenders] = useState(LENDERS_INIT);
  const [accounts, setAccounts] = useState(DEMO_ACCOUNTS);
  const [dnotes, setDnotes] = useState({});
  const [portal, setPortal] = useState("crm");
  const [dlrAuth, setDlrAuth] = useState(null);
  const [custAuth, setCustAuth] = useState(null);
  const [toast, setToast] = useState(null);

  // Inject fonts + CSS on mount (SSR-safe)
  useEffect(() => {
    if (typeof document === "undefined") return;
    // Font
    if (!document.querySelector('link[href*="Outfit"]')) {
      const fontLink = document.createElement("link");
      fontLink.href = "https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap";
      fontLink.rel = "stylesheet";
      document.head.appendChild(fontLink);
    }
    // CSS
    if (!document.querySelector('#av-crm-css')) {
      const css = document.createElement("style");
      css.id = "av-crm-css";
      css.textContent = INJECT_CSS;
      document.head.appendChild(css);
    }
  }, []);

  // Persistence via localStorage
  useEffect(() => {
    try { const r = localStorage.getItem("av5_deals"); if (r) { const p = JSON.parse(r); if (p.length) setDeals(p); } } catch (e) {}
    try { const r = localStorage.getItem("av5_dlrs"); if (r) { const p = JSON.parse(r); if (p.length) setDealers(p); } } catch (e) {}
    try { const r = localStorage.getItem("av5_lndr"); if (r) { const p = JSON.parse(r); if (p.length) setLenders(p); } } catch (e) {}
    try { const r = localStorage.getItem("av5_acct"); if (r) { const p = JSON.parse(r); if (p.length) setAccounts(p); } } catch (e) {}
    try { const r = localStorage.getItem("av5_notes"); if (r) setDnotes(JSON.parse(r)); } catch (e) {}
  }, []);
  useEffect(() => { try { localStorage.setItem("av5_deals", JSON.stringify(deals)); } catch (e) {} }, [deals]);
  useEffect(() => { try { localStorage.setItem("av5_dlrs", JSON.stringify(dealers)); } catch (e) {} }, [dealers]);
  useEffect(() => { try { localStorage.setItem("av5_lndr", JSON.stringify(lenders)); } catch (e) {} }, [lenders]);
  useEffect(() => { try { localStorage.setItem("av5_acct", JSON.stringify(accounts)); } catch (e) {} }, [accounts]);
  useEffect(() => { try { localStorage.setItem("av5_notes", JSON.stringify(dnotes)); } catch (e) {} }, [dnotes]);

  const notify = useCallback((msg,t="ok")=>{setToast({msg,t});setTimeout(()=>setToast(null),2500)},[]);

  const saveDeal = useCallback(deal=>{
    if(deal.id && deals.find(d=>d.id===deal.id)){
      setDeals(p=>p.map(d=>d.id===deal.id?{...deal,updatedAt:new Date().toISOString()}:d));
    } else {
      // Auto-create account if no accountId
      let accId=deal.accountId;
      if(!accId&&deal.biz){
        const existing=accounts.find(a=>a.biz?.toLowerCase()===deal.biz?.toLowerCase());
        if(existing){accId=existing.id}
        else{accId="acc"+Date.now().toString(36);setAccounts(p=>[...p,{id:accId,biz:deal.biz,contact:deal.contact||"",email:deal.email||"",phone:deal.phone||"",address:"",industry:"",dateStarted:"",notes:"",activities:[],createdAt:new Date().toISOString()}])}
      }
      setDeals(p=>[{...deal,id:deal.id||gId(),accountId:accId,code:deal.code||gCode(deal.biz),docs:deal.docs||[],stips:deal.stips||[],fundingItems:deal.fundingItems||[],terms:deal.terms||null,accepted:deal.accepted??null,taxChoice:deal.taxChoice??null,showTaxChoice:deal.showTaxChoice??false,lenderId:deal.lenderId||null,history:deal.history||[{s:deal.stage||"new_lead",d:new Date().toISOString(),n:"Deal created"}],createdAt:deal.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()},...p]);
    }
  },[deals,accounts]);

  const moveDeal = useCallback((id,stg,note="")=>{
    setDeals(p=>p.map(d=>{
      if(d.id!==id) return d;
      let updated = {...d,stage:stg,updatedAt:new Date().toISOString(),history:[...(d.history||[]),{s:stg,d:new Date().toISOString(),n:note||`Moved to ${STAGES.find(s=>s.id===stg)?.label}`}]};
      // Auto-add docs_out items (customer needs to provide DL + voided check)
      if(stg==="docs_out"){
        const existing = (updated.stips||[]).map(s=>s.text);
        const toAdd = DOCS_OUT_ITEMS.filter(i=>!existing.includes(i.text));
        if(toAdd.length) updated.stips = [...(updated.stips||[]),...toAdd.map(i=>({id:gId(),text:i.text,done:false,file:null,resolvedBy:null,addedAt:new Date().toISOString(),visibility:"all",category:i.category,auto:true}))];
      }
      // Auto-add funding items (dealer needs to provide invoice + title)
      if(stg==="funded"||stg==="docs_out"){
        const existingFI = (updated.fundingItems||[]).map(f=>f.text);
        const toAddFI = FUNDING_ITEMS_AUTO.filter(i=>!existingFI.includes(i.text));
        if(toAddFI.length) updated.fundingItems = [...(updated.fundingItems||[]),...toAddFI.map(i=>({id:gId(),text:i.text,file:null,done:false,addedAt:new Date().toISOString(),category:i.category,auto:true}))];
      }
      return updated;
    }));
    notify(`Moved to ${STAGES.find(s=>s.id===stg)?.label}`);
  },[notify]);

  const delDeal = useCallback(id=>{setDeals(p=>p.filter(d=>d.id!==id));notify("Deal deleted","info")},[notify]);
  const addDoc = useCallback((id,doc)=>setDeals(p=>p.map(d=>d.id===id?{...d,docs:[...(d.docs||[]),doc],updatedAt:new Date().toISOString()}:d)),[]);
  const rmDoc = useCallback((id,docId)=>setDeals(p=>p.map(d=>d.id===id?{...d,docs:(d.docs||[]).filter(x=>x.docId!==docId),updatedAt:new Date().toISOString()}:d)),[]);
  const toggleDocReq = useCallback((dealId,docId)=>setDeals(p=>p.map(d=>{
    if(d.id!==dealId) return d;
    const reqs = {...(d.docReqs||{})};
    const globalReq = REQ_DOCS.find(x=>x.id===docId)?.req??false;
    const current = reqs[docId]!==undefined ? reqs[docId] : globalReq;
    reqs[docId] = !current;
    return {...d,docReqs:reqs,updatedAt:new Date().toISOString()};
  })),[]);
  const addStip = useCallback((dealId,item,vis="all")=>setDeals(p=>p.map(d=>d.id===dealId?{...d,stips:[...(d.stips||[]),{id:gId(),text:item,done:false,file:null,resolvedBy:null,addedAt:new Date().toISOString(),visibility:vis}],updatedAt:new Date().toISOString()}:d)),[]);
  const removeStip = useCallback((dealId,stipId)=>setDeals(p=>p.map(d=>d.id===dealId?{...d,stips:(d.stips||[]).filter(s=>s.id!==stipId),updatedAt:new Date().toISOString()}:d)),[]);
  const toggleStip = useCallback((dealId,stipId)=>setDeals(p=>p.map(d=>d.id===dealId?{...d,stips:(d.stips||[]).map(s=>s.id===stipId?{...s,done:!s.done,file:!s.done?s.file:null,resolvedBy:!s.done?s.resolvedBy:null}:s),updatedAt:new Date().toISOString()}:d)),[]);
  const resolveStip = useCallback((dealId,stipId,fileName,by)=>setDeals(p=>p.map(d=>d.id===dealId?{...d,stips:(d.stips||[]).map(s=>s.id===stipId?{...s,done:true,file:fileName,resolvedBy:by,resolvedAt:new Date().toISOString()}:s),updatedAt:new Date().toISOString()}:d)),[]);
  // Dealer funding items — required before docs go out
  const addFundingItem = useCallback((dealId,item)=>setDeals(p=>p.map(d=>d.id===dealId?{...d,fundingItems:[...(d.fundingItems||[]),{id:gId(),text:item,file:null,done:false,addedAt:new Date().toISOString()}],updatedAt:new Date().toISOString()}:d)),[]);
  const resolveFundingItem = useCallback((dealId,itemId,fileName)=>setDeals(p=>p.map(d=>d.id===dealId?{...d,fundingItems:(d.fundingItems||[]).map(f=>f.id===itemId?{...f,done:true,file:fileName,resolvedAt:new Date().toISOString()}:f),updatedAt:new Date().toISOString()}:d)),[]);
  const removeFundingItem = useCallback((dealId,itemId)=>setDeals(p=>p.map(d=>d.id===dealId?{...d,fundingItems:(d.fundingItems||[]).filter(f=>f.id!==itemId),updatedAt:new Date().toISOString()}:d)),[]);
  const acceptDeal = useCallback((id,tax)=>{setDeals(p=>p.map(d=>d.id===id?{...d,accepted:true,taxChoice:tax,updatedAt:new Date().toISOString()}:d));notify("Approval accepted!")},[notify]);
  const sendConfEmail = useCallback((id)=>setDeals(p=>p.map(d=>d.id===id?{...d,emailConfSent:new Date().toISOString(),updatedAt:new Date().toISOString()}:d)),[]);
  const sendCodeEmail = useCallback((id)=>setDeals(p=>p.map(d=>d.id===id?{...d,emailCodeSent:new Date().toISOString(),updatedAt:new Date().toISOString()}:d)),[]);
  const addNote = useCallback((id,txt,who="Admin")=>setDnotes(p=>({...p,[id]:[...(p[id]||[]),{id:gId(),txt,who,at:new Date().toISOString()}]})),[]);
  const addActivity = useCallback((id,type,who,detail)=>setDeals(p=>p.map(d=>d.id===id?{...d,activities:[...(d.activities||[]),{id:gId(),type,who,detail:detail||"",at:new Date().toISOString()}],updatedAt:new Date().toISOString()}:d)),[]);
  const addDlr = useCallback(d=>{setDealers(p=>[...p,{...d,id:"dlr"+Date.now().toString(36),active:true}]);notify("Dealer added")},[notify]);
  const updDlr = useCallback(d=>{setDealers(p=>p.map(x=>x.id===d.id?d:x));notify("Dealer updated")},[notify]);

  // Account functions
  const saveAccount = useCallback(acc=>{
    if(acc.id && accounts.find(a=>a.id===acc.id)){
      setAccounts(p=>p.map(a=>a.id===acc.id?{...acc}:a));
    } else {
      setAccounts(p=>[...p,{...acc,id:acc.id||"acc"+Date.now().toString(36),activities:acc.activities||[],createdAt:new Date().toISOString()}]);
    }
  },[accounts]);
  const addAcctActivity = useCallback((accId,type,who,detail)=>setAccounts(p=>p.map(a=>a.id===accId?{...a,activities:[...(a.activities||[]),{id:gId(),type,who,detail:detail||"",at:new Date().toISOString()}]}:a)),[]);
  const loginDlr = useCallback(code=>{const d=dealers.find(x=>x.code?.toLowerCase()===code.toLowerCase());if(d){setDlrAuth(d.id);return true}return false},[dealers]);
  const loginCust = useCallback(code=>{const d=deals.find(x=>x.code?.toLowerCase()===code.toLowerCase());if(d){setCustAuth(d.id);return true}return false},[deals]);

  const ctx = useMemo(()=>({deals,dealers,lenders,accounts,dnotes,saveDeal,moveDeal,delDeal,addDoc,rmDoc,toggleDocReq,addStip,removeStip,toggleStip,resolveStip,addFundingItem,resolveFundingItem,removeFundingItem,acceptDeal,sendConfEmail,sendCodeEmail,addNote,addActivity,addDlr,updDlr,saveAccount,addAcctActivity,notify,setLenders}),[deals,dealers,lenders,accounts,dnotes,saveDeal,moveDeal,delDeal,addDoc,rmDoc,toggleDocReq,addStip,removeStip,toggleStip,resolveStip,addFundingItem,resolveFundingItem,removeFundingItem,acceptDeal,sendConfEmail,sendCodeEmail,addNote,addActivity,addDlr,updDlr,saveAccount,addAcctActivity,notify]);

  return(
    <Ctx.Provider value={ctx}>
      <div style={S.app}>
        <nav style={S.nav}><div style={S.navIn}>
          <div style={S.logo}><img src={AVANTI_LOGO} alt="Avanti Equipment Finance" style={{height:34,objectFit:"contain",borderRadius:6,padding:"2px 8px",background:"#f0f0f0"}}/></div>
          <div style={S.navTabs}>
            {[{id:"crm",lb:"CRM",ic:<I.Shield/>},{id:"apply",lb:"Apply",ic:<I.FileText/>},{id:"dealer",lb:"Dealer Portal",ic:<I.Bldg/>},{id:"customer",lb:"Customer Portal",ic:<I.Eye/>}].map(p=>
              <button key={p.id} className="av-tab" onClick={()=>{setPortal(p.id);if(p.id!=="dealer")setDlrAuth(null);if(p.id!=="customer")setCustAuth(null)}} style={{...S.navTab,...(portal===p.id?S.navTabA:{})}}>{p.ic}<span>{p.lb}</span></button>
            )}
          </div>
          <div style={S.navR}>
            {portal==="crm"&&<span style={S.navUser}><I.User/> Brent C.</span>}
            {portal==="dealer"&&dlrAuth&&<button className="av-ghost" style={S.ghost} onClick={()=>setDlrAuth(null)}><I.Logout/> Log Out</button>}
            {portal==="customer"&&custAuth&&<button className="av-ghost" style={S.ghost} onClick={()=>setCustAuth(null)}><I.Back/> Back</button>}
          </div>
        </div></nav>
        <main style={S.main}>
          {portal==="crm"&&<CRM/>}
          {portal==="apply"&&<ApplyPage/>}
          {portal==="dealer"&&(dlrAuth?<DealerDash did={dlrAuth} out={()=>setDlrAuth(null)}/>:<Login type="dealer" onGo={loginDlr}/>)}
          {portal==="customer"&&(custAuth?<CustDash did={custAuth} out={()=>setCustAuth(null)}/>:<Login type="customer" onGo={loginCust}/>)}
        </main>
        {toast&&<div style={{...S.toast,background:toast.t==="ok"?"#2E7D32":toast.t==="error"?"#B0413E":"#4F8EAE",animation:"fadeIn .3s"}}>{toast.msg}</div>}
      </div>
    </Ctx.Provider>
  );
}

// ════════════════════════════════════════════════════════════════
// CRM
// ════════════════════════════════════════════════════════════════

function CRM() {
  const {deals,moveDeal,delDeal,saveDeal,notify} = useContext(Ctx);
  const [view,setView]=useState("pipeline");
  const [sel,setSel]=useState(null);
  const [form,setForm]=useState(false);
  const [editD,setEditD]=useState(null);
  const [q,setQ]=useState("");
  const [dragId,setDragId]=useState(null);
  const [dragO,setDragO]=useState(null);
  // PDF import state
  const [pdfDrag,setPdfDrag]=useState(false);
  const [pdfParsed,setPdfParsed]=useState(null);
  const [pdfParsing,setPdfParsing]=useState(false);
  const fileRef=useRef(null);

  const filt = useMemo(()=>{if(!q)return deals;const lq=q.toLowerCase();return deals.filter(d=>d.biz?.toLowerCase().includes(lq)||d.contact?.toLowerCase().includes(lq)||d.eqType?.toLowerCase().includes(lq)||d.dealerName?.toLowerCase().includes(lq)||d.code?.toLowerCase().includes(lq))},[deals,q]);
  const stats = useMemo(()=>({act:deals.filter(d=>!["funded","declined","dead"].includes(d.stage)).length,pipe:deals.filter(d=>!["funded","declined","dead"].includes(d.stage)).reduce((s,d)=>s+(d.amount||0),0),fun:deals.filter(d=>d.stage==="funded").reduce((s,d)=>s+(d.amount||0),0),tot:deals.length,dead:deals.filter(d=>d.stage==="dead").length}),[deals]);

  useEffect(()=>{if(sel){const u=deals.find(d=>d.id===sel.id);if(u)setSel(u);else setSel(null)}},[deals]);

  // ── PDF PARSER ──
  const parsePdf=async(file)=>{
    setPdfParsing(true);
    try{
      const buf=await file.arrayBuffer();
      // Load PDF.js from CDN if not already loaded
      if (!window.pdfjsLib) {
        await new Promise((resolve, reject) => {
          const script = document.createElement("script");
          script.src = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js";
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }
      const pdfjsLib = window.pdfjsLib;
      pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
      const pdf=await pdfjsLib.getDocument({data:buf}).promise;
      // Extract form fields if available
      let fields={};
      const allText=[];
      for(let i=1;i<=pdf.numPages;i++){
        const page=await pdf.getPage(i);
        const annots=await page.getAnnotations();
        annots.forEach(a=>{
          const name=a.fieldName||a.alternativeText||"";
          const val=a.fieldValue||a.buttonValue||"";
          if(name&&val)fields[name]=typeof val==="string"?val.trim():String(val);
        });
        const txt=await page.getTextContent();
        allText.push(txt.items.map(t=>t.str).join(" "));
      }
      console.log("📋 PDF Form Fields Found:",Object.keys(fields).length,fields);
      console.log("📄 PDF Text Length:",allText.join("").length);
      const text=allText.join("\n");
      // Also extract label→value pairs from text (Jotform often renders "Label: Value" in PDF text)
      const lblPairs={};
      text.replace(/([A-Za-z][A-Za-z\s\/]{2,40})[:\s]{1,3}([^\n]{1,80})/g,(_,l,v)=>{if(v.trim())lblPairs[l.trim().toLowerCase()]=v.trim()});
      // Smart field matcher: checks form field names (including Jotform q_prefix patterns), then label pairs, then regex
      const g=(keys)=>{
        for(const k of keys){
          const kl=k.toLowerCase();
          for(const[fn,fv] of Object.entries(fields)){
            // Match: exact include, camelCase (businessName), Jotform q-prefix (q3_businessName), or underscore/dash separated
            const fnl=fn.toLowerCase().replace(/^q\d+_/,"");
            if((fnl.includes(kl)||fn.toLowerCase().includes(kl))&&fv)return fv;
          }
          // Check label pairs from text
          for(const[lbl,val] of Object.entries(lblPairs)){if(lbl.includes(kl)&&val)return val}
        }
        return "";
      };
      const rx=(pattern)=>{const m=text.match(pattern);return m?m[1]?.trim()||m[0]?.trim():""};
      const parsed={
        bizName:g(["business","company","legal name","bizName","BusinessName","CompanyName"])||rx(/(?:business|company|legal)\s*name[:\s]*([^\n,]{2,60})/i),
        dba:g(["dba","DBA","doing business"]),
        bizAddress:g(["business address","bizAddress","address","street"])||rx(/(?:business\s+)?address[:\s]*([^\n]{5,80})/i),
        bizCity:g(["city","bizCity"]),bizState:g(["state","bizState"]),bizZip:g(["zip","postal","bizZip"]),
        bizPhone:g(["business phone","bizPhone","phone"])||rx(/(?:business\s+)?phone[:\s]*([\d().\-\s]{7,20})/i),
        bizEmail:g(["email","bizEmail","Email"])||rx(/([\w.+-]+@[\w-]+\.[\w.]+)/i),
        fedId:g(["ein","tax id","federal","fedId","EIN"])||rx(/(?:ein|federal\s*(?:tax\s*)?id)[:\s]*([\d\-]{9,12})/i),
        legalStructure:g(["structure","entity","legal structure","legalStructure"]),
        employees:g(["employees","# emp"]),
        dateStarted:g(["date started","dateStarted","date established"]),
        bizType:g(["industry","type of business","bizType"]),
        o1Name:g(["owner","guarantor","o1Name","owner name","OwnerName","applicant"])||rx(/(?:owner|guarantor|applicant)\s*(?:1\s*)?(?:name)?[:\s]*([A-Z][a-z]+ [A-Z][a-z]+)/),
        o1Title:g(["title","o1Title"]),
        o1Pct:g(["ownership","percent","o1Pct","%"])||"100",
        o1Address:g(["home address","o1Address","residential"]),
        o1City:g(["o1City"]),o1State:g(["o1State"]),o1Zip:g(["o1Zip"]),
        o1Cell:g(["cell","mobile","o1Cell"])||rx(/(?:cell|mobile)[:\s]*([\d().\-\s]{7,20})/i),
        o1Ssn:g(["ssn","social","o1Ssn","Social Security"])||rx(/(?:ssn|social\s*security)[:\s#]*([\d\-X]{9,11})/i),
        o1Dob:g(["dob","birth","o1Dob","Date of Birth"])||rx(/(?:d\.?o\.?b\.?|date\s*of\s*birth)[:\s]*([\d\/\-]{6,10})/i),
        o2Name:g(["owner 2","o2Name","co-owner","guarantor 2"]),o2Ssn:g(["o2Ssn"]),o2Dob:g(["o2Dob"]),
        o2Cell:g(["o2Cell"]),o2Address:g(["o2Address"]),o2City:g(["o2City"]),o2State:g(["o2State"]),o2Zip:g(["o2Zip"]),
        o2Pct:g(["o2Pct"]),o2Title:g(["o2Title"]),
        bankName:g(["bank","bankName","Bank Name"])||rx(/(?:bank\s*name)[:\s]*([^\n]{2,50})/i),
        bankAcct:g(["account","bankAcct","acct"]),bankPhone:g(["bank phone","bankPhone"]),bankContact:g(["bank contact","bankContact"]),
        trade1:g(["trade ref","reference 1","trade1"]),trade1Ph:g(["trade1Ph"]),trade2:g(["reference 2","trade2"]),trade2Ph:g(["trade2Ph"]),
        vendorName:g(["vendor","dealer","vendorName"])||rx(/(?:vendor|dealer)[:\s]*([^\n]{2,50})/i),
        vendorPhone:g(["vendor phone","vendorPhone"]),salesPerson:g(["salesperson","sales rep","salesPerson"]),
        eqType:g(["equipment type","eqType"])||rx(/(?:equipment\s*type)[:\s]*([^\n]{2,40})/i),
        eqDesc:g(["equipment desc","description","eqDesc"]),
        eqYear:g(["year","eqYear"])||rx(/(?:year)[:\s]*(\d{4})/i),
        eqMake:g(["make","eqMake"])||rx(/(?:make)[:\s]*([^\n,]{2,30})/i),
        eqModel:g(["model","eqModel"])||rx(/(?:model)[:\s]*([^\n,]{2,30})/i),
        eqVin:g(["vin","serial","eqVin"])||rx(/(?:vin|serial)[:\s#]*([\w]{10,20})/i),
        eqMileage:g(["mileage","hours","eqMileage"]),
        newUsed:g(["new","used","condition","newUsed"])||"New",
        price:g(["price","amount","cost","purchase price"])||rx(/(?:purchase\s*)?price[:\s$]*([\d,.$]+)/i),
        termReq:g(["term","months","termReq"]),
      };
      setPdfParsed(parsed);
    }catch(e){console.error(e);notify("Could not parse PDF — try a different file");}
    setPdfParsing(false);
  };
  const handlePdfDrop=(e)=>{e.preventDefault();setPdfDrag(false);const f=e.dataTransfer?.files?.[0]||e.target?.files?.[0];if(f&&f.type==="application/pdf")parsePdf(f);else notify("Please drop a PDF file");};
  const createFromPdf=()=>{if(!pdfParsed)return;const p=pdfParsed;const code=p.bizName.replace(/[^A-Z]/gi,"").slice(0,3).toUpperCase()+"-"+Math.floor(1000+Math.random()*9000);
    saveDeal({biz:p.bizName,contact:p.o1Name,email:p.bizEmail,phone:p.bizPhone||p.o1Cell,eqType:p.eqType,eqDetail:[p.eqYear,p.eqMake,p.eqModel].filter(Boolean).join(" ")||p.eqDesc,eqYear:p.eqYear,eqMake:p.eqMake,eqModel:p.eqModel,eqVin:p.eqVin,eqMileage:p.eqMileage,amount:parseFloat((p.price||"").replace(/[^0-9.]/g,""))||0,stage:"new_lead",source:"PDF Import",code,notes:`Imported from PDF. Structure: ${p.legalStructure||"N/A"}. EIN: ${p.fedId||"N/A"}.`,
      appData:{bizName:p.bizName,dba:p.dba,bizType:p.bizType,bizAddress:p.bizAddress,bizCity:p.bizCity,bizState:p.bizState,bizZip:p.bizZip,bizPhone:p.bizPhone,bizEmail:p.bizEmail,fedId:p.fedId,legalStructure:p.legalStructure,employees:p.employees,dateStarted:p.dateStarted,
      o1Name:p.o1Name,o1Title:p.o1Title,o1Pct:p.o1Pct,o1Address:p.o1Address,o1City:p.o1City,o1State:p.o1State,o1Zip:p.o1Zip,o1Cell:p.o1Cell,o1Ssn:p.o1Ssn,o1Dob:p.o1Dob,
      o2Name:p.o2Name,o2Title:p.o2Title,o2Pct:p.o2Pct,o2Address:p.o2Address,o2City:p.o2City,o2State:p.o2State,o2Zip:p.o2Zip,o2Cell:p.o2Cell,o2Ssn:p.o2Ssn,o2Dob:p.o2Dob,hasOwner2:!!p.o2Name,
      bankName:p.bankName,bankAcct:p.bankAcct,bankPhone:p.bankPhone,bankContact:p.bankContact,trade1:p.trade1,trade1Ph:p.trade1Ph,trade2:p.trade2,trade2Ph:p.trade2Ph,
      vendorName:p.vendorName,vendorPhone:p.vendorPhone,salesPerson:p.salesPerson,
      eqDesc:p.eqDesc,newUsed:p.newUsed,price:p.price,termReq:p.termReq}
    });
    notify("Deal created from PDF — "+p.bizName);setPdfParsed(null);
  };

  return(
    <div style={S.wrap} onDragOver={e=>{e.preventDefault();if(e.dataTransfer.types.includes("Files"))setPdfDrag(true)}} onDragLeave={e=>{if(!e.currentTarget.contains(e.relatedTarget))setPdfDrag(false)}} onDrop={handlePdfDrop}>
      {/* PDF Drop Overlay */}
      {pdfDrag&&<div style={{position:"fixed",inset:0,background:"#000000dd",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"}}>
        <div style={{border:"3px dashed #4F8EAE",borderRadius:16,padding:"60px 80px",textAlign:"center"}}>
          <I.Upload/><div style={{fontSize:18,fontWeight:700,color:"#4F8EAE",marginTop:12}}>Drop PDF Application</div>
          <div style={{fontSize:12,color:"#888",marginTop:4}}>Auto-creates a new deal from the application</div>
        </div>
      </div>}
      {/* PDF Parsing Spinner */}
      {pdfParsing&&<div style={{position:"fixed",inset:0,background:"#000000cc",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"}}>
        <div style={{textAlign:"center",color:"#4F8EAE"}}><div style={{fontSize:16,fontWeight:600,animation:"pulse 1s infinite"}}>Parsing PDF...</div><div style={{fontSize:11,color:"#888",marginTop:6}}>Extracting application fields</div></div>
      </div>}
      {/* PDF Preview Modal */}
      {pdfParsed&&<div style={{position:"fixed",inset:0,background:"#000000dd",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",padding:20}} onClick={()=>setPdfParsed(null)}>
        <div style={{background:"#111114",border:"1px solid #1E1E20",borderRadius:12,maxWidth:560,width:"100%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"}} onClick={e=>e.stopPropagation()}>
          <div style={{padding:"16px 20px",borderBottom:"1px solid #1E1E20",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
            <div><div style={{fontSize:15,fontWeight:700,color:"#fff"}}>PDF Import Preview</div><div style={{fontSize:11,color:"#888",marginTop:2}}>Review parsed data before creating the deal</div></div>
            <button style={S.closeBtn} onClick={()=>setPdfParsed(null)}><I.X/></button>
          </div>
          <div style={{padding:"16px 20px",overflowY:"auto",flex:1}}>
            {[{t:"Business",items:[["Business Name",pdfParsed.bizName],["DBA",pdfParsed.dba],["Address",pdfParsed.bizAddress],["City/State/ZIP",[pdfParsed.bizCity,pdfParsed.bizState,pdfParsed.bizZip].filter(Boolean).join(", ")],["Phone",pdfParsed.bizPhone],["Email",pdfParsed.bizEmail],["EIN",pdfParsed.fedId],["Structure",pdfParsed.legalStructure],["Industry",pdfParsed.bizType],["Started",pdfParsed.dateStarted]]},
              {t:"Owner / Guarantor",items:[["Name",pdfParsed.o1Name],["Title",pdfParsed.o1Title],["Ownership",pdfParsed.o1Pct?pdfParsed.o1Pct+"%":""],["Cell",pdfParsed.o1Cell],["SSN",pdfParsed.o1Ssn?"•••-••-"+pdfParsed.o1Ssn.slice(-4):""],["DOB",pdfParsed.o1Dob],["Address",pdfParsed.o1Address]]},
              {t:"Bank & References",items:[["Bank",pdfParsed.bankName],["Account",pdfParsed.bankAcct?"••••"+pdfParsed.bankAcct.slice(-4):""],["Trade Ref 1",pdfParsed.trade1],["Trade Ref 2",pdfParsed.trade2]]},
              {t:"Equipment",items:[["Type",pdfParsed.eqType],["Year/Make/Model",[pdfParsed.eqYear,pdfParsed.eqMake,pdfParsed.eqModel].filter(Boolean).join(" ")],["VIN",pdfParsed.eqVin],["Price",pdfParsed.price],["Condition",pdfParsed.newUsed],["Term",pdfParsed.termReq],["Vendor",pdfParsed.vendorName]]}
            ].map(sec=><div key={sec.t} style={{marginBottom:12,background:"#0A0A0A",border:"1px solid #1A1A1C",borderRadius:8,overflow:"hidden"}}>
              <div style={{padding:"6px 12px",borderBottom:"1px solid #1A1A1C",fontSize:10,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:.8}}>{sec.t}</div>
              <div style={{padding:"8px 12px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"3px 16px"}}>
                {sec.items.filter(([,v])=>v).map(([l,v])=><div key={l} style={{display:"flex",gap:6,fontSize:12,padding:"2px 0"}}><span style={{color:"#555",minWidth:90}}>{l}:</span><span style={{color:"#ccc",fontWeight:500}}>{v}</span></div>)}
                {sec.items.filter(([,v])=>v).length===0&&<div style={{fontSize:11,color:"#333",fontStyle:"italic"}}>No data found</div>}
              </div>
            </div>)}
          </div>
          <div style={{padding:"14px 20px",borderTop:"1px solid #1E1E20",display:"flex",gap:8,justifyContent:"flex-end"}}>
            <button className="av-ghost" style={S.ghost} onClick={()=>setPdfParsed(null)}>Cancel</button>
            <button className="av-btn" style={{...S.prim,padding:"10px 24px",fontSize:13}} onClick={createFromPdf}><I.Plus/> Create Deal</button>
          </div>
        </div>
      </div>}
      <div style={S.hdr}>
        <div style={S.srchW}><I.Search/><input type="text" placeholder="Search deals, contacts, codes..." value={q} onChange={e=>setQ(e.target.value)} style={S.srchIn}/>{q&&<button style={S.tinyBtn} onClick={()=>setQ("")}><I.X/></button>}</div>
        <div style={{display:"flex",gap:6}}>
          <input type="file" accept=".pdf" ref={fileRef} style={{display:"none"}} onChange={handlePdfDrop}/>
          <button className="av-ghost" style={{...S.ghost,padding:"8px 12px",fontSize:11}} onClick={()=>fileRef.current?.click()}><I.Upload/> Import PDF</button>
          <button className="av-btn" style={S.prim} onClick={()=>{setEditD(null);setForm(true)}}><I.Plus/> New Deal</button>
        </div>
      </div>
      <div style={S.statsG}>{[{l:"Active",v:stats.act,c:"#fff"},{l:"Pipeline",v:fmt(stats.pipe),c:"#6BA3BF"},{l:"Funded",v:fmt(stats.fun),c:"#4CAF50"},{l:"Total",v:stats.tot,c:"#fff"},{l:"Dead",v:stats.dead,c:"#666"}].map((s,i)=><div key={i} style={S.statC}><div style={{...S.statV,color:s.c}}>{s.v}</div><div style={S.statL}>{s.l}</div></div>)}</div>
      <div style={S.tabs}>{[{id:"pipeline",ic:<I.Pipe/>,l:"Pipeline"},{id:"list",ic:<I.List/>,l:"All Deals"},{id:"accounts",ic:<I.User/>,l:"Accounts"},{id:"dead",ic:<I.Archive/>,l:`Dead (${stats.dead})`},{id:"dealers",ic:<I.Bldg/>,l:"Dealers"},{id:"lenders",ic:<I.Dollar/>,l:"Lenders"},{id:"settings",ic:<I.Gear/>,l:"Settings"}].map(t=><button key={t.id} className="av-tab" style={{...S.tab,...(view===t.id?S.tabA:{})}} onClick={()=>setView(t.id)}>{t.ic} {t.l}</button>)}</div>
      <div style={{marginTop:14,animation:"fadeIn .3s"}}>
        {view==="pipeline"&&<Pipeline deals={filt} onSel={setSel} dragId={dragId} setDragId={setDragId} dragO={dragO} setDragO={setDragO} moveDeal={moveDeal}/>}
        {view==="list"&&<ListV deals={filt.filter(d=>d.stage!=="dead")} onSel={setSel} onEdit={d=>{setEditD(d);setForm(true)}}/>}
        {view==="accounts"&&<AccountsMgmt onSel={setSel}/>}
        {view==="dead"&&<DeadV deals={filt.filter(d=>d.stage==="dead")} onSel={setSel} onReact={id=>moveDeal(id,"new_lead","Reactivated")}/>}
        {view==="dealers"&&<DlrMgmt/>}
        {view==="lenders"&&<LndrMgmt/>}
        {view==="settings"&&<Settings/>}
      </div>
      {sel&&<Drawer deal={sel} onClose={()=>setSel(null)} onEdit={d=>{setEditD(d);setForm(true);setSel(null)}} onDel={id=>{delDeal(id);setSel(null)}} onMove={moveDeal}/>}
      {form&&<DealForm deal={editD} onSave={d=>{saveDeal(d);setForm(false);setEditD(null)}} onClose={()=>{setForm(false);setEditD(null)}}/>}
    </div>
  );
}

// ── Pipeline ──────────────────────────────────────────────────

function Pipeline({deals,onSel,dragId,setDragId,dragO,setDragO,moveDeal}) {
  const active = STAGES.filter(s=>!["declined","dead"].includes(s.id));
  const colRefs=useRef({});
  const ghostRef=useRef(null);
  const touchDragId=useRef(null);
  const [touchDragging,setTouchDragging]=useState(false);
  const touchStartPos=useRef(null);
  const longPressTimer=useRef(null);

  // Find which column a point is over
  const colAtPoint=(x,y)=>{
    for(const [stgId,el] of Object.entries(colRefs.current)){
      if(!el)continue;
      const r=el.getBoundingClientRect();
      if(x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom)return stgId;
    }
    return null;
  };

  // Create/move ghost element
  const moveGhost=(x,y,text)=>{
    if(!ghostRef.current){
      const g=document.createElement("div");
      g.style.cssText="position:fixed;z-index:9999;padding:8px 14px;background:#1E1E22;border:1px solid #4F8EAE;border-radius:8px;color:#fff;font-size:12px;font-weight:600;font-family:Outfit,sans-serif;pointer-events:none;box-shadow:0 8px 24px #000a;opacity:.92;transform:translate(-50%,-120%);white-space:nowrap;max-width:200px;overflow:hidden;text-overflow:ellipsis";
      g.textContent=text;
      document.body.appendChild(g);
      ghostRef.current=g;
    }
    ghostRef.current.style.left=x+"px";
    ghostRef.current.style.top=y+"px";
  };
  const removeGhost=()=>{if(ghostRef.current){ghostRef.current.remove();ghostRef.current=null}};

  const onTouchStart=(e,dealId,bizName)=>{
    touchStartPos.current={x:e.touches[0].clientX,y:e.touches[0].clientY};
    longPressTimer.current=setTimeout(()=>{
      touchDragId.current=dealId;
      setDragId(dealId);
      setTouchDragging(true);
      moveGhost(e.touches[0].clientX,e.touches[0].clientY,bizName);
      // Vibrate if supported
      if(navigator.vibrate)navigator.vibrate(30);
    },300);
  };

  const onTouchMove=(e)=>{
    // Cancel long press if moved too far before triggering
    if(longPressTimer.current&&touchStartPos.current){
      const dx=Math.abs(e.touches[0].clientX-touchStartPos.current.x);
      const dy=Math.abs(e.touches[0].clientY-touchStartPos.current.y);
      if(dx>10||dy>10){clearTimeout(longPressTimer.current);longPressTimer.current=null}
    }
    if(!touchDragId.current)return;
    e.preventDefault();
    const x=e.touches[0].clientX,y=e.touches[0].clientY;
    moveGhost(x,y);
    const over=colAtPoint(x,y);
    setDragO(over);
  };

  const onTouchEnd=(e)=>{
    clearTimeout(longPressTimer.current);
    longPressTimer.current=null;
    if(!touchDragId.current){touchStartPos.current=null;return}
    const id=touchDragId.current;
    touchDragId.current=null;
    removeGhost();
    setTouchDragging(false);
    if(dragO&&id){
      moveDeal(id,dragO);
    }
    setDragId(null);
    setDragO(null);
    touchStartPos.current=null;
  };

  // Cleanup on unmount
  useEffect(()=>()=>{removeGhost();clearTimeout(longPressTimer.current)},[]);

  return(<div style={S.kanban} onTouchMove={onTouchMove} onTouchEnd={onTouchEnd}>{active.map(stg=>{
    const sd=deals.filter(d=>d.stage===stg.id),tot=sd.reduce((s,d)=>s+(d.amount||0),0),isO=dragO===stg.id;
    return(<div key={stg.id} ref={el=>colRefs.current[stg.id]=el} style={{...S.kCol,...(isO?{borderColor:stg.color,boxShadow:`0 0 0 2px ${stg.color}40`,transition:"border-color .15s, box-shadow .15s"}:{transition:"border-color .15s, box-shadow .15s"})}} onDragOver={e=>{e.preventDefault();setDragO(stg.id)}} onDragLeave={()=>setDragO(null)} onDrop={e=>{e.preventDefault();if(dragId)moveDeal(dragId,stg.id);setDragId(null);setDragO(null)}}>
      <div style={S.kHead}><div style={S.kTitle}><span style={{...S.dot,background:stg.color}}/><span>{stg.label}</span><span style={S.kCnt}>{sd.length}</span></div><div style={S.kTot}>{fmt(tot)}</div></div>
      <div style={S.kCards}>{sd.map(d=><div key={d.id} draggable className="av-kcard"
        onDragStart={e=>{setDragId(d.id);e.dataTransfer.effectAllowed="move"}}
        onDragEnd={()=>{setDragId(null);setDragO(null)}}
        onTouchStart={e=>onTouchStart(e,d.id,d.biz)}
        onClick={()=>{if(!touchDragging)onSel(d)}}
        style={{...S.kCard,borderLeftColor:stg.color,...(dragId===d.id?{opacity:.3}:{}),touchAction:"none",userSelect:"none"}}>
        <div style={S.kName}>{d.biz}</div>
        <div style={S.kMeta}><I.User/> {d.contact}</div>
        <div style={S.kMeta}><I.Truck/> {d.eqType}</div>
        <div style={S.kBot}><span style={S.kAmt}>{fmt(d.amount)}</span><span style={S.kTime}>{relT(d.updatedAt)}</span></div>
        {d.dealerName&&<div style={S.kDlr}>{d.dealerName}</div>}
        {d.docs?.length>0&&<div style={{fontSize:9,color:"#4F8EAE66",marginTop:2}}><I.Doc/> {d.docs.length} docs</div>}
        {(d.stips||[]).filter(s=>!s.done).length>0&&<div style={S.kStip}><I.Alert/> {(d.stips||[]).filter(s=>!s.done).length} items needed</div>}
      </div>)}{sd.length===0&&<div style={S.kEmpty}>No deals</div>}</div>
    </div>)})}</div>);
}

// ── List View ─────────────────────────────────────────────────

function ListV({deals,onSel,onEdit}) {
  const sorted = [...deals].sort((a,b)=>new Date(b.updatedAt||0)-new Date(a.updatedAt||0));
  return(<div style={{overflowX:"auto"}}><table style={S.table}><thead><tr>{["Business","Contact","Equipment","Amount","Stage","Code","Dealer","Docs","Items","Updated",""].map((h,i)=><th key={i} style={S.th}>{h}</th>)}</tr></thead><tbody>
    {sorted.map(d=>{const stg=STAGES.find(s=>s.id===d.stage);const pendStips=(d.stips||[]).filter(s=>!s.done).length;return(
      <tr key={d.id} className="av-row" style={S.tr} onClick={()=>onSel(d)}>
        <td style={{...S.td,fontWeight:600,color:"#fff"}}>{d.biz}</td>
        <td style={S.td}>{d.contact}</td><td style={S.td}>{d.eqType}</td>
        <td style={{...S.td,fontWeight:600,fontVariantNumeric:"tabular-nums"}}>{fmt(d.amount)}</td>
        <td style={S.td}><span style={{...S.badge,background:stg?.color+"18",color:stg?.color,borderColor:stg?.color+"33"}}>{stg?.label}</span></td>
        <td style={{...S.td,fontFamily:"'JetBrains Mono',monospace",color:"#4F8EAE",fontSize:11}}>{d.code}</td>
        <td style={{...S.td,color:"#666"}}>{d.dealerName||"—"}</td>
        <td style={{...S.td,color:"#666"}}>{d.docs?.length||0}</td>
        <td style={S.td}>{pendStips>0?<span style={{fontSize:10,color:"#E89300",fontWeight:600}}>{pendStips} needed</span>:<span style={{color:"#333"}}>—</span>}</td>
        <td style={{...S.td,color:"#555",fontSize:11}}>{relT(d.updatedAt)}</td>
        <td style={S.td}><button style={S.tinyBtn} onClick={e=>{e.stopPropagation();onEdit(d)}}><I.Edit/></button></td>
      </tr>)})}
    {sorted.length===0&&<tr><td colSpan={11} style={{...S.td,textAlign:"center",color:"#444",padding:40}}>No deals found</td></tr>}
  </tbody></table></div>);
}

// ── Dead Deals ────────────────────────────────────────────────

function DeadV({deals,onSel,onReact}) {
  const sorted = [...deals].sort((a,b)=>new Date(b.updatedAt||0)-new Date(a.updatedAt||0));
  if(!sorted.length)return(<div style={S.empty}><I.Archive/><div style={{marginTop:8,fontSize:13,fontWeight:600,color:"#555"}}>No dead deals</div><div style={{fontSize:11,color:"#444",marginTop:4}}>Deals marked as dead will appear here.</div></div>);
  return(<div>{sorted.map(d=>{const lastA=[...(d.history||[])].reverse().find(h=>h.s!=="dead"),deadE=[...(d.history||[])].reverse().find(h=>h.s==="dead");return(
    <div key={d.id} className="av-row" style={S.deadRow}>
      <div style={{flex:1,cursor:"pointer"}} onClick={()=>onSel(d)}>
        <div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:13,fontWeight:600,color:"#999"}}>{d.biz}</span>{lastA&&<span style={S.deadWas}>was: {STAGES.find(s=>s.id===lastA.s)?.label}</span>}</div>
        <div style={{fontSize:12,color:"#555",marginTop:3}}>{d.contact} · {d.eqType} · {fmt(d.amount)}</div>
        {deadE?.n&&<div style={{fontSize:11,color:"#444",marginTop:2}}>"{deadE.n}" · {relT(deadE.d)}</div>}
      </div>
      <button className="av-btn" style={S.reactBtn} onClick={()=>onReact(d.id)}><I.Refresh/> Reactivate</button>
    </div>)})}</div>);
}

// ── Drawer ─────────────────────────────────────────────────────

function Drawer({deal,onClose,onEdit,onDel,onMove}) {
  const {deals,dnotes,addNote,addActivity,lenders,addDoc,rmDoc,toggleDocReq,sendConfEmail,sendCodeEmail,notify,accounts,saveAccount} = useContext(Ctx);
  const [mt,setMt]=useState(null);
  const [mn,setMn]=useState("");
  const [nn,setNn]=useState("");
  const [cp,setCp]=useState(false);
  const [closeModal,setCloseModal]=useState(null); // {stage:"dead"|"declined"}
  const [closeReason,setCloseReason]=useState("");
  const d = deals.find(x=>x.id===deal.id)||deal;
  const stg = STAGES.find(s=>s.id===d.stage);
  const lndr = lenders.find(l=>l.id===d.lenderId);
  const notes = dnotes[d.id]||[];
  const copyC = ()=>{navigator.clipboard.writeText(d.code);setCp(true);setTimeout(()=>setCp(false),2000)};

  return(
    <div style={S.overlay} onClick={onClose}><div style={S.drawer} onClick={e=>e.stopPropagation()}>
      <div style={S.drHead}>
        <div><div style={{fontSize:17,fontWeight:700,color:"#fff",marginBottom:5}}>{d.biz}</div>
          <div style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>
            <span style={{...S.badge,background:stg?.color+"18",color:stg?.color,borderColor:stg?.color+"33"}}>{stg?.label}</span>
            <button onClick={copyC} style={S.codeChip}><I.Copy/><span style={{fontFamily:"'JetBrains Mono',monospace",letterSpacing:1}}>{d.code}</span>{cp&&<span style={{color:"#4CAF50",fontSize:10}}>✓</span>}</button>
          </div></div>
        <button style={S.closeBtn} onClick={onClose}><I.X/></button>
      </div>
      <div style={S.drBody}>
        {/* Stage mover */}
        <Sec t="Move to Stage"><div style={{display:"flex",gap:3,flexWrap:"wrap"}}>{STAGES.map(s=>{const cur=d.stage===s.id;return(
          <button key={s.id} onClick={()=>{if(cur)return;if(s.id==="dead"||s.id==="declined"){setCloseModal({stage:s.id});setCloseReason("")}else if(mt===s.id){onMove(d.id,s.id,mn);setMt(null);setMn("")}else{setMt(s.id);setMn("")}}} style={{padding:"4px 7px",fontSize:9,fontWeight:600,textTransform:"uppercase",letterSpacing:.4,border:cur?`2px solid ${s.color}`:"1px solid #1E1E20",borderRadius:4,cursor:cur?"default":"pointer",background:cur?s.color+"22":"#161618",color:cur?s.color:"#666",fontFamily:"inherit",transition:"all .15s"}}>{s.label}</button>)})}</div>
          {mt&&<div style={{marginTop:8,display:"flex",gap:6}}><input style={{...S.inp,flex:1,fontSize:12}} placeholder="Note..." value={mn} onChange={e=>setMn(e.target.value)} onKeyDown={e=>{if(e.key==="Enter"){onMove(d.id,mt,mn);setMt(null);setMn("")}}} autoFocus/><button className="av-btn" style={{...S.prim,padding:"6px 14px",fontSize:11}} onClick={()=>{onMove(d.id,mt,mn);setMt(null);setMn("")}}>Move</button></div>}
        </Sec>
        <Sec t="Contact"><div style={S.field}><I.User/> <strong>{d.contact}</strong></div>{d.email&&<div style={S.field}><I.Mail/> {d.email}</div>}{d.phone&&<div style={S.field}><I.Phone/> {d.phone}</div>}</Sec>
        <Sec t="Deal Details"><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
          <FB l="Equipment Type" v={d.eqType}/><FB l="Amount" v={fmt(d.amount)} vs={{color:"#6BA3BF",fontSize:17}}/><FB l="Source" v={d.source||"—"}/>{d.dealerName&&<FB l="Dealer" v={d.dealerName}/>}{lndr&&<FB l="Lender" v={lndr.name} sub={lndr.code}/>}
        </div></Sec>
        <Sec t="Equipment Info"><div style={{background:"#0A0A0A",border:"1px solid #1A1A1C",borderRadius:7,padding:"12px 14px"}}>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10}}>
            <FB l="Year" v={d.eqYear||"—"}/><FB l="Make" v={d.eqMake||"—"}/><FB l="Model" v={d.eqModel||"—"}/>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10}}>
            <FB l="VIN" v={d.eqVin||"—"} vs={{fontFamily:"'JetBrains Mono',monospace",fontSize:11,letterSpacing:.5}}/><FB l="Mileage" v={d.eqMileage?Number(d.eqMileage).toLocaleString()+" mi":"—"}/>
          </div>
          {d.eqDetail&&<div style={{marginTop:8,fontSize:11,color:"#555"}}>Notes: {d.eqDetail}</div>}
        </div></Sec>
        <GenerateCreditApp deal={d}/>
        {d.terms&&<Sec t="Approval Terms"><div style={S.approvalBox}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><FB l="Approved Amount" v={fmt(d.terms.amt)} vs={{color:"#4CAF50"}}/><FB l="Monthly Payment" v={fmt(d.terms.pmt)}/><FB l="Term" v={`${d.terms.months}mo`}/><FB l="Rate" v={d.terms.rate}/></div>
          {d.terms.buyRate!=null&&d.terms.points!=null&&<div style={{marginTop:10,padding:"8px 10px",background:"#E8930008",border:"1px solid #E8930018",borderRadius:6}}>
            <div style={{fontSize:8,fontWeight:700,color:"#E89300",textTransform:"uppercase",letterSpacing:1,marginBottom:6}}>Internal — Admin Only</div>
            <div style={{display:"grid",gridTemplateColumns:d.terms.dlrPts>0?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:8}}>
              <FB l="Your Points" v={d.terms.points+"pts"} vs={{color:"#E89300"}}/>
              <FB l="Your Fee" v={"$"+(d.terms.feeAmt||(d.terms.amt*(d.terms.points/100))||0).toLocaleString(undefined,{maximumFractionDigits:0})} vs={{color:"#4CAF50",fontWeight:700}}/>
              {d.terms.dlrPts>0&&<FB l="Dealer Pts" v={d.terms.dlrPts+"pts"} vs={{color:"#4F8EAE"}}/>}
              <FB l="Actual Financed" v={"$"+(d.terms.financedAmt||0).toLocaleString(undefined,{maximumFractionDigits:0})} vs={{color:"#E89300"}}/>
            </div>
            {d.terms.dlrPts>0&&<div style={{marginTop:6,fontSize:10,color:"#444"}}>Dealer referral: {d.terms.dlrPts}pts = ${(d.terms.dlrFee||(d.terms.amt*(d.terms.dlrPts/100))||0).toLocaleString(undefined,{maximumFractionDigits:0})} · Total points on deal: {d.terms.points+d.terms.dlrPts}</div>}
          </div>}
          {d.accepted!==null&&<div style={{marginTop:8,padding:"5px 10px",background:d.accepted?"#4CAF5012":"#B0413E12",borderRadius:5,fontSize:11,color:d.accepted?"#4CAF50":"#B0413E"}}>{d.accepted?"✓ Accepted":"✗ Not accepted"}{d.taxChoice!==null&&` · Tax: ${d.taxChoice?"Financed":"Separate"}`}</div>}
        </div></Sec>}
        <Sec t={`Documents (${(d.docs||[]).length})`}><div style={{display:"flex",flexDirection:"column",gap:3}}>{REQ_DOCS.map(doc=>{const up=(d.docs||[]).find(x=>x.docId===doc.id);const isReq=d.docReqs?.[doc.id]!==undefined?d.docReqs[doc.id]:doc.req;return(
          <div key={doc.id} style={S.docRow}><div style={{display:"flex",alignItems:"center",gap:7,flex:1}}>{up?<span style={{color:"#4CAF50"}}><I.CheckCirc/></span>:<div style={{width:14,height:14,borderRadius:"50%",border:`1.5px solid ${isReq?"#E89300":"#333"}`}}/>}<span style={{fontSize:11,color:up?"#ccc":"#555"}}>{doc.label}</span>
              <button onClick={()=>toggleDocReq(d.id,doc.id)} style={{fontSize:8,padding:"1px 5px",borderRadius:8,background:isReq?"#E8930018":"transparent",color:isReq?"#E89300":"#333",border:`1px solid ${isReq?"#E8930033":"#2A2A2E"}`,cursor:"pointer",fontFamily:"inherit",fontWeight:600,transition:"all .15s"}}>{isReq?"Req":"Opt"}</button></div>
            {up?<div style={{display:"flex",alignItems:"center",gap:5,fontSize:10,color:"#555"}}><span>{up.name}</span><button style={S.tinyBtn} onClick={()=>rmDoc(d.id,doc.id)}><I.Trash/></button></div>:<button style={S.tinyBtn} onClick={()=>addDoc(d.id,{docId:doc.id,name:`${d.biz?.replace(/\s/g,"_")}_${doc.label.replace(/[\s()]/g,"_")}.pdf`,at:new Date().toISOString(),by:"admin"})}><I.Upload/></button>}
          </div>)})}</div>
          {d.accountId&&(d.docs||[]).length>0&&<button className="av-ghost" style={{...S.ghost,marginTop:8,fontSize:10,width:"100%",justifyContent:"center",padding:"6px"}} onClick={()=>{
            const acc=accounts.find(a=>a.id===d.accountId);
            if(!acc)return;
            const existing=(acc.vault||[]).map(v=>v.name);
            const newFiles=(d.docs||[]).filter(doc=>!existing.includes(doc.name)).map(doc=>({id:gId(),name:doc.name,at:new Date().toISOString(),by:"admin",fromDeal:d.id}));
            if(newFiles.length){saveAccount({...acc,vault:[...(acc.vault||[]),...newFiles]});notify(`${newFiles.length} doc(s) saved to account vault`)}else{notify("All docs already in vault","info")}
          }}><I.Copy/> Save All Docs to Account Vault</button>}
        </Sec>
        <ItemsNeededSection deal={d}/>
        <FundingItemsSection deal={d}/>
        <Sec t="Notes">{d.notes&&<div style={S.noteBox}>{d.notes}</div>}{notes.map(n=><div key={n.id} style={S.noteItem}><div style={{fontSize:12,color:"#ccc"}}>{n.txt}</div><div style={{fontSize:10,color:"#555",marginTop:2}}>{n.who} · {fDT(n.at)}</div></div>)}
          <div style={{display:"flex",gap:6,marginTop:6}}><input style={{...S.inp,flex:1,fontSize:12}} placeholder="Add a note..." value={nn} onChange={e=>setNn(e.target.value)} onKeyDown={e=>{if(e.key==="Enter"&&nn.trim()){addNote(d.id,nn);setNn("")}}}/><button className="av-btn" style={{...S.prim,padding:"6px 10px",fontSize:11}} onClick={()=>{if(nn.trim()){addNote(d.id,nn);setNn("")}}}><I.Send/></button></div>
        </Sec>
        <ActivityLog deal={d}/>
        <Sec t="History">{(d.history||[]).slice().reverse().map((h,i)=>{const hs=STAGES.find(s=>s.id===h.s);return(<div key={i} style={{padding:"5px 0 5px 12px",borderLeft:`2px solid ${hs?.color||"#333"}`,marginLeft:4}}><div style={{fontSize:11,fontWeight:600,color:hs?.color}}>{hs?.label}</div>{h.n&&<div style={{fontSize:10,color:"#666"}}>{h.n}</div>}<div style={{fontSize:9,color:"#444",marginTop:1}}>{fDT(h.d)}</div></div>)})}</Sec>
        <Sec t="Customer Portal">
          {/* Tax financing option toggle */}
          {d.terms&&<div style={{marginBottom:10,padding:10,background:"#0A0A0A",borderRadius:6,border:"1px solid #1E1E20"}}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
              <div><div style={{fontSize:11,fontWeight:600,color:"#ccc"}}>Allow Customer to Choose Tax Financing</div><div style={{fontSize:9,color:"#555",marginTop:2}}>When enabled, customer portal shows option to finance sales tax or pay separately</div></div>
              <button onClick={()=>{const upd=deals.map(x=>x.id===d.id?{...x,showTaxChoice:!x.showTaxChoice,updatedAt:new Date().toISOString()}:x);setDeals(upd);notify(d.showTaxChoice?"Tax choice hidden from customer":"Tax choice visible to customer")}} style={{width:40,height:22,borderRadius:11,background:d.showTaxChoice?"#4F8EAE":"#2A2A2E",border:"none",cursor:"pointer",position:"relative",transition:"background .2s",flexShrink:0}}><div style={{width:16,height:16,borderRadius:8,background:"#fff",position:"absolute",top:3,left:d.showTaxChoice?21:3,transition:"left .2s"}}/></button>
            </div>
          </div>}
          {/* Auto confirmation email status */}
          <div style={{marginBottom:10}}>
            <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}>
              {d.emailConfSent?<span style={{color:"#4CAF50"}}><I.CheckCirc/></span>:<span style={{color:"#E89300"}}><I.Mail/></span>}
              <span style={{fontSize:11,color:d.emailConfSent?"#888":"#E89300",fontWeight:600}}>Confirmation Email</span>
            </div>
            {d.emailConfSent
              ?<div style={{fontSize:10,color:"#555"}}>Sent to {d.email} · {fDT(d.emailConfSent)}</div>
              :<button className="av-btn" style={{...S.prim,padding:"6px 12px",fontSize:11,background:"#E8930022",border:"1px solid #E8930033",color:"#E89300"}} onClick={()=>{sendConfEmail(d.id);notify("Confirmation email sent to "+d.email)}}>
                <I.Send/> Send Confirmation Email
              </button>
            }
            <div style={{fontSize:9,color:"#444",marginTop:3,fontStyle:"italic"}}>"We received your application" — no access code included</div>
          </div>
          {/* Send access code manually */}
          <div style={{padding:10,background:"#0A0A0A",borderRadius:6,border:"1px solid #1E1E20"}}>
            <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:6}}>
              {d.emailCodeSent?<span style={{color:"#4CAF50"}}><I.CheckCirc/></span>:<span style={{color:"#4F8EAE"}}><I.Eye/></span>}
              <span style={{fontSize:11,color:d.emailCodeSent?"#888":"#fff",fontWeight:600}}>Portal Access Code</span>
            </div>
            <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:8}}>
              <div style={S.bigCode}>{d.code}</div>
              <button className="av-ghost" style={{...S.ghost,padding:"7px 12px"}} onClick={copyC}>{cp?"Copied!":"Copy"}</button>
            </div>
            {d.emailCodeSent
              ?<div style={{fontSize:10,color:"#555"}}>Access code sent to {d.email} · {fDT(d.emailCodeSent)}</div>
              :<button className="av-btn" style={{...S.prim,padding:"8px 14px",fontSize:12,width:"100%",justifyContent:"center"}} onClick={()=>{sendCodeEmail(d.id);notify("Access code sent to "+d.email)}}>
                <I.Send/> Send Access Code to {d.contact||"Customer"}
              </button>
            }
            <div style={{fontSize:9,color:"#444",marginTop:3,fontStyle:"italic"}}>Sends portal link + access code so they can track their status</div>
          </div>
        </Sec>
      </div>
      <div style={S.drFoot}>
        <button className="av-btn" style={{...S.prim,flex:1,justifyContent:"center"}} onClick={()=>onEdit(d)}><I.Edit/> Edit</button>
        {d.stage==="dead"||d.stage==="declined"?<button className="av-btn" style={S.reactBtn} onClick={()=>onMove(d.id,"new_lead","Reactivated")}><I.Refresh/> Reactivate</button>
        :<button className="av-ghost" style={{...S.ghost,color:"#666"}} onClick={()=>{setCloseModal({stage:"dead"});setCloseReason("")}}><I.Archive/> Dead</button>}
        <button className="av-btn" style={S.danger} onClick={()=>{if(confirm("Permanently delete?"))onDel(d.id)}}><I.Trash/></button>
      </div>
      {/* Close-out reason modal */}
      {closeModal&&<div style={{position:"absolute",inset:0,background:"#000000cc",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,borderRadius:12}} onClick={()=>setCloseModal(null)}>
        <div style={{background:"#161618",border:"1px solid #2A2A2E",borderRadius:10,padding:20,width:340,maxWidth:"90%"}} onClick={e=>e.stopPropagation()}>
          <div style={{fontSize:15,fontWeight:700,color:closeModal.stage==="declined"?"#B0413E":"#666",marginBottom:4}}>
            {closeModal.stage==="declined"?"Decline Deal":"Mark as Dead"}
          </div>
          <div style={{fontSize:11,color:"#888",marginBottom:12}}>
            {closeModal.stage==="declined"?"Why was this deal declined?":"Why is this deal being closed out?"}
          </div>
          <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:10}}>
            {(closeModal.stage==="declined"
              ?["Credit too weak","Insufficient time in business","Insufficient revenue","Lender declined — no reason given","Customer withdrew"]
              :["Customer unresponsive","Customer went elsewhere","Deal fell through","Bad contact info","Customer not ready"]
            ).map(r=>(
              <button key={r} onClick={()=>setCloseReason(r)} style={{
                padding:"4px 8px",fontSize:10,borderRadius:5,cursor:"pointer",fontFamily:"inherit",
                border:`1px solid ${closeReason===r?"#B0413E":"#2A2A2E"}`,
                background:closeReason===r?"#B0413E18":"transparent",
                color:closeReason===r?"#B0413E":"#777",transition:"all .15s"
              }}>{r}</button>
            ))}
          </div>
          <textarea style={{...S.inp,resize:"vertical",minHeight:50,fontSize:12,width:"100%",marginBottom:12}} placeholder="Additional details (optional)..." value={closeReason} onChange={e=>setCloseReason(e.target.value)}/>
          <div style={{display:"flex",gap:8,justifyContent:"flex-end"}}>
            <button className="av-ghost" style={S.ghost} onClick={()=>setCloseModal(null)}>Cancel</button>
            <button className="av-btn" style={{...S.danger,padding:"8px 16px",fontSize:12}} onClick={()=>{
              if(!closeReason.trim()){notify("Please add a reason","error");return}
              onMove(d.id,closeModal.stage,closeReason.trim());
              setCloseModal(null);setCloseReason("");
            }}>{closeModal.stage==="declined"?"Decline":"Mark Dead"}</button>
          </div>
        </div>
      </div>}
    </div></div>);
}

// ── Accounts Management ───────────────────────────────────────

function AccountsMgmt({onSel}) {
  const {accounts,deals,saveAccount} = useContext(Ctx);
  const [selAcct,setSelAcct]=useState(null);
  const [form,setForm]=useState(false);
  const [ed,setEd]=useState(null);
  const [q,setQ]=useState("");

  const filtered=useMemo(()=>{
    if(!q)return accounts;
    const lq=q.toLowerCase();
    return accounts.filter(a=>a.biz?.toLowerCase().includes(lq)||a.contact?.toLowerCase().includes(lq)||a.email?.toLowerCase().includes(lq)||a.industry?.toLowerCase().includes(lq));
  },[accounts,q]);

  if(selAcct) return <AccountDetail accId={selAcct} onBack={()=>setSelAcct(null)} onSel={onSel}/>;

  return(<div>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
      <div style={{fontSize:15,fontWeight:700,color:"#fff"}}>Customer Accounts ({accounts.length})</div>
      <button className="av-btn" style={S.prim} onClick={()=>{setEd(null);setForm(true)}}><I.Plus/> New Account</button>
    </div>
    <div style={{marginBottom:12}}><div style={S.srchW}><I.Search/><input type="text" placeholder="Search accounts..." value={q} onChange={e=>setQ(e.target.value)} style={S.srchIn}/>{q&&<button style={S.tinyBtn} onClick={()=>setQ("")}><I.X/></button>}</div></div>
    <div style={{display:"flex",flexDirection:"column",gap:6}}>
      {filtered.map(acc=>{
        const acctDeals=deals.filter(d=>d.accountId===acc.id);
        const active=acctDeals.filter(d=>!["funded","declined","dead"].includes(d.stage)).length;
        const funded=acctDeals.filter(d=>d.stage==="funded");
        const dead=acctDeals.filter(d=>d.stage==="dead"||d.stage==="declined").length;
        const totalFunded=funded.reduce((s,d)=>s+(d.terms?.amt||d.amount||0),0);
        const totalFee=funded.reduce((s,d)=>s+(d.terms?.feeAmt||0),0);
        const lastActivity=[...(acc.activities||[]),...acctDeals.flatMap(d=>d.activities||[])].sort((a,b)=>new Date(b.at)-new Date(a.at))[0];

        return(<div key={acc.id} className="av-card" style={{...S.dlrCard,cursor:"pointer"}} onClick={()=>setSelAcct(acc.id)}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
            <div style={{flex:1}}>
              <div style={{fontSize:14,fontWeight:700,color:"#fff"}}>{acc.biz}</div>
              <div style={{fontSize:11,color:"#777",marginTop:2}}>{acc.contact}{acc.industry?` · ${acc.industry}`:""}</div>
              <div style={{fontSize:10,color:"#555",marginTop:1}}>{[acc.email,acc.phone].filter(Boolean).join(" · ")}</div>
            </div>
            <button style={S.tinyBtn} onClick={e=>{e.stopPropagation();setEd(acc);setForm(true)}}><I.Edit/></button>
          </div>
          <div style={{display:"flex",gap:12,marginTop:8,fontSize:11}}>
            <span style={{color:"#4F8EAE"}}><strong>{acctDeals.length}</strong> {acctDeals.length===1?"deal":"deals"}</span>
            {active>0&&<span style={{color:"#E89300"}}><strong>{active}</strong> active</span>}
            {funded.length>0&&<span style={{color:"#4CAF50"}}><strong>{fmt(totalFunded)}</strong> funded</span>}
            {totalFee>0&&<span style={{color:"#4CAF50"}}>${totalFee.toLocaleString()} fees</span>}
            {dead>0&&<span style={{color:"#666"}}>{dead} dead</span>}
          </div>
          {lastActivity&&<div style={{marginTop:6,fontSize:10,color:"#555"}}>
            Last activity: {ACT_TYPES.find(t=>t.id===lastActivity.type)?.label||"Other"} — {fDT(lastActivity.at)}
          </div>}
        </div>);
      })}
    </div>
    {form&&<AccountForm acc={ed} onSave={a=>{saveAccount(a);setForm(false);setEd(null)}} onClose={()=>{setForm(false);setEd(null)}}/>}
  </div>);
}

function AccountDetail({accId,onBack,onSel}) {
  const {accounts,deals,lenders,addAcctActivity,saveAccount} = useContext(Ctx);
  const acc=accounts.find(a=>a.id===accId);
  const [actDetail,setActDetail]=useState("");
  const [actType,setActType]=useState(null);
  const [tab,setTab]=useState("overview");
  const [vaultName,setVaultName]=useState("");

  if(!acc)return <div style={{color:"#B0413E"}}>Account not found. <button className="av-ghost" style={S.ghost} onClick={onBack}><I.Back/> Back</button></div>;

  const acctDeals=deals.filter(d=>d.accountId===acc.id).sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
  const active=acctDeals.filter(d=>!["funded","declined","dead"].includes(d.stage));
  const funded=acctDeals.filter(d=>d.stage==="funded");
  const dead=acctDeals.filter(d=>d.stage==="dead"||d.stage==="declined");
  const totalFunded=funded.reduce((s,d)=>s+(d.terms?.amt||d.amount||0),0);
  const totalFee=funded.reduce((s,d)=>s+(d.terms?.feeAmt||0),0);
  const winRate=acctDeals.length>0?Math.round((funded.length/(funded.length+dead.length||1))*100):0;

  // Merge all activities
  const allActivities=[
    ...(acc.activities||[]).map(a=>({...a,source:"Account"})),
    ...acctDeals.flatMap(d=>(d.activities||[]).map(a=>({...a,source:d.eqType?`${d.eqType} — ${fmt(d.amount)}`:(d.biz||"Deal")})))
  ].sort((a,b)=>new Date(b.at)-new Date(a.at));

  // Document vault: account-level files + all deal docs
  const vaultFiles=(acc.vault||[]);
  const dealDocs=acctDeals.flatMap(d=>(d.docs||[]).map(doc=>({...doc,dealId:d.id,dealLabel:d.eqType?`${d.eqType} — ${fmt(d.amount)}`:"Deal"})));
  const allDocs=[...vaultFiles.map(f=>({...f,source:"Account Vault"})),...dealDocs.map(f=>({...f,source:f.dealLabel}))].sort((a,b)=>new Date(b.at)-new Date(a.at));

  const addToVault=(name,fromDeal)=>{
    const file={id:gId(),name,at:new Date().toISOString(),by:"admin",fromDeal:fromDeal||null};
    saveAccount({...acc,vault:[...(acc.vault||[]),file]});
  };
  const rmFromVault=(fileId)=>{
    saveAccount({...acc,vault:(acc.vault||[]).filter(f=>f.id!==fileId)});
  };

  const doLogAcct=(typeId)=>{
    addAcctActivity(acc.id,typeId,ACT_TYPES.find(t=>t.id===typeId)?.who||"other",actDetail.trim());
    setActDetail("");setActType(null);
  };

  const stgColor=(stage)=>STAGES.find(s=>s.id===stage)?.color||"#666";

  return(<div>
    <button className="av-ghost" style={{...S.ghost,marginBottom:12}} onClick={onBack}><I.Back/> All Accounts</button>

    {/* Account Header */}
    <div style={{padding:18,background:"#111113",borderRadius:10,border:"1px solid #1E1E20",marginBottom:14}}>
      <div style={{fontSize:20,fontWeight:800,color:"#fff"}}>{acc.biz}</div>
      <div style={{fontSize:12,color:"#888",marginTop:4}}>{acc.contact}{acc.industry?` · ${acc.industry}`:""}{acc.dateStarted?` · Est. ${acc.dateStarted}`:""}</div>
      <div style={{display:"flex",gap:16,marginTop:4,fontSize:11,color:"#666"}}>
        {acc.phone&&<span><I.Phone/> {acc.phone}</span>}
        {acc.email&&<span><I.Mail/> {acc.email}</span>}
      </div>
      {acc.address&&<div style={{fontSize:10,color:"#555",marginTop:4}}>{acc.address}</div>}
      <div style={{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:8,marginTop:14}}>
        {[
          {l:"Total Deals",v:acctDeals.length,c:"#fff"},
          {l:"Active",v:active.length,c:"#E89300"},
          {l:"Funded",v:funded.length,c:"#4CAF50"},
          {l:"Dead/Declined",v:dead.length,c:"#666"},
          {l:"Win Rate",v:winRate+"%",c:winRate>=50?"#4CAF50":"#E89300"},
        ].map((s,i)=><div key={i} style={{textAlign:"center",padding:"8px 4px",background:"#0A0A0A",borderRadius:6,border:"1px solid #1E1E20"}}><div style={{fontSize:16,fontWeight:700,color:s.c}}>{s.v}</div><div style={{fontSize:8,fontWeight:600,color:"#555",textTransform:"uppercase",letterSpacing:.5,marginTop:2}}>{s.l}</div></div>)}
      </div>
      {(totalFunded>0||totalFee>0)&&<div style={{display:"flex",gap:14,marginTop:10,fontSize:12}}>
        <span style={{color:"#4CAF50",fontWeight:600}}>Total Funded: {fmt(totalFunded)}</span>
        {totalFee>0&&<span style={{color:"#4CAF50"}}>Total Fees: ${totalFee.toLocaleString()}</span>}
      </div>}
    </div>

    {/* Tabs */}
    <div style={{display:"flex",gap:4,marginBottom:14}}>
      {[{id:"overview",l:"Opportunities"},{id:"vault",l:`Documents (${allDocs.length})`},{id:"activity",l:`Activity (${allActivities.length})`},{id:"notes",l:"Notes"}].map(t=>
        <button key={t.id} className="av-tab" style={{...S.tab,...(tab===t.id?S.tabA:{})}} onClick={()=>setTab(t.id)}>{t.l}</button>
      )}
    </div>

    {/* Opportunities Tab */}
    {tab==="overview"&&<div>
      {active.length>0&&<div style={{marginBottom:16}}>
        <div style={{fontSize:11,fontWeight:700,color:"#E89300",textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Active ({active.length})</div>
        {active.map(d=><OppRow key={d.id} deal={d} onSel={onSel} stgColor={stgColor}/>)}
      </div>}
      {funded.length>0&&<div style={{marginBottom:16}}>
        <div style={{fontSize:11,fontWeight:700,color:"#4CAF50",textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Funded ({funded.length})</div>
        {funded.map(d=><OppRow key={d.id} deal={d} onSel={onSel} stgColor={stgColor}/>)}
      </div>}
      {dead.length>0&&<div style={{marginBottom:16}}>
        <div style={{fontSize:11,fontWeight:700,color:"#666",textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Dead / Declined ({dead.length})</div>
        {dead.map(d=><OppRow key={d.id} deal={d} onSel={onSel} stgColor={stgColor}/>)}
      </div>}
      {acctDeals.length===0&&<div style={{fontSize:12,color:"#555",fontStyle:"italic"}}>No deals yet for this account.</div>}
    </div>}

    {/* Document Vault Tab */}
    {tab==="vault"&&<div>
      {/* Add to vault */}
      <div style={{padding:12,background:"#111113",borderRadius:8,border:"1px solid #1E1E20",marginBottom:14}}>
        <div style={{fontSize:9,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Add to Document Vault</div>
        <div style={{display:"flex",gap:6}}>
          <input style={{...S.inp,flex:1,fontSize:12}} placeholder="File name (e.g. Torres_DL_2026.pdf)" value={vaultName} onChange={e=>setVaultName(e.target.value)} onKeyDown={e=>{if(e.key==="Enter"&&vaultName.trim()){addToVault(vaultName.trim());setVaultName("")}}}/>
          <button className="av-btn" style={{...S.prim,padding:"6px 12px",fontSize:11}} onClick={()=>{if(vaultName.trim()){addToVault(vaultName.trim());setVaultName("")}}}><I.Upload/> Add</button>
        </div>
      </div>
      {/* Vault files (account-level) */}
      {vaultFiles.length>0&&<div style={{marginBottom:16}}>
        <div style={{fontSize:10,fontWeight:700,color:"#4CAF50",textTransform:"uppercase",letterSpacing:1,marginBottom:6}}>Account Vault ({vaultFiles.length})</div>
        {vaultFiles.map(f=>(
          <div key={f.id} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",background:"#0A0A0A",borderRadius:5,border:"1px solid #1E1E20",marginBottom:3}}>
            <span style={{color:"#4CAF50"}}><I.Doc/></span>
            <div style={{flex:1,minWidth:0}}>
              <div style={{fontSize:11,color:"#ccc",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{f.name}</div>
              <div style={{fontSize:9,color:"#444"}}>{fDT(f.at)}{f.fromDeal?` · saved from deal`:"  · uploaded directly"}</div>
            </div>
            <button style={{...S.tinyBtn,color:"#666"}} onClick={()=>rmFromVault(f.id)}><I.Trash/></button>
          </div>
        ))}
      </div>}
      {/* Deal documents (pulled from all deals) */}
      {dealDocs.length>0&&<div>
        <div style={{fontSize:10,fontWeight:700,color:"#666",textTransform:"uppercase",letterSpacing:1,marginBottom:6}}>From Deals ({dealDocs.length})</div>
        {acctDeals.filter(d=>(d.docs||[]).length>0).map(d=>(
          <div key={d.id} style={{marginBottom:10}}>
            <div style={{fontSize:10,fontWeight:600,color:"#888",marginBottom:4}}>{d.eqType||"Deal"} — {fmt(d.amount)} · {STAGES.find(s=>s.id===d.stage)?.label}</div>
            {(d.docs||[]).map(doc=>(
              <div key={doc.docId} style={{display:"flex",alignItems:"center",gap:8,padding:"5px 8px",background:"#0A0A0A",borderRadius:5,border:"1px solid #111",marginBottom:2}}>
                <span style={{color:"#4F8EAE"}}><I.Doc/></span>
                <div style={{flex:1,minWidth:0}}>
                  <div style={{fontSize:11,color:"#aaa",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{doc.name}</div>
                  <div style={{fontSize:9,color:"#444"}}>{fDT(doc.at)} · {doc.by}</div>
                </div>
                <button className="av-ghost" style={{...S.ghost,padding:"3px 8px",fontSize:9}} onClick={()=>{addToVault(`${doc.name}`,d.id)}}><I.Copy/> Save to Vault</button>
              </div>
            ))}
          </div>
        ))}
      </div>}
      {allDocs.length===0&&<div style={{fontSize:12,color:"#555",fontStyle:"italic"}}>No documents yet.</div>}
    </div>}

    {/* Activity Tab */}
    {tab==="activity"&&<div>
      {/* Log new activity */}
      <div style={{padding:12,background:"#111113",borderRadius:8,border:"1px solid #1E1E20",marginBottom:14}}>
        <div style={{fontSize:9,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Log Activity</div>
        <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8}}>
          {ACT_TYPES.map(t=>(
            <button key={t.id} onClick={()=>setActType(actType===t.id?null:t.id)} style={{
              display:"flex",alignItems:"center",gap:4,padding:"4px 8px",fontSize:10,fontWeight:600,
              borderRadius:6,border:`1px solid ${actType===t.id?t.color:t.color+"33"}`,
              background:actType===t.id?t.color+"18":"transparent",
              color:actType===t.id?t.color:t.color+"99",cursor:"pointer",fontFamily:"inherit",transition:"all .15s"
            }}>{t.icon==="phone"?<I.Phone/>:t.icon==="mail"?<I.Mail/>:<I.Clip/>}{t.label}</button>
          ))}
        </div>
        {actType&&<div style={{display:"flex",gap:6}}>
          <input style={{...S.inp,flex:1,fontSize:12}} placeholder="Details (optional)..." value={actDetail} onChange={e=>setActDetail(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")doLogAcct(actType)}}/>
          <button className="av-btn" style={{...S.prim,padding:"6px 12px",fontSize:11}} onClick={()=>doLogAcct(actType)}>Log</button>
        </div>}
      </div>
      {/* Activity timeline */}
      {allActivities.length===0&&<div style={{fontSize:12,color:"#555",fontStyle:"italic"}}>No activity logged yet.</div>}
      {allActivities.map(a=>{
        const t=ACT_TYPES.find(x=>x.id===a.type);
        return(<div key={a.id} style={{display:"flex",alignItems:"flex-start",gap:10,padding:"8px 0",borderBottom:"1px solid #111"}}>
          <div style={{width:26,height:26,borderRadius:6,background:(t?.color||"#666")+"18",display:"flex",alignItems:"center",justifyContent:"center",color:t?.color||"#666",flexShrink:0,marginTop:1}}>
            {t?.icon==="phone"?<I.Phone/>:t?.icon==="mail"?<I.Mail/>:<I.Clip/>}
          </div>
          <div style={{flex:1,minWidth:0}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <span style={{fontSize:11,fontWeight:600,color:t?.color||"#888"}}>{t?.label||a.type}</span>
              <span style={{fontSize:9,color:"#444"}}>{fDT(a.at)}</span>
            </div>
            {a.detail&&<div style={{fontSize:11,color:"#999",marginTop:1}}>{a.detail}</div>}
            <div style={{fontSize:9,color:"#333",marginTop:2,fontStyle:"italic"}}>{a.source}</div>
          </div>
        </div>);
      })}
    </div>}

    {/* Notes Tab */}
    {tab==="notes"&&<div style={{padding:12,background:"#111113",borderRadius:8,border:"1px solid #1E1E20"}}>
      <div style={{fontSize:12,color:"#ccc",lineHeight:1.7,whiteSpace:"pre-wrap"}}>{acc.notes||"No notes yet."}</div>
    </div>}
  </div>);
}

function OppRow({deal:d,onSel,stgColor}) {
  const stg=STAGES.find(s=>s.id===d.stage);
  return(<div className="av-card" style={{...S.dlrCard,cursor:"pointer",padding:"10px 14px",marginBottom:4}} onClick={()=>onSel(d)}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
      <div>
        <div style={{fontSize:12,fontWeight:600,color:"#ccc"}}>{d.eqDetail||d.eqType||"Equipment"}</div>
        <div style={{fontSize:11,color:"#666",marginTop:1}}>{fmt(d.amount)}{d.terms?` · ${fmt(d.terms.pmt)}/mo · ${d.terms.months}mo`:""}</div>
      </div>
      <div style={{textAlign:"right"}}>
        <span style={{fontSize:10,fontWeight:700,color:stg?.color,padding:"2px 8px",background:(stg?.color||"#666")+"15",borderRadius:4}}>{stg?.label}</span>
        <div style={{fontSize:9,color:"#444",marginTop:3}}>{fDT(d.createdAt)}</div>
      </div>
    </div>
    {d.dealerName&&<div style={{fontSize:10,color:"#555",marginTop:4}}>via {d.dealerName}</div>}
    {d.terms?.feeAmt>0&&<div style={{fontSize:10,color:"#4CAF50",marginTop:2}}>Fee: ${d.terms.feeAmt.toLocaleString()}</div>}
  </div>);
}

function AccountForm({acc,onSave,onClose}) {
  const [f,sf]=useState({
    id:acc?.id||null,biz:acc?.biz||"",contact:acc?.contact||"",email:acc?.email||"",phone:acc?.phone||"",
    address:acc?.address||"",industry:acc?.industry||"",dateStarted:acc?.dateStarted||"",notes:acc?.notes||"",
    activities:acc?.activities||[],createdAt:acc?.createdAt||null
  });
  const u=(k,v)=>sf(p=>({...p,[k]:v}));
  return(<div style={S.overlay} onClick={onClose}><div style={S.modal} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid #1E1E20"}}><span style={{fontSize:15,fontWeight:700,color:"#fff"}}>{f.id?"Edit Account":"New Account"}</span><button style={S.closeBtn} onClick={onClose}><I.X/></button></div>
    <div style={{padding:"14px 18px",overflowY:"auto",maxHeight:"60vh"}}>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px"}}>
        <FF l="Business Name *" v={f.biz} ch={v=>u("biz",v)}/>
        <FF l="Primary Contact" v={f.contact} ch={v=>u("contact",v)}/>
        <FF l="Email" v={f.email} ch={v=>u("email",v)} t="email"/>
        <FF l="Phone" v={f.phone} ch={v=>u("phone",v)}/>
        <FF l="Industry" v={f.industry} ch={v=>u("industry",v)} ph="e.g. Towing & Recovery"/>
        <FF l="Year Started" v={f.dateStarted} ch={v=>u("dateStarted",v)} ph="e.g. 2018"/>
      </div>
      <div style={{marginTop:8}}><FF l="Address" v={f.address} ch={v=>u("address",v)} ph="Full address"/></div>
      <div style={{marginTop:8}}><label style={S.fLabel}>Notes</label><textarea style={{...S.inp,resize:"vertical",minHeight:60}} value={f.notes} onChange={e=>u("notes",e.target.value)} placeholder="Any background notes on this customer..."/></div>
    </div>
    <div style={{display:"flex",gap:8,justifyContent:"flex-end",padding:"12px 18px",borderTop:"1px solid #1E1E20"}}><button className="av-ghost" style={S.ghost} onClick={onClose}>Cancel</button><button className="av-btn" style={S.prim} onClick={()=>{if(!f.biz.trim())return;onSave(f)}}>{f.id?"Save":"Create"}</button></div>
  </div></div>);
}

// ── Activity Log ──────────────────────────────────────────────

const ACT_TYPES = [
  {id:"call_cust",label:"Called Customer",icon:"phone",color:"#4CAF50",who:"customer"},
  {id:"email_cust",label:"Emailed Customer",icon:"mail",color:"#4F8EAE",who:"customer"},
  {id:"call_dlr",label:"Called Dealer",icon:"phone",color:"#E89300",who:"dealer"},
  {id:"email_dlr",label:"Emailed Dealer",icon:"mail",color:"#E89300",who:"dealer"},
  {id:"call_lndr",label:"Called Lender",icon:"phone",color:"#9C27B0",who:"lender"},
  {id:"email_lndr",label:"Emailed Lender",icon:"mail",color:"#9C27B0",who:"lender"},
  {id:"other",label:"Other",icon:"clip",color:"#666",who:"other"},
];

function ActivityLog({deal}) {
  const {addActivity} = useContext(Ctx);
  const [detail,setDetail]=useState("");
  const [selType,setSelType]=useState(null);
  const acts=(deal.activities||[]).slice().reverse();

  const doLog=(typeId)=>{
    const t=ACT_TYPES.find(a=>a.id===typeId);
    addActivity(deal.id,typeId,t?.who||"other",detail.trim());
    setDetail("");
    setSelType(null);
  };

  const iconFor=(type)=>{
    const t=ACT_TYPES.find(a=>a.id===type);
    if(!t)return <I.Clip/>;
    if(t.icon==="phone")return <I.Phone/>;
    if(t.icon==="mail")return <I.Mail/>;
    return <I.Clip/>;
  };

  return(
    <Sec t={`Activity Log (${acts.length})`}>
      {/* Quick action buttons */}
      <div style={{display:"flex",gap:4,flexWrap:"wrap",marginBottom:8}}>
        {ACT_TYPES.map(t=>(
          <button key={t.id} onClick={()=>setSelType(selType===t.id?null:t.id)} style={{
            display:"flex",alignItems:"center",gap:4,padding:"4px 8px",fontSize:10,fontWeight:600,
            borderRadius:6,border:`1px solid ${selType===t.id?t.color:t.color+"33"}`,
            background:selType===t.id?t.color+"18":"transparent",
            color:selType===t.id?t.color:t.color+"99",cursor:"pointer",fontFamily:"inherit",
            transition:"all .15s"
          }}>
            {t.icon==="phone"?<I.Phone/>:t.icon==="mail"?<I.Mail/>:<I.Clip/>}
            {t.label}
          </button>
        ))}
      </div>
      {/* Detail input + log button */}
      {selType&&<div style={{display:"flex",gap:6,marginBottom:10}}>
        <input style={{...S.inp,flex:1,fontSize:12}} placeholder="Add details (optional)..." value={detail} onChange={e=>setDetail(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")doLog(selType)}}/>
        <button className="av-btn" style={{...S.prim,padding:"6px 12px",fontSize:11,background:ACT_TYPES.find(a=>a.id===selType)?.color+"22",border:`1px solid ${ACT_TYPES.find(a=>a.id===selType)?.color+"44"}`,color:ACT_TYPES.find(a=>a.id===selType)?.color}} onClick={()=>doLog(selType)}>Log</button>
      </div>}
      {/* Activity list */}
      {acts.length===0&&<div style={{fontSize:11,color:"#444",fontStyle:"italic"}}>No activity logged yet</div>}
      {acts.map(a=>{
        const t=ACT_TYPES.find(x=>x.id===a.type);
        return(<div key={a.id} style={{display:"flex",alignItems:"flex-start",gap:8,padding:"6px 0",borderBottom:"1px solid #111"}}>
          <div style={{width:24,height:24,borderRadius:6,background:(t?.color||"#666")+"18",display:"flex",alignItems:"center",justifyContent:"center",color:t?.color||"#666",flexShrink:0,marginTop:1}}>
            {iconFor(a.type)}
          </div>
          <div style={{flex:1,minWidth:0}}>
            <div style={{fontSize:11,fontWeight:600,color:t?.color||"#888"}}>{t?.label||a.type}</div>
            {a.detail&&<div style={{fontSize:11,color:"#999",marginTop:1}}>{a.detail}</div>}
            <div style={{fontSize:9,color:"#444",marginTop:2}}>{fDT(a.at)}</div>
          </div>
        </div>);
      })}
    </Sec>
  );
}

// ── Dealer & Lender Management ────────────────────────────────

function DlrMgmt() {
  const {dealers,deals,addDlr,updDlr} = useContext(Ctx);
  const [form,setForm]=useState(false);
  const [ed,setEd]=useState(null);
  return(<div>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><div style={{fontSize:15,fontWeight:700,color:"#fff"}}>Dealer Partners</div><button className="av-btn" style={S.prim} onClick={()=>{setEd(null);setForm(true)}}><I.Plus/> Add Dealer</button></div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(290px,1fr))",gap:10}}>{dealers.map(dl=>{const cnt=deals.filter(d=>d.dealerId===dl.id).length,fun=deals.filter(d=>d.dealerId===dl.id&&d.stage==="funded").reduce((s,d)=>s+(d.amount||0),0);return(
      <div key={dl.id} className="av-card" style={S.dlrCard}><div style={{display:"flex",justifyContent:"space-between"}}><div><div style={{fontSize:14,fontWeight:700,color:"#fff"}}>{dl.name}</div><div style={{fontSize:11,color:"#777",marginTop:2}}>{dl.contact} · {dl.region}</div></div><button style={S.tinyBtn} onClick={()=>{setEd(dl);setForm(true)}}><I.Edit/></button></div>
        {dl.salesRep&&<div style={{marginTop:6,padding:"6px 8px",background:"#0A0A0A",borderRadius:5,border:"1px solid #1E1E20"}}>
          <div style={{fontSize:8,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:.8,marginBottom:3}}>Sales Rep</div>
          <div style={{fontSize:11,color:"#ccc",fontWeight:600}}>{dl.salesRep}</div>
          <div style={{fontSize:10,color:"#666",marginTop:1}}>{[dl.salesRepPhone,dl.salesRepEmail].filter(Boolean).join(" · ")}</div>
        </div>}
        <div style={{display:"flex",gap:4,flexWrap:"wrap",margin:"8px 0"}}>{(dl.specs||[]).map(sp=><span key={sp} style={S.specB}>{sp}</span>)}</div>
        <div style={{display:"flex",gap:14,fontSize:11,color:"#777"}}><span><strong style={{color:"#fff"}}>{cnt}</strong> deals</span><span><strong style={{color:"#4CAF50"}}>{fmt(fun)}</strong> funded</span>{dl.referralPts>0&&<span style={{color:"#4F8EAE"}}>{dl.referralPts}pts referral</span>}</div>
        <div style={{marginTop:5,fontFamily:"'JetBrains Mono',monospace",fontSize:10,color:"#4F8EAE"}}>Code: {dl.code}</div>
      </div>)})}</div>
    {form&&<DlrForm dlr={ed} onSave={d=>{ed?updDlr(d):addDlr(d);setForm(false);setEd(null)}} onClose={()=>{setForm(false);setEd(null)}}/>}
  </div>);
}

function LndrMgmt() {
  const {lenders,setLenders} = useContext(Ctx);
  const [form,setForm]=useState(false);
  const [ed,setEd]=useState(null);
  const save=l=>{if(l.id)setLenders(p=>p.map(x=>x.id===l.id?l:x));else setLenders(p=>[...p,{...l,id:"l"+Date.now().toString(36)}]);setForm(false);setEd(null)};
  return(<div>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><div style={{fontSize:15,fontWeight:700,color:"#fff"}}>Lender Configuration</div><button className="av-btn" style={S.prim} onClick={()=>{setEd(null);setForm(true)}}><I.Plus/> Add Lender</button></div>
    <div style={{display:"flex",flexDirection:"column",gap:8}}>{lenders.map(l=>(
      <div key={l.id} className="av-row" style={S.lndrRow}><div style={{flex:1}}>
        <div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:13,fontWeight:600,color:"#fff"}}>{l.name}</span><span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:10,color:"#4F8EAE",background:"#4F8EAE11",padding:"1px 6px",borderRadius:3}}>{l.code}</span></div>
        <div style={{fontSize:10,color:"#666",marginTop:3}}>Tax: {l.taxRule==="include"?"Always included":l.taxRule==="exclude"?"Always excluded":"Customer choice"}</div>
        <div style={{fontSize:10,color:"#555",marginTop:2}}>{l.lienholder}</div><div style={{fontSize:9,color:"#444"}}>{l.address}</div>
      </div><button style={S.tinyBtn} onClick={()=>{setEd(l);setForm(true)}}><I.Edit/></button></div>
    ))}</div>
    {form&&<LndrForm lndr={ed} onSave={save} onClose={()=>{setForm(false);setEd(null)}}/>}
  </div>);
}

function Settings() {
  const {deals,dealers,lenders,accounts,dnotes,notify} = useContext(Ctx);
  const [lastBackup,setLastBackup]=useState(null);
  const [importing,setImporting]=useState(false);
  const [restoreMsg,setRestoreMsg]=useState(null);
  const fileRef=useRef(null);

  const doExport=()=>{
    const backup={version:1,exportedAt:new Date().toISOString(),data:{deals,dealers,lenders,accounts,dnotes}};
    const blob=new Blob([JSON.stringify(backup,null,2)],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;a.download=`avanti-backup-${new Date().toISOString().slice(0,10)}.json`;
    document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
    setLastBackup(new Date().toLocaleString());
    notify("Backup downloaded","ok");
  };

  const doImport=(e)=>{
    const file=e.target.files?.[0];
    if(!file)return;
    setImporting(true);setRestoreMsg(null);
    const reader=new FileReader();
    reader.onload=(ev)=>{
      try{
        const backup=JSON.parse(ev.target.result);
        if(!backup.data||!backup.data.deals){setRestoreMsg("Invalid backup file");setImporting(false);return}
        const d=backup.data;
        const summary=`${d.deals?.length||0} deals, ${d.accounts?.length||0} accounts, ${d.dealers?.length||0} dealers`;
        if(window.confirm(`Restore backup from ${backup.exportedAt||"unknown date"}?\n\nThis contains: ${summary}\n\nThis will REPLACE all current data.`)){
          // Write to storage
          const write=async()=>{
            try{
              if(d.deals) localStorage.setItem("av5_deals",JSON.stringify(d.deals));
              if(d.dealers) localStorage.setItem("av5_dlrs",JSON.stringify(d.dealers));
              if(d.lenders) localStorage.setItem("av5_lndr",JSON.stringify(d.lenders));
              if(d.accounts) localStorage.setItem("av5_acct",JSON.stringify(d.accounts));
              if(d.dnotes) localStorage.setItem("av5_notes",JSON.stringify(d.dnotes));
            }catch(e){}
            setRestoreMsg("Backup restored! Refresh the page to see your data.");
            notify("Backup restored — refresh page","ok");
          };
          write();
        }
      }catch(err){setRestoreMsg("Error reading file: "+err.message)}
      setImporting(false);
    };
    reader.readAsText(file);
    e.target.value="";
  };

  const dealStats={total:deals.length,active:deals.filter(d=>!["funded","declined","dead"].includes(d.stage)).length,funded:deals.filter(d=>d.stage==="funded").length,dead:deals.filter(d=>["dead","declined"].includes(d.stage)).length};

  return(<div><div style={{fontSize:15,fontWeight:700,color:"#fff",marginBottom:14}}>Settings & Integration</div>
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>

      {/* BACKUP CARD */}
      <div style={{...S.setCard,border:"1px solid #2A5A3A",gridColumn:"1 / -1"}}>
        <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:4}}><I.Shield/><div style={{...S.setT,color:"#4CAF50",margin:0}}>Data Backup & Restore</div></div>
        <div style={S.setD}>Your data is stored in this browser. Export backups regularly to keep it safe.</div>
        <div style={{marginTop:12,display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"}}>
          <button className="av-btn" onClick={doExport} style={{background:"#4CAF50",color:"#fff",border:"none",borderRadius:8,padding:"10px 20px",fontWeight:700,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6}}>
            <I.Download/> Export Backup
          </button>
          <button className="av-btn" onClick={()=>fileRef.current?.click()} style={{background:"#333",color:"#ccc",border:"1px solid #444",borderRadius:8,padding:"10px 20px",fontWeight:700,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6}}>
            <I.Upload/> Restore from Backup
          </button>
          <input ref={fileRef} type="file" accept=".json" onChange={doImport} style={{display:"none"}}/>
        </div>
        <div style={{marginTop:10,display:"flex",gap:16,fontSize:11,color:"#666"}}>
          <span>Deals: <b style={{color:"#ccc"}}>{dealStats.total}</b> ({dealStats.active} active, {dealStats.funded} funded)</span>
          <span>Accounts: <b style={{color:"#ccc"}}>{accounts.length}</b></span>
          <span>Dealers: <b style={{color:"#ccc"}}>{dealers.length}</b></span>
        </div>
        {lastBackup&&<div style={{marginTop:6,fontSize:11,color:"#4CAF50"}}>Last backup: {lastBackup}</div>}
        {restoreMsg&&<div style={{marginTop:6,fontSize:11,color:restoreMsg.includes("Error")?"#F44336":"#4CAF50",fontWeight:600}}>{restoreMsg}</div>}
      </div>

      <div style={S.setCard}><div style={S.setT}>Jotform Integration</div><div style={S.setD}>Connect your Jotform credit app to auto-create deals.</div><div style={{marginTop:10,fontFamily:"'JetBrains Mono',monospace",fontSize:10,color:"#4F8EAE",background:"#0A0A0A",padding:"8px 12px",borderRadius:5,overflowX:"auto"}}>Webhook: https://app.avantiequipfi.com/api/jotform</div></div>
      <div style={S.setCard}><div style={S.setT}>Magic Links</div><div style={S.setD}>Auto-login URLs for customers and dealers.</div><div style={{marginTop:10,fontSize:10,color:"#666",lineHeight:1.8}}>Customer: <span style={{color:"#4F8EAE"}}>?portal=customer&code=TOR-7721</span><br/>Dealer: <span style={{color:"#4F8EAE"}}>?portal=dealer&code=NTS2026</span></div></div>
      <div style={S.setCard}><div style={S.setT}>Notifications</div><div style={S.setD}>Email/SMS triggers when deals move between stages. Coming soon.</div></div>
      <div style={S.setCard}><div style={S.setT}>Account Manager</div><div style={S.setD}>Contact info shown to customers.</div><div style={{marginTop:8,fontSize:12,color:"#ccc"}}>{AM.name}<br/><span style={{color:"#888"}}>{AM.title}</span><br/><span style={{color:"#4F8EAE"}}>{AM.phone} · {AM.email}</span></div></div>
    </div></div>);
}

// ════════════════════════════════════════════════════════════════
// DEALER PORTAL
// ════════════════════════════════════════════════════════════════

function DealerDash({did,out}) {
  const {deals,dealers,saveDeal,addDoc} = useContext(Ctx);
  const dlr = dealers.find(d=>d.id===did);
  const dd = useMemo(()=>deals.filter(d=>d.dealerId===did),[deals,did]);
  const [sub,setSub]=useState(false);
  const [sel,setSel]=useState(null);
  const stats = useMemo(()=>({act:dd.filter(d=>!["funded","declined","dead"].includes(d.stage)).length,fun:dd.filter(d=>d.stage==="funded").length,totF:dd.filter(d=>d.stage==="funded").reduce((s,d)=>s+(d.amount||0),0),pen:dd.filter(d=>["app_submitted","in_review"].includes(d.stage)).length}),[dd]);

  return(<div style={S.pWrap}>
    <div style={S.pHead}><div><div style={{fontSize:20,fontWeight:700,color:"#fff"}}>Welcome, {dlr?.contact}</div><div style={{fontSize:12,color:"#777"}}>{dlr?.name}</div></div><button className="av-btn" style={S.prim} onClick={()=>setSub(true)}><I.Plus/> Submit New Deal</button></div>
    <div style={S.statsG}>{[{l:"Active",v:stats.act,c:"#fff"},{l:"Pending",v:stats.pen,c:"#6BA3BF"},{l:"Funded",v:stats.fun,c:"#4CAF50"},{l:"Total Funded",v:fmt(stats.totF),c:"#4CAF50"},{l:"Action Needed",v:dd.filter(d=>(d.fundingItems||[]).some(f=>!f.done)).length,c:dd.filter(d=>(d.fundingItems||[]).some(f=>!f.done)).length>0?"#E89300":"#333"}].map((s,i)=><div key={i} style={S.statC}><div style={{...S.statV,color:s.c}}>{s.v}</div><div style={S.statL}>{s.l}</div></div>)}</div>
    <div style={{marginTop:20}}><div style={{fontSize:14,fontWeight:700,color:"#fff",marginBottom:12}}>Your Referred Deals</div>
      {dd.length===0?<div style={S.empty}><I.Truck/><div style={{marginTop:8,fontSize:13,fontWeight:600,color:"#555"}}>No deals yet</div></div>
      :<div style={{display:"flex",flexDirection:"column",gap:8}}>{[...dd.filter(d=>d.stage!=="dead")].sort((a,b)=>new Date(b.updatedAt||0)-new Date(a.updatedAt||0)).map(d=>{const stg=STAGES.find(s=>s.id===d.stage);const pendFI=(d.fundingItems||[]).filter(f=>!f.done).length;const hasAccepted=d.accepted;return(
        <div key={d.id} className="av-row" style={{...S.dlrDealRow,...(pendFI>0?{borderLeftColor:"#E89300",borderLeftWidth:3}:{})}} onClick={()=>setSel(d)}>
          <div style={{flex:1}}>
            <div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontWeight:600,color:"#fff",fontSize:14}}>{d.biz}</span>
              {pendFI>0&&<span style={{fontSize:8,padding:"2px 6px",borderRadius:8,background:"#E89300",color:"#fff",fontWeight:700,animation:"fadeIn .3s"}}>ACTION NEEDED</span>}
              {hasAccepted&&pendFI===0&&d.stage==="approved"&&<span style={{fontSize:8,padding:"2px 6px",borderRadius:8,background:"#4CAF50",color:"#fff",fontWeight:700}}>ACCEPTED</span>}
            </div>
            <div style={{fontSize:12,color:"#777",marginTop:2}}>{d.contact} · {d.eqType}</div>
            {pendFI>0&&<div style={{fontSize:10,color:"#E89300",marginTop:2}}><I.Alert/> {pendFI} item{pendFI!==1?"s":""} to attach before docs go out</div>}
          </div>
          <div style={{textAlign:"right"}}><div style={{fontWeight:600,color:"#6BA3BF",fontSize:14}}>{fmt(d.amount)}</div><span style={{...S.badge,background:stg?.color+"18",color:stg?.color,borderColor:stg?.color+"33",fontSize:10}}>{stg?.label}</span></div>
        </div>)})}</div>}
    </div>
    {sel&&<DealerDrawer dealId={sel.id} onClose={()=>setSel(null)}/>}
    {sub&&<DealForm deal={{dealerId:did,dealerName:dlr?.name,source:"Dealer Referral",stage:"new_lead"}} onSave={d=>{saveDeal(d);setSub(false)}} onClose={()=>setSub(false)} isDlr/>}
  </div>);
}

function DealerDrawer({dealId,onClose}) {
  const {deals,addDoc} = useContext(Ctx);
  const sel = deals.find(d=>d.id===dealId);
  if(!sel) return null;
  const stg=STAGES.find(s=>s.id===sel.stage);
  // Filter activities to only show customer-related communication
  const custActivities=(sel.activities||[]).filter(a=>a.who==="customer"||a.type==="call_cust"||a.type==="email_cust");
  return(
    <div style={S.overlay} onClick={onClose}><div style={{...S.drawer,maxWidth:460}} onClick={e=>e.stopPropagation()}>
      <div style={S.drHead}><div><div style={{fontSize:17,fontWeight:700,color:"#fff"}}>{sel.biz}</div><span style={{...S.badge,background:stg?.color+"18",color:stg?.color}}>{stg?.label}</span></div><button style={S.closeBtn} onClick={onClose}><I.X/></button></div>
      <div style={S.drBody}>
        <Sec t="Contact"><div style={S.field}><I.User/> {sel.contact}</div>{sel.phone&&<div style={S.field}><I.Phone/> {sel.phone}</div>}{sel.email&&<div style={S.field}><I.Mail/> {sel.email}</div>}</Sec>
        <Sec t="Equipment"><div style={{fontSize:14,color:"#fff"}}>{sel.eqType}</div>
          {(sel.eqYear||sel.eqMake||sel.eqModel)&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginTop:6}}><FB l="Year" v={sel.eqYear||"—"}/><FB l="Make" v={sel.eqMake||"—"}/><FB l="Model" v={sel.eqModel||"—"}/></div>}
          {sel.eqVin&&<div style={{marginTop:6}}><FB l="VIN" v={sel.eqVin} vs={{fontFamily:"'JetBrains Mono',monospace",fontSize:11,letterSpacing:.5}}/></div>}
          {sel.eqMileage&&<div style={{marginTop:4}}><FB l="Mileage" v={Number(sel.eqMileage).toLocaleString()+" mi"}/></div>}
          {sel.eqDetail&&<div style={{fontSize:12,color:"#777",marginTop:4}}>{sel.eqDetail}</div>}
          <div style={{fontSize:17,fontWeight:700,color:"#6BA3BF",marginTop:6}}>{fmt(sel.amount)}</div></Sec>
        {sel.terms&&<Sec t="Approval"><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><FB l="Approved Amount" v={fmt(sel.terms.amt)} vs={{color:"#4CAF50"}}/><FB l="Monthly Payment" v={fmt(sel.terms.pmt)}/><FB l="Term" v={`${sel.terms.months}mo`}/></div>{sel.accepted&&<div style={{marginTop:6,fontSize:11,color:"#4CAF50"}}>✓ Customer accepted</div>}</Sec>}
        <Sec t="Documents">{REQ_DOCS.map(doc=>{const up=(sel.docs||[]).find(x=>x.docId===doc.id);return(<div key={doc.id} style={S.docRow}><div style={{display:"flex",alignItems:"center",gap:7}}>{up?<span style={{color:"#4CAF50"}}><I.CheckCirc/></span>:<div style={{width:14,height:14,borderRadius:"50%",border:"1.5px solid #444"}}/>}<span style={{fontSize:11,color:up?"#ccc":"#555"}}>{doc.label}</span></div>
          {!up&&<button style={S.tinyBtn} onClick={()=>addDoc(sel.id,{docId:doc.id,name:`${doc.label.replace(/\s/g,"_")}.pdf`,at:new Date().toISOString(),by:"dealer"})}><I.Upload/></button>}</div>)})}</Sec>
        <ItemsNeededSection deal={sel} role="dealer"/>
        <FundingItemsSection deal={sel} role="dealer"/>
        {custActivities.length>0&&<Sec t={`Customer Updates (${custActivities.length})`}>{custActivities.slice().reverse().map((a,i)=><div key={i} style={{padding:"6px 0 6px 12px",borderLeft:"2px solid #4F8EAE",marginLeft:4,marginBottom:4}}><div style={{fontSize:11,color:"#ccc"}}>{a.detail||({call_cust:"Called customer",email_cust:"Emailed customer"}[a.type]||a.type)}</div><div style={{fontSize:9,color:"#444"}}>{fDT(a.at)}</div></div>)}</Sec>}
        <Sec t="Application Status"><div style={{...S.statusCard,borderColor:stg?.color+"33",margin:0}}><div style={{fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:stg?.color}}>{stg?.label}</div><div style={{fontSize:12,color:"#888",marginTop:4}}>Last updated {fDT(sel.updatedAt)}</div></div></Sec>
      </div>
    </div></div>
  );
}

// ════════════════════════════════════════════════════════════════
// CUSTOMER PORTAL
// ════════════════════════════════════════════════════════════════

function CustDash({did,out}) {
  const {deals,lenders,acceptDeal,addDoc} = useContext(Ctx);
  const d = deals.find(x=>x.id===did);
  const [tc,setTc]=useState(null);
  if(!d)return(<div style={S.loginWrap}><div style={S.loginCard}><div style={{fontSize:14,color:"#B0413E"}}>Application not found.</div><button className="av-ghost" style={S.ghost} onClick={out}><I.Back/> Try Again</button></div></div>);

  const cs = CUST_STAGES[d.stage];
  const stg = STAGES.find(s=>s.id===d.stage);
  const lndr = lenders.find(l=>l.id===d.lenderId);
  const hideP = d.stage==="declined"||d.stage==="dead";
  const canAcc = d.stage==="approved"&&d.terms&&!d.accepted;
  const pastApproved = ["docs_out","funded"].includes(d.stage);
  const showLH = (d.accepted||pastApproved)&&lndr;

  return(<div style={S.pWrap}><div style={S.custCard}>
    <div style={{textAlign:"center",marginBottom:24}}>
      <div style={{fontSize:12,color:"#666",marginBottom:4}}>Application for</div>
      <div style={{fontSize:22,fontWeight:800,color:"#fff"}}>{d.biz}</div>
      <div style={{fontSize:13,color:"#777",marginTop:4}}>{d.eqType} · {fmt(d.amount)}</div>
      {(d.eqYear||d.eqMake||d.eqModel)&&<div style={{fontSize:11,color:"#555",marginTop:2}}>{[d.eqYear,d.eqMake,d.eqModel].filter(Boolean).join(" ")}</div>}
      {d.eqVin&&<div style={{fontSize:10,color:"#444",fontFamily:"'JetBrains Mono',monospace",marginTop:1}}>VIN: {d.eqVin}</div>}
    </div>
    {!hideP&&<div style={{marginBottom:24}}>
      <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}><span style={{fontSize:11,color:"#666"}}>Progress</span><span style={{fontSize:11,fontWeight:700,color:stg?.color}}>{cs?.progress}%</span></div>
      <div style={S.progTrack}><div style={{...S.progFill,width:`${cs?.progress||0}%`,background:`linear-gradient(90deg,#4F8EAE,${stg?.color})`,animation:"progFill 1s ease-out"}}/></div>
      <div style={{display:"flex",justifyContent:"space-between",marginTop:10}}>{STAGES.filter(s=>!["declined","dead"].includes(s.id)).map(s=>{const on=s.order<=(stg?.order||0);return(<div key={s.id} style={{textAlign:"center",flex:1}}><div style={{width:9,height:9,borderRadius:"50%",background:on?s.color:"#1E1E20",border:`2px solid ${on?s.color:"#2A2A2E"}`,margin:"0 auto",transition:"all .3s"}}/><div style={{fontSize:7,color:on?"#888":"#333",marginTop:3,textTransform:"uppercase",letterSpacing:.4}}>{s.label}</div></div>)})}</div>
    </div>}
    <div style={{...S.statusCard,borderColor:stg?.color+"33"}}><div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1.5,color:stg?.color}}>Current Status</div><div style={{fontSize:18,fontWeight:700,color:"#fff",margin:"5px 0"}}>{cs?.label}</div><div style={{fontSize:13,color:"#999",lineHeight:1.6}}>{cs?.desc}</div></div>
    {d.terms&&<div style={{marginTop:18}}><div style={S.approvalBox}>
      <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1.5,color:"#4CAF50",marginBottom:10}}>Approval Details</div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}><FB l="Approved Amount" v={fmt(d.terms.amt)} vs={{color:"#4CAF50",fontSize:17}}/><FB l="Monthly Payment" v={fmt(d.terms.pmt)} vs={{fontSize:17}}/><FB l="Term" v={`${d.terms.months} months`}/></div>
      {canAcc&&<div style={{marginTop:14}}>
        {d.showTaxChoice&&<div style={{marginBottom:10}}><div style={{fontSize:11,fontWeight:600,color:"#ccc",marginBottom:6}}>Would you like to finance your sales tax?</div><div style={{display:"flex",gap:8}}>{[{v:true,l:"Yes, include in financing"},{v:false,l:"No, I'll pay separately"}].map(o=><button key={String(o.v)} onClick={()=>setTc(o.v)} style={{flex:1,padding:"10px",fontSize:12,fontWeight:600,background:tc===o.v?"#4F8EAE22":"#161618",border:`1px solid ${tc===o.v?"#4F8EAE":"#1E1E20"}`,color:tc===o.v?"#4F8EAE":"#888",borderRadius:7,cursor:"pointer",fontFamily:"inherit"}}>{o.l}</button>)}</div></div>}
        <button className="av-btn" style={{...S.prim,width:"100%",padding:"12px",fontSize:14,justifyContent:"center",background:"#4CAF50"}} onClick={()=>{if(d.showTaxChoice&&tc===null)return;acceptDeal(d.id,tc)}}><I.Check/> Accept Approval</button>
      </div>}
      {d.accepted&&<div style={{marginTop:10,padding:"8px 12px",background:"#4CAF5012",border:"1px solid #4CAF5033",borderRadius:6,color:"#4CAF50",fontSize:11,fontWeight:600}}>✓ Accepted{d.taxChoice!==null&&<span style={{color:"#888",fontWeight:400}}> · Tax: {d.taxChoice?"Financed":"Separate"}</span>}</div>}
    </div></div>}
    {showLH&&<div style={{marginTop:14,padding:"14px 18px",background:"#161618",border:"1px solid #1E1E20",borderRadius:8}}><div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1.5,color:"#666",marginBottom:6}}>Insurance Lienholder Information</div><div style={{fontSize:11,color:"#999",marginBottom:8,lineHeight:1.5}}>Please provide the following lienholder information to your insurance agent. Your insurance policy must list this entity as the lienholder/loss payee.</div><div style={{fontSize:13,fontWeight:600,color:"#fff"}}>{lndr.lienholder}</div><div style={{fontSize:11,color:"#888",marginTop:2}}>{lndr.address}</div></div>}
    <div style={{marginTop:20}}><div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1.5,color:"#555",marginBottom:8}}>Required Documents</div>{REQ_DOCS.filter(doc=>{const isReq=d.docReqs?.[doc.id]!==undefined?d.docReqs[doc.id]:doc.req;return isReq}).map(doc=>{const up=(d.docs||[]).find(x=>x.docId===doc.id);return(<div key={doc.id} style={{...S.docRow,marginBottom:3}}><div style={{display:"flex",alignItems:"center",gap:7,flex:1}}>{up?<span style={{color:"#4CAF50"}}><I.CheckCirc/></span>:<div style={{width:14,height:14,borderRadius:"50%",border:"1.5px solid #444"}}/>}<span style={{fontSize:11,color:up?"#ccc":"#888"}}>{doc.label}</span></div>{up?<span style={{fontSize:10,color:"#4CAF50"}}>✓</span>:<button className="av-ghost" style={{...S.ghost,padding:"3px 8px",fontSize:10}} onClick={()=>addDoc(d.id,{docId:doc.id,name:`${doc.label.replace(/[\s()]/g,"_")}.pdf`,at:new Date().toISOString(),by:"customer"})}><I.Upload/> Upload</button>}</div>)})}</div>
    {(d.stips||[]).length>0&&<div style={{marginTop:18}}><ItemsNeededSection deal={d} role="customer"/></div>}
    <div style={{marginTop:20}}><div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1.5,color:"#555",marginBottom:8}}>Timeline</div>{(d.history||[]).slice().reverse().map((h,i)=>{const hs=STAGES.find(s=>s.id===h.s),ch=CUST_STAGES[h.s];return(<div key={i} style={{padding:"7px 0 7px 12px",borderLeft:`2px solid ${hs?.color||"#333"}`,marginLeft:6}}><div style={{fontSize:12,fontWeight:600,color:hs?.color}}>{ch?.label||hs?.label}</div><div style={{fontSize:10,color:"#555",marginTop:1}}>{fDT(h.d)}</div></div>)})}</div>
    <div style={S.amCard}><div style={S.amAv}><I.User/></div><div><div style={{fontSize:13,fontWeight:600,color:"#fff"}}>{AM.name}</div><div style={{fontSize:11,color:"#777"}}>{AM.title}</div><div style={{fontSize:12,color:"#4F8EAE",marginTop:2}}>{AM.phone} · {AM.email}</div></div></div>
  </div></div>);
}

// ════════════════════════════════════════════════════════════════
// CREDIT APPLICATION PAGE
// ════════════════════════════════════════════════════════════════

const APP_STEPS=["Business Info","Ownership","Bank & References","Equipment","Review & Submit"];
const APP_ICONS=["🏢","👤","🏦","🚛","✓"];
const LEGAL_STRUCTS=["LLC","Corporation","Sole Proprietorship","Partnership","S-Corp","Other"];
const EMPTY_APP={bizName:"",dba:"",bizType:"",bizAddress:"",bizCity:"",bizState:"",bizZip:"",bizPhone:"",bizEmail:"",fedId:"",legalStructure:"",employees:"",dateStarted:"",
o1Name:"",o1Title:"",o1Pct:"100",o1Address:"",o1City:"",o1State:"",o1Zip:"",o1Cell:"",o1Ssn:"",o1Dob:"",
o2Name:"",o2Title:"",o2Pct:"",o2Address:"",o2City:"",o2State:"",o2Zip:"",o2Cell:"",o2Ssn:"",o2Dob:"",hasOwner2:false,
bankName:"",bankAcct:"",bankPhone:"",bankContact:"",trade1:"",trade1Ph:"",trade2:"",trade2Ph:"",
vendorName:"",vendorPhone:"",salesPerson:"",
eqType:"",eqDesc:"",eqYear:"",eqMake:"",eqModel:"",eqVin:"",eqMileage:"",newUsed:"New",price:"",termReq:"",
agreeTerms:false,dealerCode:""};

function AF({l,v,ch,type="text",ph,required,err,span,sensitive,mono}){const[show,setShow]=useState(!sensitive);return(<div style={span===2?{gridColumn:"1/-1"}:{}}>
    <label style={{display:"block",fontSize:10,fontWeight:600,color:err?"#B0413E":"#666",marginBottom:3,textTransform:"uppercase",letterSpacing:.5}}>{l}{required&&<span style={{color:"#B0413E",marginLeft:2}}>*</span>}</label>
    <div style={{position:"relative"}}><input type={sensitive&&!show?"password":type} value={v} onChange={e=>ch(e.target.value)} placeholder={ph||""} style={{width:"100%",padding:"9px 12px",fontSize:13,color:"#e0e0e8",background:"#0E0E10",border:`1px solid ${err?"#B0413E44":"#1E1E20"}`,borderRadius:6,fontFamily:mono?"'JetBrains Mono',monospace":"inherit",outline:"none",transition:"border .15s"}} onFocus={e=>{e.target.style.borderColor="#4F8EAE"}} onBlur={e=>{e.target.style.borderColor=err?"#B0413E44":"#1E1E20"}}/>
    {sensitive&&<button onClick={()=>setShow(!show)} style={{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"#555",cursor:"pointer",fontSize:10,fontFamily:"inherit"}}>{show?"Hide":"Show"}</button>}</div>
    {err&&<div style={{fontSize:10,color:"#B0413E",marginTop:2}}>{err}</div>}
  </div>)}
function ASel({l,v,ch,opts,required,err}){return(<div>
    <label style={{display:"block",fontSize:10,fontWeight:600,color:err?"#B0413E":"#666",marginBottom:3,textTransform:"uppercase",letterSpacing:.5}}>{l}{required&&<span style={{color:"#B0413E",marginLeft:2}}>*</span>}</label>
    <select value={v} onChange={e=>ch(e.target.value)} style={{width:"100%",padding:"9px 12px",fontSize:13,color:v?"#e0e0e8":"#555",background:"#0E0E10",border:`1px solid ${err?"#B0413E44":"#1E1E20"}`,borderRadius:6,fontFamily:"inherit",cursor:"pointer",outline:"none"}}><option value="">Select...</option>{opts.map(o=><option key={o} value={o}>{o}</option>)}</select>
    {err&&<div style={{fontSize:10,color:"#B0413E",marginTop:2}}>{err}</div>}
  </div>)}
function ASecL({text}){return <div style={{fontSize:10,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:.8,marginBottom:8,marginTop:4,paddingBottom:4,borderBottom:"1px solid #1A1A1C"}}>{text}</div>}
const ag2={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px"};

function ApplyPage(){
  const {saveDeal,dealers,notify}=useContext(Ctx);
  const [step,setStep]=useState(0);
  const [f,sf]=useState(EMPTY_APP);
  const [submitted,setSubmitted]=useState(false);
  const [submitting,setSubmitting]=useState(false);
  const [errors,setErrors]=useState({});
  const [dealCode,setDealCode]=useState("");
  const topRef=useRef(null);
  const u=(k,v)=>{sf(p=>({...p,[k]:v}));setErrors(p=>({...p,[k]:undefined}))};

  const validateStep=()=>{
    const e={};
    if(step===0){if(!f.bizName.trim())e.bizName="Required";if(!f.bizEmail.trim())e.bizEmail="Required";if(!f.bizPhone.trim())e.bizPhone="Required";if(!f.bizAddress.trim())e.bizAddress="Required";if(!f.bizCity.trim())e.bizCity="Required";if(!f.bizState.trim())e.bizState="Required";if(!f.bizZip.trim())e.bizZip="Required";if(!f.legalStructure.trim())e.legalStructure="Required";if(!f.dateStarted.trim())e.dateStarted="Required"}
    if(step===1){if(!f.o1Name.trim())e.o1Name="Required";if(!f.o1Cell.trim())e.o1Cell="Required";if(!f.o1Ssn.trim())e.o1Ssn="Required";if(!f.o1Dob.trim())e.o1Dob="Required";if(!f.o1Address.trim())e.o1Address="Required"}
    if(step===3){if(!f.eqType)e.eqType="Required";if(!f.price.trim())e.price="Required"}
    setErrors(e);return Object.keys(e).length===0;
  };
  const next=()=>{if(validateStep()){setStep(s=>Math.min(s+1,4));topRef.current?.scrollIntoView({behavior:"smooth"})}};
  const back=()=>{setStep(s=>Math.max(s-1,0));topRef.current?.scrollIntoView({behavior:"smooth"})};

  const submit=async()=>{
    if(!f.agreeTerms){setErrors({agreeTerms:"You must agree to continue"});return}
    setSubmitting(true);
    await new Promise(r=>setTimeout(r,1500));
    const code=f.bizName.replace(/[^A-Z]/gi,"").slice(0,3).toUpperCase()+"-"+Math.floor(1000+Math.random()*9000);
    const dlr=dealers.find(d=>d.code===f.dealerCode);
    saveDeal({biz:f.bizName,contact:f.o1Name,email:f.bizEmail,phone:f.bizPhone,eqType:f.eqType,eqDetail:[f.eqYear,f.eqMake,f.eqModel].filter(Boolean).join(" ")||f.eqDesc,eqYear:f.eqYear,eqMake:f.eqMake,eqModel:f.eqModel,eqVin:f.eqVin,eqMileage:f.eqMileage,amount:parseFloat(f.price.replace(/[^0-9.]/g,""))||0,stage:"new_lead",source:dlr?"Dealer Referral":"Website Application",dealerId:dlr?.id||null,dealerName:dlr?.name||"",code,notes:`Applied online. Structure: ${f.legalStructure||"N/A"}. EIN: ${f.fedId||"N/A"}. Started: ${f.dateStarted||"N/A"}.`,
      appData:{bizName:f.bizName,dba:f.dba,bizType:f.bizType,bizAddress:f.bizAddress,bizCity:f.bizCity,bizState:f.bizState,bizZip:f.bizZip,bizPhone:f.bizPhone,bizEmail:f.bizEmail,fedId:f.fedId,legalStructure:f.legalStructure,employees:f.employees,dateStarted:f.dateStarted,
      o1Name:f.o1Name,o1Title:f.o1Title,o1Pct:f.o1Pct,o1Address:f.o1Address,o1City:f.o1City,o1State:f.o1State,o1Zip:f.o1Zip,o1Cell:f.o1Cell,o1Ssn:f.o1Ssn,o1Dob:f.o1Dob,
      o2Name:f.o2Name,o2Title:f.o2Title,o2Pct:f.o2Pct,o2Address:f.o2Address,o2City:f.o2City,o2State:f.o2State,o2Zip:f.o2Zip,o2Cell:f.o2Cell,o2Ssn:f.o2Ssn,o2Dob:f.o2Dob,hasOwner2:f.hasOwner2,
      bankName:f.bankName,bankAcct:f.bankAcct,bankPhone:f.bankPhone,bankContact:f.bankContact,trade1:f.trade1,trade1Ph:f.trade1Ph,trade2:f.trade2,trade2Ph:f.trade2Ph,
      vendorName:f.vendorName,vendorPhone:f.vendorPhone,salesPerson:f.salesPerson,
      eqDesc:f.eqDesc,newUsed:f.newUsed,price:f.price,termReq:f.termReq,dealerCode:f.dealerCode}
    });
    setDealCode(code);setSubmitted(true);setSubmitting(false);notify("Application submitted!");
  };

  if(submitted)return(
    <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,minHeight:"80vh"}}>
      <div style={{textAlign:"center",maxWidth:480,animation:"fadeIn .5s"}}>
        <div style={{width:64,height:64,borderRadius:"50%",background:"#4CAF5018",border:"2px solid #4CAF50",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"}}><I.Check/></div>
        <h2 style={{fontSize:24,fontWeight:800,color:"#fff",marginBottom:8}}>Application Submitted!</h2>
        <p style={{fontSize:14,color:"#888",lineHeight:1.6,marginBottom:24}}>Thank you, {f.bizName}. Your credit application has been received and is being reviewed.</p>
        <div style={{background:"#121214",border:"1px solid #1E1E20",borderRadius:10,padding:"18px 24px",marginBottom:24}}>
          <div style={{fontSize:10,color:"#555",textTransform:"uppercase",letterSpacing:1,fontWeight:600,marginBottom:6}}>Your Application Code</div>
          <div style={{fontSize:24,fontWeight:800,color:"#4F8EAE",letterSpacing:2,fontFamily:"'JetBrains Mono',monospace"}}>{dealCode}</div>
          <div style={{fontSize:11,color:"#555",marginTop:6}}>Save this code to check your status on the Customer Portal</div>
        </div>
        <div style={{background:"#121214",border:"1px solid #1E1E20",borderRadius:10,padding:"16px 20px",textAlign:"left"}}>
          <div style={{fontSize:11,fontWeight:700,color:"#ccc",marginBottom:8}}>What happens next?</div>
          {["Our team will review your application within 1 business day","Your application will be processed through our underwriting team","You'll receive a call or email with approval details"].map((t,i)=><div key={i} style={{display:"flex",gap:8,padding:"5px 0",fontSize:12,color:"#777"}}><span style={{color:"#4F8EAE",fontWeight:700,fontSize:11}}>{i+1}.</span>{t}</div>)}
        </div>
        <div style={S.amCard}><div style={S.amAv}><I.User/></div><div><div style={{fontSize:13,fontWeight:600,color:"#fff"}}>{AM.name}</div><div style={{fontSize:11,color:"#777"}}>{AM.title}</div><div style={{fontSize:12,color:"#4F8EAE",marginTop:2}}>{AM.phone} · {AM.email}</div></div></div>
      </div>
    </div>
  );

  return(<div style={{maxWidth:680,margin:"0 auto",padding:"24px 20px 60px"}} ref={topRef}>
    <div style={{textAlign:"center",marginBottom:28}}>
      <h1 style={{fontSize:24,fontWeight:800,color:"#fff",marginBottom:6}}>Credit Application</h1>
      <p style={{fontSize:13,color:"#666",maxWidth:440,margin:"0 auto",lineHeight:1.5}}>Complete the form below to apply for equipment financing. Your information is encrypted and secure.</p>
    </div>
    {/* Steps */}
    <div style={{display:"flex",gap:2,marginBottom:28}}>{APP_STEPS.map((s,i)=><div key={s} style={{flex:1,cursor:i<step?"pointer":"default"}} onClick={()=>i<step&&setStep(i)}>
      <div style={{height:3,borderRadius:2,transition:"all .4s",background:i<step?"#4F8EAE":i===step?"#4F8EAE":"#1A1A1C"}}/>
      <div style={{display:"flex",alignItems:"center",gap:4,marginTop:6,justifyContent:"center"}}><span style={{fontSize:10,opacity:i<=step?1:.3}}>{APP_ICONS[i]}</span><span style={{fontSize:9,fontWeight:600,color:i<=step?"#999":"#333",letterSpacing:.3,textTransform:"uppercase"}}>{s}</span></div>
    </div>)}</div>
    {/* Form Card */}
    <div style={{background:"#121214",border:"1px solid #1E1E20",borderRadius:12,overflow:"hidden"}}>
      <div style={{padding:"24px 22px"}}>
        {step===0&&<><div style={{marginBottom:16}}><h2 style={{fontSize:17,fontWeight:700,color:"#fff",marginBottom:4}}>Business Information</h2><p style={{fontSize:12,color:"#555"}}>Tell us about your company.</p></div>
        <div style={ag2}><AF l="Legal Business Name" v={f.bizName} ch={v=>u("bizName",v)} required err={errors.bizName} span={2}/><AF l="DBA (if different)" v={f.dba} ch={v=>u("dba",v)}/><AF l="Business Type / Industry" v={f.bizType} ch={v=>u("bizType",v)}/>
        <AF l="Street Address" v={f.bizAddress} ch={v=>u("bizAddress",v)} required err={errors.bizAddress} span={2}/><AF l="City" v={f.bizCity} ch={v=>u("bizCity",v)} required err={errors.bizCity}/>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><AF l="State" v={f.bizState} ch={v=>u("bizState",v)} required err={errors.bizState}/><AF l="ZIP" v={f.bizZip} ch={v=>u("bizZip",v)} required err={errors.bizZip}/></div>
        <AF l="Business Phone" v={f.bizPhone} ch={v=>u("bizPhone",v)} type="tel" required err={errors.bizPhone}/><AF l="Business Email" v={f.bizEmail} ch={v=>u("bizEmail",v)} type="email" required err={errors.bizEmail}/>
        <AF l="Federal Tax ID (EIN)" v={f.fedId} ch={v=>u("fedId",v)} ph="XX-XXXXXXX"/><ASel l="Legal Structure" v={f.legalStructure} ch={v=>u("legalStructure",v)} opts={LEGAL_STRUCTS} required err={errors.legalStructure}/>
        <AF l="# of Employees" v={f.employees} ch={v=>u("employees",v)} type="number"/><AF l="Date Business Started" v={f.dateStarted} ch={v=>u("dateStarted",v)} ph="MM/YYYY" required err={errors.dateStarted}/></div></>}

        {step===1&&<><div style={{marginBottom:16}}><h2 style={{fontSize:17,fontWeight:700,color:"#fff",marginBottom:4}}>Ownership Information</h2><p style={{fontSize:12,color:"#555"}}>Primary owner/guarantor details required for credit check.</p></div>
        <ASecL text="Owner / Guarantor 1"/>
        <div style={ag2}><AF l="Full Legal Name" v={f.o1Name} ch={v=>u("o1Name",v)} required err={errors.o1Name}/><AF l="Title" v={f.o1Title} ch={v=>u("o1Title",v)} ph="e.g. Owner, CEO"/>
        <AF l="% Ownership" v={f.o1Pct} ch={v=>u("o1Pct",v)} ph="100"/><AF l="Cell Phone" v={f.o1Cell} ch={v=>u("o1Cell",v)} type="tel" required err={errors.o1Cell}/>
        <AF l="Home Address" v={f.o1Address} ch={v=>u("o1Address",v)} required err={errors.o1Address} span={2}/><AF l="City" v={f.o1City} ch={v=>u("o1City",v)}/>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><AF l="State" v={f.o1State} ch={v=>u("o1State",v)}/><AF l="ZIP" v={f.o1Zip} ch={v=>u("o1Zip",v)}/></div>
        <AF l="Social Security #" v={f.o1Ssn} ch={v=>u("o1Ssn",v)} ph="XXX-XX-XXXX" required err={errors.o1Ssn} sensitive/><AF l="Date of Birth" v={f.o1Dob} ch={v=>u("o1Dob",v)} ph="MM/DD/YYYY" required err={errors.o1Dob}/></div>
        <div style={{marginTop:16}}><label style={{display:"flex",alignItems:"center",gap:8,cursor:"pointer",fontSize:12,color:"#888"}}><input type="checkbox" checked={f.hasOwner2} onChange={e=>u("hasOwner2",e.target.checked)} style={{width:16,height:16,accentColor:"#4F8EAE"}}/>Add a second owner / guarantor</label></div>
        {f.hasOwner2&&<><ASecL text="Owner / Guarantor 2"/>
        <div style={ag2}><AF l="Full Legal Name" v={f.o2Name} ch={v=>u("o2Name",v)}/><AF l="Title" v={f.o2Title} ch={v=>u("o2Title",v)}/>
        <AF l="% Ownership" v={f.o2Pct} ch={v=>u("o2Pct",v)}/><AF l="Cell Phone" v={f.o2Cell} ch={v=>u("o2Cell",v)} type="tel"/>
        <AF l="Home Address" v={f.o2Address} ch={v=>u("o2Address",v)} span={2}/><AF l="City" v={f.o2City} ch={v=>u("o2City",v)}/>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><AF l="State" v={f.o2State} ch={v=>u("o2State",v)}/><AF l="ZIP" v={f.o2Zip} ch={v=>u("o2Zip",v)}/></div>
        <AF l="Social Security #" v={f.o2Ssn} ch={v=>u("o2Ssn",v)} ph="XXX-XX-XXXX" sensitive/><AF l="Date of Birth" v={f.o2Dob} ch={v=>u("o2Dob",v)} ph="MM/DD/YYYY"/></div></>}</>}

        {step===2&&<><div style={{marginBottom:16}}><h2 style={{fontSize:17,fontWeight:700,color:"#fff",marginBottom:4}}>Bank & Trade References</h2><p style={{fontSize:12,color:"#555"}}>Your business banking and trade reference information.</p></div>
        <ASecL text="Business Bank"/><div style={ag2}><AF l="Bank Name" v={f.bankName} ch={v=>u("bankName",v)}/><AF l="Account Number" v={f.bankAcct} ch={v=>u("bankAcct",v)} sensitive/><AF l="Bank Phone" v={f.bankPhone} ch={v=>u("bankPhone",v)} type="tel"/><AF l="Contact Name" v={f.bankContact} ch={v=>u("bankContact",v)}/></div>
        <ASecL text="Trade References"/><div style={ag2}><AF l="Trade Reference #1" v={f.trade1} ch={v=>u("trade1",v)} ph="Company name"/><AF l="Phone" v={f.trade1Ph} ch={v=>u("trade1Ph",v)} type="tel"/><AF l="Trade Reference #2" v={f.trade2} ch={v=>u("trade2",v)} ph="Company name"/><AF l="Phone" v={f.trade2Ph} ch={v=>u("trade2Ph",v)} type="tel"/></div></>}

        {step===3&&<><div style={{marginBottom:16}}><h2 style={{fontSize:17,fontWeight:700,color:"#fff",marginBottom:4}}>Equipment Information</h2><p style={{fontSize:12,color:"#555"}}>Details about the equipment you're looking to finance.</p></div>
        <div style={ag2}><ASel l="Equipment Type" v={f.eqType} ch={v=>u("eqType",v)} opts={EQ_TYPES} required err={errors.eqType}/>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}><ASel l="New / Used" v={f.newUsed} ch={v=>u("newUsed",v)} opts={["New","Used"]}/><AF l="Year" v={f.eqYear} ch={v=>u("eqYear",v)} ph="2025"/></div>
        <AF l="Make" v={f.eqMake} ch={v=>u("eqMake",v)} ph="e.g. Kenworth, CAT"/><AF l="Model" v={f.eqModel} ch={v=>u("eqModel",v)} ph="e.g. T370, 320"/>
        <AF l="Equipment Description" v={f.eqDesc} ch={v=>u("eqDesc",v)} span={2} ph="Full description"/><AF l="VIN / Serial #" v={f.eqVin} ch={v=>u("eqVin",v.toUpperCase())} ph="If known" mono/><AF l="Mileage / Hours" v={f.eqMileage} ch={v=>u("eqMileage",v)}/>
        <AF l="Purchase Price" v={f.price} ch={v=>u("price",v)} required err={errors.price} ph="$0"/><AF l="Term Requested" v={f.termReq} ch={v=>u("termReq",v)} ph="e.g. 60 months"/></div>
        <ASecL text="Vendor / Dealer"/><div style={ag2}><AF l="Vendor / Dealer Name" v={f.vendorName} ch={v=>u("vendorName",v)}/><AF l="Vendor Phone" v={f.vendorPhone} ch={v=>u("vendorPhone",v)} type="tel"/><AF l="Sales Person" v={f.salesPerson} ch={v=>u("salesPerson",v)}/></div>
        <div style={{marginTop:12}}><AF l="Dealer Referral Code (optional)" v={f.dealerCode} ch={v=>u("dealerCode",v.toUpperCase())} ph="e.g. NTS2026" mono/></div></>}

        {step===4&&<><div style={{marginBottom:16}}><h2 style={{fontSize:17,fontWeight:700,color:"#fff",marginBottom:4}}>Review & Submit</h2><p style={{fontSize:12,color:"#555"}}>Please review your information before submitting.</p></div>
        {[{t:"Business",items:[["Legal Name",f.bizName],["DBA",f.dba],["Type",f.bizType],["Address",[f.bizAddress,f.bizCity,f.bizState,f.bizZip].filter(Boolean).join(", ")],["Phone",f.bizPhone],["Email",f.bizEmail],["EIN",f.fedId],["Structure",f.legalStructure]]},
          {t:"Owner 1",items:[["Name",f.o1Name],["Title",f.o1Title],["Ownership",f.o1Pct?f.o1Pct+"%":""],["Cell",f.o1Cell],["SSN",f.o1Ssn?"•••-••-"+f.o1Ssn.slice(-4):""],["DOB",f.o1Dob]]},
          ...(f.hasOwner2&&f.o2Name?[{t:"Owner 2",items:[["Name",f.o2Name],["Title",f.o2Title],["Ownership",f.o2Pct?f.o2Pct+"%":""],["Cell",f.o2Cell],["SSN",f.o2Ssn?"•••-••-"+f.o2Ssn.slice(-4):""],["DOB",f.o2Dob]]}]:[]),
          {t:"Equipment",items:[["Type",f.eqType],["Description",[f.eqYear,f.eqMake,f.eqModel].filter(Boolean).join(" ")||f.eqDesc],["Condition",f.newUsed],["Price",f.price],["Term",f.termReq],["VIN",f.eqVin],["Vendor",f.vendorName]]}
        ].map(sec=><div key={sec.t} style={{marginBottom:14,background:"#0A0A0A",border:"1px solid #1A1A1C",borderRadius:8,overflow:"hidden"}}>
          <div style={{padding:"8px 12px",borderBottom:"1px solid #1A1A1C",fontSize:10,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:.8}}>{sec.t}</div>
          <div style={{padding:"8px 12px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px 16px"}}>{sec.items.filter(([,v])=>v).map(([l,v])=><div key={l} style={{display:"flex",gap:6,fontSize:12,padding:"2px 0"}}><span style={{color:"#555",minWidth:80}}>{l}:</span><span style={{color:"#ccc",fontWeight:500}}>{v}</span></div>)}</div>
        </div>)}
        <div style={{marginTop:12,padding:14,background:"#0A0A0A",border:"1px solid #1A1A1C",borderRadius:8}}>
          <div style={{fontSize:10,color:"#555",lineHeight:1.5,marginBottom:12}}>By submitting this application, I certify that the information contained herein is true and accurate. I authorize Avanti Equipment Finance, LLC or its designee(s) to obtain information from any business or consumer reporting agencies or other sources that provide credit reports, account history, and employment information.</div>
          <label style={{display:"flex",alignItems:"flex-start",gap:8,cursor:"pointer"}}><input type="checkbox" checked={f.agreeTerms} onChange={e=>u("agreeTerms",e.target.checked)} style={{width:18,height:18,accentColor:"#4F8EAE",cursor:"pointer",marginTop:1,flexShrink:0}}/><span style={{fontSize:12,color:"#ccc",fontWeight:500}}>I agree to the terms above and authorize credit inquiries</span></label>
          {errors.agreeTerms&&<div style={{fontSize:11,color:"#B0413E",marginTop:4,marginLeft:26}}>{errors.agreeTerms}</div>}
        </div></>}
      </div>
      {/* Nav */}
      <div style={{padding:"14px 22px",borderTop:"1px solid #1A1A1C",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        {step>0?<button className="av-ghost" style={{...S.ghost,padding:"10px 20px",fontSize:13}} onClick={back}>← Back</button>:<div/>}
        {step<4?<button className="av-btn" style={{...S.prim,padding:"10px 28px",fontSize:13}} onClick={next}>Continue →</button>
        :<button className="av-btn" style={{...S.prim,padding:"12px 32px",fontSize:14,background:submitting?"#3A6F8F":"linear-gradient(135deg,#4F8EAE,#3A6F8F)"}} disabled={submitting} onClick={submit}>{submitting?"Submitting...":"Submit Application ✓"}</button>}
      </div>
    </div>
    <div style={{textAlign:"center",marginTop:16,fontSize:10,color:"#444",display:"flex",alignItems:"center",justifyContent:"center",gap:6}}>
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#444" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
      256-bit SSL Encrypted · Your information is never shared without your consent
    </div>
    {f.dealerCode&&<div style={{textAlign:"center",marginTop:10,fontSize:10,color:"#4F8EAE66"}}>Referred by dealer: {f.dealerCode}</div>}
  </div>);
}

// ════════════════════════════════════════════════════════════════
// LOGIN SCREEN
// ════════════════════════════════════════════════════════════════

function Login({type,onGo}) {
  const [code,setCode]=useState("");
  const [err,setErr]=useState("");
  const isDlr=type==="dealer";
  return(<div style={S.loginWrap}><div style={{...S.loginCard,...(!isDlr?{maxWidth:420}:{})}}>
    <div style={{color:"#4F8EAE"}}>{isDlr?<I.Bldg/>:<I.Eye/>}</div>
    <h2 style={S.loginTitle}>{isDlr?"Dealer Portal":"Check Your Application"}</h2>
    <p style={S.loginDesc}>{isDlr?"Enter your dealer access code to view referred deals and submit new applications.":"Enter the access code provided by your account manager to view your financing status in real time."}</p>
    <input style={{...S.inp,textAlign:"center",fontSize:isDlr?16:20,fontFamily:"'JetBrains Mono',monospace",letterSpacing:isDlr?2:3,padding:"12px 16px"}} placeholder={isDlr?"DEALER CODE":"ABC-1234"} value={code} onChange={e=>{setCode(e.target.value.toUpperCase());setErr("")}} onKeyDown={e=>{if(e.key==="Enter"){if(!onGo(code.trim()))setErr(isDlr?"Invalid dealer code":"No application found.")}}}/>
    {err&&<div style={S.loginErr}>{err}</div>}
    <button className="av-btn" style={{...S.prim,width:"100%",marginTop:10,padding:"12px 20px",fontSize:14,justifyContent:"center"}} onClick={()=>{if(!code.trim()){setErr("Enter your code");return}if(!onGo(code.trim()))setErr(isDlr?"Invalid code":"No application found.")}}>
      {isDlr?"Sign In":"View Status"}
    </button>
    <p style={{fontSize:11,color:"#444",marginTop:14}}>Contact {AM.name} at {AM.phone}</p>
  </div></div>);
}

// ════════════════════════════════════════════════════════════════
// FORM MODALS
// ════════════════════════════════════════════════════════════════

function DealForm({deal,onSave,onClose,isDlr}) {
  const {dealers,lenders,accounts} = useContext(Ctx);
  const [f,sf]=useState({id:deal?.id||null,accountId:deal?.accountId||null,biz:deal?.biz||"",contact:deal?.contact||"",email:deal?.email||"",phone:deal?.phone||"",eqType:deal?.eqType||"",eqDetail:deal?.eqDetail||"",eqYear:deal?.eqYear||"",eqMake:deal?.eqMake||"",eqModel:deal?.eqModel||"",eqVin:deal?.eqVin||"",eqMileage:deal?.eqMileage||"",amount:deal?.amount||"",stage:deal?.stage||"new_lead",source:deal?.source||"",dealerId:deal?.dealerId||null,dealerName:deal?.dealerName||"",notes:deal?.notes||"",code:deal?.code||"",lenderId:deal?.lenderId||null,terms:deal?.terms||null,history:deal?.history||[],createdAt:deal?.createdAt||null,updatedAt:deal?.updatedAt||null,docs:deal?.docs||[],stips:deal?.stips||[],fundingItems:deal?.fundingItems||[],accepted:deal?.accepted??null,taxChoice:deal?.taxChoice??null});
  const u=(k,v)=>sf(p=>({...p,[k]:v}));
  // Approval terms sub-form
  const [showTerms,setShowTerms]=useState(!!f.terms);
  const [ta,setTa]=useState(f.terms?.amt||"");
  const [tp,setTp]=useState(f.terms?.pmt||"");
  const [tm,setTm]=useState(f.terms?.months||"");
  const [tr,setTr]=useState(f.terms?.rate||"");

  return(<div style={S.overlay} onClick={onClose}><div style={S.modal} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid #1E1E20"}}><span style={{fontSize:15,fontWeight:700,color:"#fff"}}>{f.id?"Edit Deal":isDlr?"Submit New Deal":"New Deal"}</span><button style={S.closeBtn} onClick={onClose}><I.X/></button></div>
    <div style={{padding:"14px 18px",overflowY:"auto",maxHeight:"60vh"}}>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px"}}>
        <FF l="Business Name *" v={f.biz} ch={v=>u("biz",v)} ph="e.g. Smith Towing LLC"/>
        {!isDlr&&<div><label style={S.fLabel}>Link to Account</label><select style={S.fSel} value={f.accountId||""} onChange={e=>{const acc=accounts.find(a=>a.id===e.target.value);if(acc){u("accountId",acc.id);u("biz",acc.biz);u("contact",acc.contact);u("email",acc.email);u("phone",acc.phone)}else{u("accountId",null)}}}><option value="">New account (auto-create)</option>{accounts.map(a=><option key={a.id} value={a.id}>{a.biz}</option>)}</select></div>}
        <FF l="Contact Name" v={f.contact} ch={v=>u("contact",v)}/>
        <FF l="Email" v={f.email} ch={v=>u("email",v)} t="email"/>
        <FF l="Phone" v={f.phone} ch={v=>u("phone",v)}/>
        <div><label style={S.fLabel}>Equipment Type</label><select style={S.fSel} value={f.eqType} onChange={e=>u("eqType",e.target.value)}><option value="">Select...</option>{EQ_TYPES.map(t=><option key={t} value={t}>{t}</option>)}</select></div>
        <FF l="Amount" v={f.amount} ch={v=>u("amount",v)} t="number"/>
      </div>
      <div style={{marginTop:8,padding:12,background:"#0A0A0A",borderRadius:8,border:"1px solid #1E1E20"}}>
        <div style={{fontSize:10,fontWeight:700,color:"#555",textTransform:"uppercase",letterSpacing:.8,marginBottom:8}}>Equipment Details</div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px 12px"}}>
          <FF l="Year" v={f.eqYear} ch={v=>u("eqYear",v)} ph="2025"/>
          <FF l="Make" v={f.eqMake} ch={v=>u("eqMake",v)} ph="Kenworth"/>
          <FF l="Model" v={f.eqModel} ch={v=>u("eqModel",v)} ph="T370"/>
        </div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px",marginTop:8}}>
          <FF l="VIN" v={f.eqVin} ch={v=>u("eqVin",v.toUpperCase())} ph="1NKZL70X5RJ412885"/>
          <FF l="Mileage" v={f.eqMileage} ch={v=>u("eqMileage",v)} ph="0" t="number"/>
        </div>
        <div style={{marginTop:8}}><FF l="Additional Details" v={f.eqDetail} ch={v=>u("eqDetail",v)} ph="Any other equipment notes"/></div>
      </div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px",marginTop:8}}>
        {!isDlr&&<div><label style={S.fLabel}>Stage</label><select style={S.fSel} value={f.stage} onChange={e=>u("stage",e.target.value)}>{STAGES.map(s=><option key={s.id} value={s.id}>{s.label}</option>)}</select></div>}
        {!isDlr&&<div><label style={S.fLabel}>Source</label><select style={S.fSel} value={f.source} onChange={e=>u("source",e.target.value)}><option value="">Select...</option>{SOURCES.map(s=><option key={s} value={s}>{s}</option>)}</select></div>}
        {!isDlr&&<div><label style={S.fLabel}>Dealer</label><select style={S.fSel} value={f.dealerId||""} onChange={e=>{const dl=dealers.find(d=>d.id===e.target.value);u("dealerId",e.target.value||null);u("dealerName",dl?.name||"")}}><option value="">None</option>{dealers.map(d=><option key={d.id} value={d.id}>{d.name}</option>)}</select></div>}
        {!isDlr&&<div><label style={S.fLabel}>Lender</label><select style={S.fSel} value={f.lenderId||""} onChange={e=>u("lenderId",e.target.value||null)}><option value="">None</option>{lenders.map(l=><option key={l.id} value={l.id}>{l.name} ({l.code})</option>)}</select></div>}
      </div>
      {!isDlr&&<div style={{marginTop:10}}><label style={{...S.fLabel,cursor:"pointer",display:"flex",alignItems:"center",gap:6}}><input type="checkbox" checked={showTerms} onChange={e=>{setShowTerms(e.target.checked);if(!e.target.checked)u("terms",null)}}/> Add Approval Terms</label>
        {showTerms&&<TermsCalc ta={ta} setTa={setTa} tp={tp} setTp={setTp} tm={tm} setTm={setTm} tr={tr} setTr={setTr} terms={f.terms} dealerId={f.dealerId} dealers={dealers}/>}
      </div>}
      <div style={{marginTop:8}}><label style={S.fLabel}>Notes</label><textarea style={{...S.inp,resize:"vertical",minHeight:50}} value={f.notes} onChange={e=>u("notes",e.target.value)}/></div>
    </div>
    <div style={{display:"flex",gap:8,justifyContent:"flex-end",padding:"12px 18px",borderTop:"1px solid #1E1E20"}}>
      <button className="av-ghost" style={S.ghost} onClick={onClose}>Cancel</button>
      <button className="av-btn" style={S.prim} onClick={()=>{if(!f.biz.trim())return;const terms=showTerms?{amt:parseFloat(ta)||0,pmt:parseFloat(tp)||0,months:parseInt(tm)||0,rate:tr,buyRate:f.terms?.buyRate||null,points:f.terms?.points||null,feeAmt:f.terms?.feeAmt||null,dlrPts:f.terms?.dlrPts||0,dlrFee:f.terms?.dlrFee||0,financedAmt:f.terms?.financedAmt||null}:f.terms;onSave({...f,amount:parseFloat(f.amount)||0,terms})}}>{f.id?"Save":"Create"}</button>
    </div>
  </div></div>);
}

function DlrForm({dlr,onSave,onClose}) {
  const [f,sf]=useState({id:dlr?.id||null,name:dlr?.name||"",contact:dlr?.contact||"",email:dlr?.email||"",phone:dlr?.phone||"",region:dlr?.region||"",specs:dlr?.specs||[],code:dlr?.code||"",active:dlr?.active??true,referralPts:dlr?.referralPts??"",salesRep:dlr?.salesRep||"",salesRepPhone:dlr?.salesRepPhone||"",salesRepEmail:dlr?.salesRepEmail||""});
  const u=(k,v)=>sf(p=>({...p,[k]:v}));
  const togSpec=s=>sf(p=>({...p,specs:p.specs.includes(s)?p.specs.filter(x=>x!==s):[...p.specs,s]}));
  return(<div style={S.overlay} onClick={onClose}><div style={S.modal} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid #1E1E20"}}><span style={{fontSize:15,fontWeight:700,color:"#fff"}}>{f.id?"Edit Dealer":"Add Dealer"}</span><button style={S.closeBtn} onClick={onClose}><I.X/></button></div>
    <div style={{padding:"14px 18px",overflowY:"auto",maxHeight:"60vh"}}>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px"}}><FF l="Company Name *" v={f.name} ch={v=>u("name",v)}/><FF l="Main Contact" v={f.contact} ch={v=>u("contact",v)}/><FF l="Email" v={f.email} ch={v=>u("email",v)}/><FF l="Phone" v={f.phone} ch={v=>u("phone",v)}/><FF l="Region" v={f.region} ch={v=>u("region",v)}/><FF l="Access Code" v={f.code} ch={v=>u("code",v)}/></div>
      <div style={{marginTop:10,padding:10,background:"#0A0A0A",borderRadius:6,border:"1px solid #1E1E20"}}>
        <div style={{fontSize:9,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Sales Rep Contact</div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px"}}>
          <FF l="Sales Rep Name" v={f.salesRep} ch={v=>u("salesRep",v)} ph="e.g. Tommy Gallagher"/>
          <FF l="Sales Rep Phone" v={f.salesRepPhone} ch={v=>u("salesRepPhone",v)} ph="(555) 123-4567"/>
          <div style={{gridColumn:"1/-1"}}><FF l="Sales Rep Email" v={f.salesRepEmail} ch={v=>u("salesRepEmail",v)} ph="rep@dealer.com"/></div>
        </div>
      </div>
      <div style={{marginTop:8,padding:10,background:"#0A0A0A",borderRadius:6,border:"1px solid #1E1E20"}}>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px",alignItems:"end"}}>
          <FF l="Referral Points (preset)" v={f.referralPts} ch={v=>u("referralPts",v)} t="number" ph="e.g. 3"/>
          <div style={{fontSize:10,color:"#555",paddingBottom:8}}>Auto-applied when this dealer's deals enter the calculator. Set to 0 or blank for no referral.</div>
        </div>
      </div>
      <div style={{marginTop:8}}><label style={S.fLabel}>Specialties</label><div style={{display:"flex",gap:4,flexWrap:"wrap"}}>{EQ_TYPES.map(t=><button key={t} onClick={()=>togSpec(t)} style={{padding:"3px 8px",fontSize:10,borderRadius:12,border:`1px solid ${f.specs.includes(t)?"#6BA3BF":"#1E1E20"}`,background:f.specs.includes(t)?"#6BA3BF18":"transparent",color:f.specs.includes(t)?"#6BA3BF":"#666",cursor:"pointer",fontFamily:"inherit"}}>{t}</button>)}</div></div>
    </div>
    <div style={{display:"flex",gap:8,justifyContent:"flex-end",padding:"12px 18px",borderTop:"1px solid #1E1E20"}}><button className="av-ghost" style={S.ghost} onClick={onClose}>Cancel</button><button className="av-btn" style={S.prim} onClick={()=>{if(!f.name.trim())return;onSave({...f,referralPts:parseFloat(f.referralPts)||0})}}>{f.id?"Save":"Add"}</button></div>
  </div></div>);
}

function LndrForm({lndr,onSave,onClose}) {
  const [f,sf]=useState({id:lndr?.id||null,name:lndr?.name||"",code:lndr?.code||"",taxRule:lndr?.taxRule||"include",lienholder:lndr?.lienholder||"",address:lndr?.address||""});
  const u=(k,v)=>sf(p=>({...p,[k]:v}));
  return(<div style={S.overlay} onClick={onClose}><div style={S.modal} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid #1E1E20"}}><span style={{fontSize:15,fontWeight:700,color:"#fff"}}>{f.id?"Edit Lender":"Add Lender"}</span><button style={S.closeBtn} onClick={onClose}><I.X/></button></div>
    <div style={{padding:"14px 18px"}}>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px"}}><FF l="Lender Name *" v={f.name} ch={v=>u("name",v)}/><FF l="Code" v={f.code} ch={v=>u("code",v.toUpperCase())}/>
        <div><label style={S.fLabel}>Sales Tax Rule</label><select style={S.fSel} value={f.taxRule} onChange={e=>u("taxRule",e.target.value)}><option value="include">Always Included</option><option value="exclude">Always Excluded</option><option value="customer_choice">Customer Choice</option></select></div>
      </div>
      <div style={{marginTop:8}}><FF l="Lienholder Name" v={f.lienholder} ch={v=>u("lienholder",v)}/></div>
      <div style={{marginTop:8}}><FF l="Lienholder Address" v={f.address} ch={v=>u("address",v)}/></div>
    </div>
    <div style={{display:"flex",gap:8,justifyContent:"flex-end",padding:"12px 18px",borderTop:"1px solid #1E1E20"}}><button className="av-ghost" style={S.ghost} onClick={onClose}>Cancel</button><button className="av-btn" style={S.prim} onClick={()=>{if(!f.name.trim())return;onSave(f)}}>{f.id?"Save":"Add"}</button></div>
  </div></div>);
}

// ════════════════════════════════════════════════════════════════
// ── TERMS CALCULATOR (Admin Only) ─────────────────────────

function TermsCalc({ta,setTa,tp,setTp,tm,setTm,tr,setTr,terms,dealerId,dealers}) {
  const [buyRate,setBuyRate]=useState(terms?.buyRate||"");
  const [points,setPoints]=useState(terms?.points||"");
  const [dlrPtsOn,setDlrPtsOn]=useState(terms?.dlrPts!=null&&terms.dlrPts>0);
  const dealer=dealers?.find(d=>d.id===dealerId);
  const presetDlrPts=dealer?.referralPts||0;
  const [dlrPts,setDlrPts]=useState(terms?.dlrPts!=null?terms.dlrPts:(presetDlrPts||""));

  // Auto-populate dealer pts when dealer changes
  useEffect(()=>{
    if(dealer&&presetDlrPts>0){
      setDlrPts(presetDlrPts);
      setDlrPtsOn(true);
    } else if(!dealer){
      setDlrPts("");
      setDlrPtsOn(false);
    }
  },[dealerId]);

  const amt=parseFloat(ta)||0;
  const months=parseInt(tm)||0;
  const br=parseFloat(buyRate)||0;
  const pts=parseFloat(points)||0;
  const dp=dlrPtsOn?parseFloat(dlrPts)||0:0;
  const myFee=amt*(pts/100);
  const dlrFee=amt*(dp/100);
  const totalPtsAmt=myFee+dlrFee;
  const financedAmt=amt+totalPtsAmt;

  const calcPmt=(principal,annualRate,termMo)=>{
    if(!principal||!termMo)return 0;
    if(!annualRate)return principal/termMo;
    const r=annualRate/100/12;
    return principal*(r*Math.pow(1+r,termMo))/(Math.pow(1+r,termMo)-1);
  };

  const custPmt=calcPmt(financedAmt,br,months);
  const basePmt=calcPmt(amt,br,months);

  useEffect(()=>{
    if(amt&&months&&br){
      setTp(custPmt.toFixed(2));
      setTr(br.toFixed(2)+"%");
      if(terms){
        terms.buyRate=br;
        terms.points=pts;
        terms.feeAmt=myFee;
        terms.dlrPts=dlrPtsOn?dp:0;
        terms.dlrFee=dlrFee;
        terms.financedAmt=financedAmt;
      }
    }
  },[buyRate,points,ta,tm,dlrPts,dlrPtsOn]);

  const tgStyle=(on)=>({position:"relative",width:36,height:20,borderRadius:10,background:on?"#4F8EAE":"#1E1E20",cursor:"pointer",border:"none",transition:"background .2s",flexShrink:0});
  const knobStyle=(on)=>({position:"absolute",top:2,left:on?18:2,width:16,height:16,borderRadius:8,background:on?"#fff":"#555",transition:"left .2s"});

  return(
    <div style={{marginTop:8,padding:12,background:"#0A0A0A",borderRadius:8,border:"1px solid #1E1E20"}}>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px"}}>
        <FF l="Approved Amount" v={ta} ch={v=>setTa(v)} t="number"/>
        <FF l="Term (months)" v={tm} ch={v=>setTm(v)} t="number"/>
        <FF l="Buy Rate %" v={buyRate} ch={v=>setBuyRate(v)} t="number" ph="e.g. 5.2"/>
      </div>

      {/* ── Dealer Referral Points ── */}
      <div style={{marginTop:10,padding:"10px 12px",background:"#121214",borderRadius:6,border:`1px solid ${dlrPtsOn?"#4F8EAE22":"#1E1E20"}`}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:dlrPtsOn?8:0}}>
          <div style={{display:"flex",alignItems:"center",gap:8}}>
            <div style={{fontSize:9,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:1}}>Dealer Referral Points</div>
            {dealer&&presetDlrPts>0&&<span style={{fontSize:9,color:"#555",fontStyle:"italic"}}>Preset: {presetDlrPts}pts for {dealer.name}</span>}
          </div>
          <button onClick={()=>setDlrPtsOn(!dlrPtsOn)} style={tgStyle(dlrPtsOn)}><div style={knobStyle(dlrPtsOn)}/></button>
        </div>
        {dlrPtsOn&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 10px"}}>
          <div>
            <div style={{fontSize:10,fontWeight:600,color:"#666",marginBottom:3,textTransform:"uppercase",letterSpacing:.5}}>Dealer Points</div>
            <input type="number" value={dlrPts} onChange={e=>setDlrPts(e.target.value)} placeholder="e.g. 3" style={{width:"100%",padding:"7px 10px",fontSize:13,color:"#e0e0e8",background:"#0A0A0A",border:"1px solid #1E1E20",borderRadius:5,fontFamily:"inherit"}}/>
          </div>
          <div>
            <div style={{fontSize:10,fontWeight:600,color:"#666",marginBottom:3,textTransform:"uppercase",letterSpacing:.5}}>Dealer Fee</div>
            <div style={{padding:"7px 10px",background:"#0A0A0A",border:"1px solid #1E1E20",borderRadius:5,fontSize:14,fontWeight:700,color:dlrFee?"#4F8EAE":"#333"}}>{dlrFee?"$"+dlrFee.toLocaleString(undefined,{maximumFractionDigits:0}):"—"}</div>
          </div>
        </div>}
      </div>

      {/* ── Your Points ── */}
      <div style={{marginTop:8,padding:"10px 12px",background:"#121214",borderRadius:6,border:"1px solid #1E1E20"}}>
        <div style={{fontSize:9,fontWeight:700,color:"#E89300",textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Your Points — Admin Only</div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 10px"}}>
          <div>
            <div style={{fontSize:10,fontWeight:600,color:"#666",marginBottom:3,textTransform:"uppercase",letterSpacing:.5}}>Your Points</div>
            <input type="number" value={points} onChange={e=>setPoints(e.target.value)} placeholder="e.g. 10" style={{width:"100%",padding:"7px 10px",fontSize:13,color:"#e0e0e8",background:"#0A0A0A",border:"1px solid #1E1E20",borderRadius:5,fontFamily:"inherit"}}/>
          </div>
          <div>
            <div style={{fontSize:10,fontWeight:600,color:"#666",marginBottom:3,textTransform:"uppercase",letterSpacing:.5}}>Your Fee</div>
            <div style={{padding:"7px 10px",background:"#0A0A0A",border:"1px solid #1E1E20",borderRadius:5,fontSize:14,fontWeight:700,color:myFee?"#4CAF50":"#333"}}>{myFee?"$"+myFee.toLocaleString(undefined,{maximumFractionDigits:0}):"—"}</div>
          </div>
        </div>

        {amt>0&&months>0&&br>0&&(pts>0||dp>0)&&<>
          <div style={{marginTop:10,display:"grid",gridTemplateColumns:dp>0?"1fr 1fr 1fr 1fr":"1fr 1fr 1fr",gap:8}}>
            <div style={{padding:"8px 10px",background:"#0A0A0A",borderRadius:6,border:"1px solid #1E1E20"}}>
              <div style={{fontSize:8,fontWeight:600,color:"#555",textTransform:"uppercase",letterSpacing:.8}}>Actual Financed</div>
              <div style={{fontSize:14,fontWeight:700,color:"#E89300",marginTop:2}}>${financedAmt.toLocaleString(undefined,{maximumFractionDigits:0})}</div>
            </div>
            <div style={{padding:"8px 10px",background:"#0A0A0A",borderRadius:6,border:"1px solid #1E1E20"}}>
              <div style={{fontSize:8,fontWeight:600,color:"#555",textTransform:"uppercase",letterSpacing:.8}}>Customer Payment</div>
              <div style={{fontSize:14,fontWeight:700,color:"#4F8EAE",marginTop:2}}>${custPmt.toFixed(2)}</div>
            </div>
            {dp>0&&<div style={{padding:"8px 10px",background:"#4F8EAE08",borderRadius:6,border:"1px solid #4F8EAE22"}}>
              <div style={{fontSize:8,fontWeight:600,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:.8}}>Dealer Fee</div>
              <div style={{fontSize:14,fontWeight:700,color:"#4F8EAE",marginTop:2}}>${dlrFee.toLocaleString(undefined,{maximumFractionDigits:0})}</div>
            </div>}
            <div style={{padding:"8px 10px",background:"#4CAF5008",borderRadius:6,border:"1px solid #4CAF5022"}}>
              <div style={{fontSize:8,fontWeight:600,color:"#4CAF50",textTransform:"uppercase",letterSpacing:.8}}>Your Fee</div>
              <div style={{fontSize:14,fontWeight:700,color:"#4CAF50",marginTop:2}}>${myFee.toLocaleString(undefined,{maximumFractionDigits:0})}</div>
            </div>
          </div>
          <div style={{marginTop:6,fontSize:10,color:"#444"}}>
            Customer sees: ${amt.toLocaleString()} approved at ${custPmt.toFixed(2)}/mo{dp>0&&` · Total points: ${pts+dp} (${pts} yours + ${dp} dealer)`} · Base pmt: ${basePmt.toFixed(2)}/mo
          </div>
        </>}
      </div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px 12px",marginTop:8}}>
        <FF l="Customer Payment (auto)" v={tp} ch={v=>setTp(v)} t="number"/>
        <FF l="Rate Shown (auto)" v={tr} ch={v=>setTr(v)} ph="auto-calculated"/>
      </div>
    </div>
  );
}

// ── GENERATE CREDIT APP ──────────────────────────────────

function GenerateCreditApp({deal}) {
  const [showForm, setShowForm] = useState(false);
  const [template, setTemplate] = useState("avanti");
  const [appData, setAppData] = useState(null);

  // Pre-fill from deal data — use appData if customer applied online
  const a = deal.appData||{};
  const prefill = {
    bizName: a.bizName||deal.biz||"", dba: a.dba||"", bizType: a.bizType||deal.eqType||"",
    bizAddress: a.bizAddress||"", bizCityStateZip: a.bizCity?[a.bizCity,a.bizState,a.bizZip].filter(Boolean).join(", "):"",
    bizPhone: a.bizPhone||deal.phone||"", bizFax: "", bizEmail: a.bizEmail||deal.email||"",
    fedId: a.fedId||"", legalStructure: a.legalStructure||"", employees: a.employees||"",
    dateStarted: a.dateStarted||"", dateOwner: "",
    o1Name: a.o1Name||deal.contact||"", o1Pct: a.o1Pct?(a.o1Pct+"%"):"100%", o1Title: a.o1Title||"",
    o1Address: a.o1Address||"", o1CityStateZip: a.o1City?[a.o1City,a.o1State,a.o1Zip].filter(Boolean).join(", "):"",
    o1HomePhone: "", o1Cell: a.o1Cell||deal.phone||"", o1Ssn: a.o1Ssn||"", o1Dob: a.o1Dob||"",
    o2Name: a.o2Name||"", o2Pct: a.o2Pct?(a.o2Pct+"%"):"", o2Title: a.o2Title||"",
    o2Address: a.o2Address||"", o2CityStateZip: a.o2City?[a.o2City,a.o2State,a.o2Zip].filter(Boolean).join(", "):"",
    o2HomePhone: "", o2Cell: a.o2Cell||"", o2Ssn: a.o2Ssn||"", o2Dob: a.o2Dob||"",
    bankName: a.bankName||"", bankAcct: a.bankAcct||"", bankPhone: a.bankPhone||"", bankContact: a.bankContact||"",
    trade1: a.trade1||"", trade1Ph: a.trade1Ph||"", trade2: a.trade2||"", trade2Ph: a.trade2Ph||"",
    vendorName: a.vendorName||deal.dealerName||"", vendorPhone: a.vendorPhone||"", salesPerson: a.salesPerson||"",
    eqDesc: [deal.eqYear,deal.eqMake,deal.eqModel].filter(Boolean).join(" ")||deal.eqDetail||a.eqDesc||"",
    newUsed: a.newUsed||(deal.eqMileage==="0"||!deal.eqMileage?"New":"Used"),
    price: deal.amount?`$${Number(deal.amount).toLocaleString()}`:(a.price||""),
    termReq: deal.terms?.months?`${deal.terms.months} months`:(a.termReq||""),
  };

  return(
    <Sec t={<span style={{display:"flex",alignItems:"center",gap:6}}>Credit Application <span style={{fontSize:9,padding:"1px 6px",borderRadius:8,background:"#4F8EAE18",color:"#4F8EAE",border:"1px solid #4F8EAE33",fontWeight:600}}>PDF</span></span>}>
      <div style={{display:"flex",gap:6,alignItems:"center"}}>
        <select style={{...S.fSel,flex:1,fontSize:11}} value={template} onChange={e=>setTemplate(e.target.value)}>
          <option value="avanti">Avanti Credit Application</option>
          <option value="fincap">FinCap Business Application</option>
        </select>
        <button className="av-btn" style={{...S.prim,padding:"7px 14px",fontSize:11,whiteSpace:"nowrap"}} onClick={()=>setShowForm(true)}>
          <I.Doc/> Generate PDF
        </button>
      </div>
      {appData&&<div style={{marginTop:6,padding:"6px 10px",background:"#4CAF5008",border:"1px solid #4CAF5018",borderRadius:5,fontSize:11,color:"#4CAF50",display:"flex",alignItems:"center",gap:6}}>
        <I.CheckCirc/> Application generated · {template==="avanti"?"Avanti":"FinCap"} template
      </div>}
      {showForm&&<CreditAppForm prefill={prefill} template={template} onClose={()=>setShowForm(false)} onGenerate={(data)=>{setAppData(data);setShowForm(false)}}/>}
    </Sec>
  );
}

function CreditAppForm({prefill,template,onClose,onGenerate}) {
  const [f,sf]=useState(prefill);
  const u=(k,v)=>sf(p=>({...p,[k]:v}));

  const generate = () => {
    // In the prototype, we show the filled data. In production, this hits /api/generate-pdf
    onGenerate(f);
    alert(`Credit application generated with ${template==="avanti"?"Avanti":"FinCap"} template!\n\nIn the deployed version, this downloads the filled PDF.\n\nBusiness: ${f.bizName}\nContact: ${f.o1Name}\nEquipment: ${f.eqDesc}\nAmount: ${f.price}`);
  };

  const secStyle = {marginTop:12,padding:"10px 12px",background:"#0A0A0A",border:"1px solid #1A1A1C",borderRadius:7};
  const secTitle = {fontSize:10,fontWeight:700,color:"#4F8EAE",textTransform:"uppercase",letterSpacing:.8,marginBottom:8};
  const grid2 = {display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px 10px"};
  const grid3 = {display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"6px 10px"};

  return(
    <div style={S.overlay} onClick={onClose}><div style={{...S.modal,maxWidth:620}} onClick={e=>e.stopPropagation()}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid #1E1E20"}}>
        <span style={{fontSize:15,fontWeight:700,color:"#fff"}}>Credit Application — {template==="avanti"?"Avanti":"FinCap"}</span>
        <button style={S.closeBtn} onClick={onClose}><I.X/></button>
      </div>
      <div style={{padding:"14px 18px",overflowY:"auto",maxHeight:"65vh"}}>

        <div style={secStyle}><div style={secTitle}>Business Information</div>
          <div style={grid2}>
            <FF l="Legal Business Name *" v={f.bizName} ch={v=>u("bizName",v)}/>
            <FF l="DBA" v={f.dba} ch={v=>u("dba",v)}/>
            <FF l="Business Type" v={f.bizType} ch={v=>u("bizType",v)}/>
            <FF l="Federal Tax ID (EIN)" v={f.fedId} ch={v=>u("fedId",v)} ph="XX-XXXXXXX"/>
          </div>
          <div style={{...grid2,marginTop:6}}>
            <FF l="Physical Address" v={f.bizAddress} ch={v=>u("bizAddress",v)}/>
            <FF l="City, State, ZIP" v={f.bizCityStateZip} ch={v=>u("bizCityStateZip",v)}/>
            <FF l="Phone" v={f.bizPhone} ch={v=>u("bizPhone",v)}/>
            <FF l="Email" v={f.bizEmail} ch={v=>u("bizEmail",v)}/>
          </div>
          <div style={{...grid3,marginTop:6}}>
            <FF l="Legal Structure" v={f.legalStructure} ch={v=>u("legalStructure",v)} ph="LLC, Corp, etc."/>
            <FF l="# Employees" v={f.employees} ch={v=>u("employees",v)}/>
            <FF l="Date Started" v={f.dateStarted} ch={v=>u("dateStarted",v)} ph="MM/YYYY"/>
          </div>
        </div>

        <div style={secStyle}><div style={secTitle}>Owner / Guarantor 1</div>
          <div style={grid2}>
            <FF l="Full Name *" v={f.o1Name} ch={v=>u("o1Name",v)}/>
            <FF l="% Ownership" v={f.o1Pct} ch={v=>u("o1Pct",v)}/>
            <FF l="Home Address" v={f.o1Address} ch={v=>u("o1Address",v)}/>
            <FF l="City, State, ZIP" v={f.o1CityStateZip} ch={v=>u("o1CityStateZip",v)}/>
            <FF l="Cell Phone" v={f.o1Cell} ch={v=>u("o1Cell",v)}/>
            <FF l="Home Phone" v={f.o1HomePhone} ch={v=>u("o1HomePhone",v)}/>
            <FF l="Social Security #" v={f.o1Ssn} ch={v=>u("o1Ssn",v)} ph="XXX-XX-XXXX"/>
            <FF l="Date of Birth" v={f.o1Dob} ch={v=>u("o1Dob",v)} ph="MM/DD/YYYY"/>
          </div>
        </div>

        <div style={secStyle}><div style={secTitle}>Owner / Guarantor 2 <span style={{fontWeight:400,color:"#555"}}>(if applicable)</span></div>
          <div style={grid2}>
            <FF l="Full Name" v={f.o2Name} ch={v=>u("o2Name",v)}/>
            <FF l="% Ownership" v={f.o2Pct} ch={v=>u("o2Pct",v)}/>
            <FF l="Home Address" v={f.o2Address} ch={v=>u("o2Address",v)}/>
            <FF l="City, State, ZIP" v={f.o2CityStateZip} ch={v=>u("o2CityStateZip",v)}/>
            <FF l="Cell Phone" v={f.o2Cell} ch={v=>u("o2Cell",v)}/>
            <FF l="Home Phone" v={f.o2HomePhone} ch={v=>u("o2HomePhone",v)}/>
            <FF l="Social Security #" v={f.o2Ssn} ch={v=>u("o2Ssn",v)}/>
            <FF l="Date of Birth" v={f.o2Dob} ch={v=>u("o2Dob",v)}/>
          </div>
        </div>

        <div style={secStyle}><div style={secTitle}>Bank & Trade References</div>
          <div style={grid2}>
            <FF l="Business Bank Name" v={f.bankName} ch={v=>u("bankName",v)}/>
            <FF l="Account #" v={f.bankAcct} ch={v=>u("bankAcct",v)}/>
            <FF l="Bank Phone" v={f.bankPhone} ch={v=>u("bankPhone",v)}/>
            <FF l="Bank Contact" v={f.bankContact} ch={v=>u("bankContact",v)}/>
          </div>
          <div style={{...grid2,marginTop:6}}>
            <FF l="Trade Reference #1" v={f.trade1} ch={v=>u("trade1",v)}/>
            <FF l="Phone" v={f.trade1Ph} ch={v=>u("trade1Ph",v)}/>
            <FF l="Trade Reference #2" v={f.trade2} ch={v=>u("trade2",v)}/>
            <FF l="Phone" v={f.trade2Ph} ch={v=>u("trade2Ph",v)}/>
          </div>
        </div>

        <div style={secStyle}><div style={secTitle}>Equipment / Vendor</div>
          <div style={grid2}>
            <FF l="Vendor/Dealer Name" v={f.vendorName} ch={v=>u("vendorName",v)}/>
            <FF l="Vendor Phone" v={f.vendorPhone} ch={v=>u("vendorPhone",v)}/>
            <FF l="Sales Person" v={f.salesPerson} ch={v=>u("salesPerson",v)}/>
            <FF l="Equipment Description" v={f.eqDesc} ch={v=>u("eqDesc",v)}/>
            <FF l="New or Used" v={f.newUsed} ch={v=>u("newUsed",v)}/>
            <FF l="Price" v={f.price} ch={v=>u("price",v)}/>
            <FF l="Term Requested" v={f.termReq} ch={v=>u("termReq",v)} ph="e.g. 60 months"/>
          </div>
        </div>

      </div>
      <div style={{display:"flex",gap:8,justifyContent:"flex-end",padding:"12px 18px",borderTop:"1px solid #1E1E20"}}>
        <button className="av-ghost" style={S.ghost} onClick={onClose}>Cancel</button>
        <button className="av-btn" style={{...S.prim,padding:"10px 20px"}} onClick={generate}><I.Doc/> Generate {template==="avanti"?"Avanti":"FinCap"} PDF</button>
      </div>
    </div></div>
  );
}

// SHARED COMPONENTS
// ════════════════════════════════════════════════════════════════

function Sec({t,children}){return(<div style={{marginBottom:14}}><div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1.3,color:"#555",marginBottom:7}}>{t}</div><div style={{display:"flex",flexDirection:"column",gap:4}}>{children}</div></div>)}

function ItemsNeededSection({deal,role="admin"}) {
  const {addStip,removeStip,toggleStip,resolveStip} = useContext(Ctx);
  const [newItem,setNewItem]=useState("");
  const [showPresets,setShowPresets]=useState(false);
  const stips = (deal.stips||[]).filter(s=> role==="admin" || s.visibility==="all" || s.visibility===role);
  const pending = stips.filter(s=>!s.done).length;
  const done = stips.filter(s=>s.done).length;
  const isAdmin = role==="admin";

  const handleAdd = (text) => {
    if(!text.trim()) return;
    addStip(deal.id,text.trim(),"all");
    setNewItem("");
    setShowPresets(false);
  };

  const handleUpload = (stipId, stipText) => {
    const fileName = `${deal.biz?.replace(/\s/g,"_")}_${stipText.replace(/[\s()]/g,"_")}.pdf`;
    resolveStip(deal.id, stipId, fileName, role);
  };

  return(
    <Sec t={<span style={{display:"flex",alignItems:"center",gap:6}}>Items Needed {pending>0&&<span style={{fontSize:9,padding:"1px 6px",borderRadius:8,background:"#E8930018",color:"#E89300",border:"1px solid #E8930033",fontWeight:700}}>{pending} pending</span>}{done>0&&<span style={{fontSize:9,padding:"1px 6px",borderRadius:8,background:"#4CAF5012",color:"#4CAF50",fontWeight:600}}>{done} resolved</span>}</span>}>
      {stips.length===0&&<div style={{fontSize:11,color:"#444",padding:"8px 0"}}>{isAdmin?"No items requested. Add lender stipulations below.":"No items currently needed."}</div>}
      {stips.map(s=>(
        <div key={s.id} style={{display:"flex",alignItems:"flex-start",gap:8,padding:"7px 9px",background:s.done?"#4CAF5006":"#E8930008",border:`1px solid ${s.done?"#4CAF5018":"#E8930018"}`,borderRadius:5,transition:"all .15s"}}>
          {isAdmin&&<button onClick={()=>toggleStip(deal.id,s.id)} style={{width:18,height:18,borderRadius:4,border:`1.5px solid ${s.done?"#4CAF50":"#E89300"}`,background:s.done?"#4CAF5022":"transparent",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",flexShrink:0,padding:0,marginTop:1}}>
            {s.done&&<I.Check/>}
          </button>}
          {!isAdmin&&<div style={{width:18,height:18,borderRadius:4,border:`1.5px solid ${s.done?"#4CAF50":"#E89300"}`,background:s.done?"#4CAF5022":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:1}}>
            {s.done&&<span style={{color:"#4CAF50"}}><I.Check/></span>}
          </div>}
          <div style={{flex:1,minWidth:0}}>
            <span style={{fontSize:12,color:s.done?"#666":"#ddd",textDecoration:s.done?"line-through":"none"}}>{s.text}</span>
            {s.file&&<div style={{fontSize:10,color:"#4CAF50",marginTop:2,display:"flex",alignItems:"center",gap:4}}><I.Doc/> {s.file} <span style={{color:"#555"}}>· by {s.resolvedBy||"—"}</span></div>}
          </div>
          <div style={{display:"flex",gap:3,flexShrink:0}}>
            {!s.done&&<button className="av-ghost" style={{...S.ghost,padding:"3px 7px",fontSize:9,gap:3}} onClick={()=>handleUpload(s.id,s.text)}><I.Upload/> Attach</button>}
            {isAdmin&&<button style={S.tinyBtn} onClick={()=>removeStip(deal.id,s.id)}><I.X/></button>}
          </div>
        </div>
      ))}
      {isAdmin&&<div style={{marginTop:6}}>
        <div style={{display:"flex",gap:6}}>
          <input style={{...S.inp,flex:1,fontSize:12}} placeholder="Add item needed..." value={newItem} onChange={e=>setNewItem(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")handleAdd(newItem)}}/>
          <button className="av-btn" style={{...S.prim,padding:"6px 10px",fontSize:11}} onClick={()=>handleAdd(newItem)}><I.Plus/></button>
          <button className="av-ghost" style={{...S.ghost,padding:"6px 8px",fontSize:10}} onClick={()=>setShowPresets(!showPresets)} title="Common items"><I.Clip/></button>
        </div>
        {showPresets&&<div style={{marginTop:6,padding:8,background:"#0A0A0A",border:"1px solid #1A1A1C",borderRadius:6,maxHeight:180,overflowY:"auto"}}>
          <div style={{fontSize:9,fontWeight:600,color:"#555",textTransform:"uppercase",letterSpacing:.8,marginBottom:6}}>Common Stipulations</div>
          <div style={{display:"flex",flexDirection:"column",gap:2}}>
            {COMMON_STIPS.filter(cs=>!stips.find(s=>s.text===cs)).map(cs=>(
              <button key={cs} onClick={()=>handleAdd(cs)} style={{textAlign:"left",padding:"5px 8px",fontSize:11,color:"#aaa",background:"transparent",border:"1px solid transparent",borderRadius:4,cursor:"pointer",fontFamily:"inherit",transition:"all .1s"}}
                onMouseOver={e=>{e.target.style.background="#161618";e.target.style.borderColor="#1E1E20"}}
                onMouseOut={e=>{e.target.style.background="transparent";e.target.style.borderColor="transparent"}}>
                + {cs}
              </button>
            ))}
          </div>
        </div>}
      </div>}
    </Sec>
  );
}

function FundingItemsSection({deal,role="admin"}) {
  const {addFundingItem,resolveFundingItem,removeFundingItem} = useContext(Ctx);
  const [newItem,setNewItem]=useState("");
  const items = deal.fundingItems||[];
  const pending = items.filter(f=>!f.done).length;
  const isAdmin = role==="admin";
  const isDealer = role==="dealer";

  const COMMON_FUNDING = ["Final Invoice","Title Copy","Bill of Sale","Odometer Statement","Insurance Binder","Inspection Report"];

  const handleUpload = (itemId, text) => {
    const fileName = `${deal.biz?.replace(/\s/g,"_")}_${text.replace(/[\s()]/g,"_")}.pdf`;
    resolveFundingItem(deal.id, itemId, fileName);
  };

  if(!deal.accepted && !isAdmin) return null;

  return(
    <Sec t={<span style={{display:"flex",alignItems:"center",gap:6}}>
      {isDealer?"Action Required":"Dealer Funding Items"}
      {pending>0&&<span style={{fontSize:9,padding:"1px 6px",borderRadius:8,background:"#E8930018",color:"#E89300",border:"1px solid #E8930033",fontWeight:700}}>{pending} needed</span>}
      {pending===0&&items.length>0&&<span style={{fontSize:9,padding:"1px 6px",borderRadius:8,background:"#4CAF5012",color:"#4CAF50",fontWeight:600}}>All received</span>}
    </span>}>
      {isDealer&&deal.accepted&&<div style={{padding:"10px 12px",background:"#4F8EAE08",border:"1px solid #4F8EAE22",borderRadius:6,marginBottom:8}}>
        <div style={{fontSize:12,fontWeight:600,color:"#4F8EAE",marginBottom:3}}>Customer accepted approval!</div>
        <div style={{fontSize:11,color:"#888",lineHeight:1.5}}>Please attach the items below so we can get financing documents out to {deal.contact}.</div>
      </div>}
      {items.length===0&&isAdmin&&<div style={{fontSize:11,color:"#444",padding:"4px 0"}}>No funding items yet. Add items the dealer needs to provide.</div>}
      {items.map(f=>(
        <div key={f.id} style={{display:"flex",alignItems:"flex-start",gap:8,padding:"7px 9px",background:f.done?"#4CAF5006":"#E8930008",border:`1px solid ${f.done?"#4CAF5018":"#E8930018"}`,borderRadius:5}}>
          <div style={{width:18,height:18,borderRadius:4,border:`1.5px solid ${f.done?"#4CAF50":"#E89300"}`,background:f.done?"#4CAF5022":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:1}}>
            {f.done&&<span style={{color:"#4CAF50"}}><I.Check/></span>}
          </div>
          <div style={{flex:1,minWidth:0}}>
            <span style={{fontSize:12,color:f.done?"#666":"#ddd",textDecoration:f.done?"line-through":"none"}}>{f.text}</span>
            {f.file&&<div style={{fontSize:10,color:"#4CAF50",marginTop:2,display:"flex",alignItems:"center",gap:4}}><I.Doc/> {f.file}</div>}
          </div>
          <div style={{display:"flex",gap:3,flexShrink:0}}>
            {!f.done&&(isDealer||isAdmin)&&<button className="av-ghost" style={{...S.ghost,padding:"3px 7px",fontSize:9,gap:3}} onClick={()=>handleUpload(f.id,f.text)}><I.Upload/> Attach</button>}
            {isAdmin&&<button style={S.tinyBtn} onClick={()=>removeFundingItem(deal.id,f.id)}><I.X/></button>}
          </div>
        </div>
      ))}
      {isAdmin&&<div style={{marginTop:6,display:"flex",gap:6}}>
        <input style={{...S.inp,flex:1,fontSize:12}} placeholder="Add funding item..." value={newItem} onChange={e=>setNewItem(e.target.value)} onKeyDown={e=>{if(e.key==="Enter"&&newItem.trim()){addFundingItem(deal.id,newItem.trim());setNewItem("")}}}/>
        <button className="av-btn" style={{...S.prim,padding:"6px 10px",fontSize:11}} onClick={()=>{if(newItem.trim()){addFundingItem(deal.id,newItem.trim());setNewItem("")}}}><I.Plus/></button>
      </div>}
      {isAdmin&&items.length===0&&<div style={{display:"flex",gap:4,flexWrap:"wrap",marginTop:4}}>
        {COMMON_FUNDING.map(cf=><button key={cf} className="av-ghost" style={{...S.ghost,padding:"3px 8px",fontSize:9}} onClick={()=>addFundingItem(deal.id,cf)}>+ {cf}</button>)}
      </div>}
    </Sec>
  );
}
function FB({l,v,sub,vs}){return(<div><div style={{fontSize:9,color:"#555",textTransform:"uppercase",letterSpacing:.8,marginBottom:2}}>{l}</div><div style={{fontSize:13,color:"#ddd",fontWeight:500,...vs}}>{v}</div>{sub&&<div style={{fontSize:11,color:"#666",marginTop:1}}>{sub}</div>}</div>)}
function FF({l,v,ch,ph,t}){return(<div><label style={S.fLabel}>{l}</label><input type={t||"text"} style={S.inp} value={v} onChange={e=>ch(e.target.value)} placeholder={ph}/></div>)}

// ════════════════════════════════════════════════════════════════
// STYLES
// ════════════════════════════════════════════════════════════════

const S = {
  app:{minHeight:"100vh",background:"#0A0A0A",color:"#e0e0e8",fontFamily:"'Outfit',-apple-system,sans-serif"},
  // Nav
  nav:{background:"#080808",borderBottom:"1px solid #1A1A1C",padding:"0 20px",position:"sticky",top:0,zIndex:50},
  navIn:{display:"flex",alignItems:"center",gap:16,maxWidth:1440,margin:"0 auto",flexWrap:"wrap"},
  logo:{display:"flex",alignItems:"center",gap:8,padding:"10px 0"},
  logoIc:{color:"#4F8EAE",display:"flex"},
  logoTxt:{fontFamily:"'Outfit',sans-serif",fontSize:20,fontWeight:900,letterSpacing:3,color:"#fff"},
  logoSub:{fontSize:7,letterSpacing:2.5,color:"#5A6872",textTransform:"uppercase",fontWeight:600,marginTop:-2},
  navTabs:{display:"flex",gap:1,flex:1},
  navTab:{display:"flex",alignItems:"center",gap:6,padding:"14px 14px",background:"none",border:"none",borderBottom:"2px solid transparent",color:"#555",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit",transition:"all .15s",whiteSpace:"nowrap"},
  navTabA:{color:"#fff",borderBottomColor:"#4F8EAE"},
  navR:{display:"flex",alignItems:"center",gap:8},
  navUser:{fontSize:12,color:"#666",display:"flex",alignItems:"center",gap:5},
  // Main
  main:{padding:0},
  wrap:{maxWidth:1440,margin:"0 auto",padding:"16px 20px 40px"},
  pWrap:{maxWidth:900,margin:"0 auto",padding:"20px 20px 40px"},
  // Header
  hdr:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:10},
  srchW:{display:"flex",alignItems:"center",gap:8,background:"#161618",border:"1px solid #1E1E20",borderRadius:8,padding:"8px 12px",color:"#555"},
  srchIn:{background:"none",border:"none",color:"#e0e0e8",fontSize:13,outline:"none",width:240,fontFamily:"inherit"},
  // Stats
  statsG:{display:"flex",gap:1,flexWrap:"wrap",marginBottom:14},
  statC:{flex:1,minWidth:120,background:"#121214",padding:"12px 16px",borderRadius:0},
  statV:{fontSize:19,fontWeight:700,fontVariantNumeric:"tabular-nums"},
  statL:{fontSize:9,color:"#555",textTransform:"uppercase",letterSpacing:.8,marginTop:2},
  // Tabs
  tabs:{display:"flex",gap:2,borderBottom:"1px solid #1A1A1C"},
  tab:{display:"flex",alignItems:"center",gap:5,padding:"9px 14px",background:"none",border:"none",borderBottom:"2px solid transparent",color:"#555",fontSize:11,fontWeight:600,cursor:"pointer",fontFamily:"inherit"},
  tabA:{color:"#fff",borderBottomColor:"#4F8EAE"},
  // Kanban
  kanban:{display:"flex",gap:7,overflowX:"auto",paddingBottom:16},
  kCol:{flex:"0 0 190px",minHeight:360,background:"#121214",borderRadius:9,border:"1px solid #1A1A1C",transition:"all .15s"},
  kHead:{padding:"10px 10px 7px",borderBottom:"1px solid #1A1A1C"},
  kTitle:{display:"flex",alignItems:"center",gap:5,fontSize:10,fontWeight:600,textTransform:"uppercase",letterSpacing:.7,color:"#bbb"},
  kCnt:{fontSize:9,color:"#555",background:"#1A1A1C",borderRadius:8,padding:"1px 5px",fontWeight:600},
  kTot:{fontSize:10,color:"#555",marginTop:2,fontVariantNumeric:"tabular-nums"},
  kCards:{padding:5,display:"flex",flexDirection:"column",gap:4},
  kCard:{background:"#1A1A1C",borderRadius:6,padding:"9px 10px",cursor:"grab",borderLeft:"3px solid #4F8EAE",userSelect:"none",transition:"all .1s",border:"1px solid transparent"},
  kName:{fontSize:11,fontWeight:600,color:"#fff",marginBottom:4,lineHeight:1.3},
  kMeta:{display:"flex",alignItems:"center",gap:4,fontSize:9,color:"#777",marginBottom:1},
  kBot:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:5},
  kAmt:{fontSize:11,fontWeight:700,color:"#6BA3BF",fontVariantNumeric:"tabular-nums"},
  kTime:{fontSize:8,color:"#444"},
  kDlr:{fontSize:8,color:"#4F8EAE66",marginTop:2,fontStyle:"italic"},
  kStip:{fontSize:9,color:"#E89300",marginTop:3,display:"flex",alignItems:"center",gap:3,fontWeight:600},
  kEmpty:{padding:14,textAlign:"center",color:"#333",fontSize:10},
  dot:{width:7,height:7,borderRadius:"50%",flexShrink:0},
  // Table
  table:{width:"100%",borderCollapse:"collapse"},
  th:{textAlign:"left",padding:"8px 10px",fontSize:9,fontWeight:600,textTransform:"uppercase",letterSpacing:.8,color:"#555",borderBottom:"1px solid #1A1A1C",whiteSpace:"nowrap"},
  tr:{cursor:"pointer",borderBottom:"1px solid #121214",transition:"all .15s"},
  td:{padding:"9px 10px",fontSize:12,verticalAlign:"top",color:"#bbb"},
  badge:{display:"inline-block",padding:"2px 7px",borderRadius:14,fontSize:10,fontWeight:600,border:"1px solid",whiteSpace:"nowrap"},
  // Buttons
  prim:{display:"flex",alignItems:"center",gap:5,background:"#4F8EAE",color:"#fff",border:"none",borderRadius:7,padding:"8px 16px",fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit",transition:"all .15s"},
  ghost:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",background:"none",border:"1px solid #2A2A2E",color:"#888",borderRadius:7,fontSize:12,cursor:"pointer",fontFamily:"inherit",transition:"all .15s"},
  danger:{padding:"7px 12px",background:"#B0413E18",color:"#B0413E",border:"1px solid #B0413E33",borderRadius:7,fontSize:12,cursor:"pointer",fontFamily:"inherit",display:"flex",alignItems:"center",gap:4},
  tinyBtn:{background:"none",border:"none",color:"#555",cursor:"pointer",padding:3},
  closeBtn:{background:"none",border:"none",color:"#555",cursor:"pointer",padding:4},
  reactBtn:{display:"flex",alignItems:"center",gap:5,padding:"7px 14px",background:"#4F8EAE12",color:"#4F8EAE",border:"1px solid #4F8EAE33",borderRadius:7,fontSize:12,fontWeight:600,cursor:"pointer",fontFamily:"inherit",whiteSpace:"nowrap"},
  // Overlay / Drawer / Modal
  overlay:{position:"fixed",inset:0,background:"rgba(0,0,0,.6)",zIndex:100,display:"flex",justifyContent:"flex-end"},
  drawer:{width:440,maxWidth:"92vw",height:"100vh",background:"#121214",borderLeft:"1px solid #1A1A1C",display:"flex",flexDirection:"column",animation:"slideIn .25s ease-out"},
  drHead:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",padding:"16px 18px",borderBottom:"1px solid #1A1A1C"},
  drBody:{flex:1,padding:"16px 18px",overflowY:"auto"},
  drFoot:{display:"flex",gap:8,padding:"12px 18px",borderTop:"1px solid #1E1E20"},
  modal:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:520,maxWidth:"94vw",maxHeight:"90vh",background:"#121214",borderRadius:10,border:"1px solid #1A1A1C",zIndex:200,display:"flex",flexDirection:"column",overflow:"hidden",animation:"scaleIn .2s ease-out"},
  // Form
  fLabel:{fontSize:10,fontWeight:600,color:"#666",textTransform:"uppercase",letterSpacing:.6,marginBottom:3,display:"block"},
  inp:{width:"100%",background:"#161618",border:"1px solid #2A2A2E",borderRadius:6,padding:"8px 10px",color:"#e0e0e8",fontSize:13,fontFamily:"inherit",outline:"none",boxSizing:"border-box"},
  fSel:{width:"100%",background:"#161618",border:"1px solid #2A2A2E",borderRadius:6,padding:"8px 10px",color:"#e0e0e8",fontSize:13,fontFamily:"inherit",outline:"none"},
  // Doc row
  docRow:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 8px",background:"#161618",borderRadius:5,border:"1px solid #1A1A1C"},
  reqB:{fontSize:8,padding:"1px 5px",borderRadius:8,background:"#3A6F8F18",color:"#3A6F8F",border:"1px solid #3A6F8F33"},
  // Misc
  field:{display:"flex",alignItems:"center",gap:6,fontSize:12,color:"#ccc"},
  codeChip:{display:"flex",alignItems:"center",gap:5,padding:"3px 8px",background:"#4F8EAE09",border:"1px solid #4F8EAE22",borderRadius:4,cursor:"pointer",fontSize:11,color:"#4F8EAE",fontFamily:"inherit"},
  bigCode:{fontFamily:"'JetBrains Mono',monospace",fontSize:17,fontWeight:700,color:"#4F8EAE",background:"#4F8EAE09",padding:"7px 14px",borderRadius:6,letterSpacing:2},
  noteBox:{fontSize:12,color:"#aaa",lineHeight:1.5,background:"#161618",padding:"8px 12px",borderRadius:6},
  noteItem:{padding:"6px 10px",background:"#161618",borderRadius:5,border:"1px solid #1A1A1C"},
  approvalBox:{padding:"14px 18px",background:"#161618",border:"1px solid #1E1E20",borderRadius:9},
  statusCard:{background:"#161618",border:"1px solid",borderRadius:10,padding:"18px 22px",marginBottom:18},
  progTrack:{height:6,background:"#1E1E20",borderRadius:3,overflow:"hidden"},
  progFill:{height:"100%",borderRadius:3,transition:"width .5s ease"},
  amCard:{marginTop:24,background:"#161618",borderRadius:10,padding:"14px 18px",display:"flex",alignItems:"center",gap:12},
  amAv:{width:36,height:36,borderRadius:"50%",background:"#4F8EAE18",display:"flex",alignItems:"center",justifyContent:"center",color:"#4F8EAE"},
  // Portal
  pHead:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:10},
  custCard:{background:"#121214",border:"1px solid #1A1A1C",borderRadius:12,padding:"28px 24px",maxWidth:600,margin:"0 auto"},
  dlrCard:{background:"#121214",border:"1px solid #1A1A1C",borderRadius:9,padding:"14px 18px",transition:"all .15s"},
  dlrDealRow:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"#121214",border:"1px solid #1A1A1C",borderRadius:7,padding:"12px 16px",cursor:"pointer",transition:"all .15s"},
  specB:{fontSize:9,padding:"2px 7px",borderRadius:10,background:"#6BA3BF12",color:"#6BA3BF",border:"1px solid #6BA3BF25"},
  deadRow:{display:"flex",alignItems:"center",gap:12,background:"#121214",border:"1px solid #1A1A1C",borderRadius:7,padding:"12px 16px",borderLeft:"3px solid #555",marginBottom:6,transition:"all .15s"},
  deadWas:{fontSize:9,color:"#555",background:"#1E1E20",padding:"1px 5px",borderRadius:3},
  lndrRow:{display:"flex",alignItems:"center",gap:12,background:"#121214",border:"1px solid #1A1A1C",borderRadius:7,padding:"14px 18px",transition:"all .15s"},
  setCard:{background:"#121214",border:"1px solid #1A1A1C",borderRadius:9,padding:"18px 22px"},
  setT:{fontSize:14,fontWeight:700,color:"#fff",marginBottom:4},
  setD:{fontSize:12,color:"#777",lineHeight:1.5},
  // Login
  loginWrap:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"70vh",padding:20},
  loginCard:{background:"#121214",border:"1px solid #1A1A1C",borderRadius:12,padding:"32px 28px",maxWidth:380,width:"100%",textAlign:"center"},
  loginTitle:{fontSize:20,fontWeight:700,color:"#fff",margin:"10px 0 4px"},
  loginDesc:{fontSize:12,color:"#777",marginBottom:18,lineHeight:1.5},
  loginErr:{color:"#B0413E",fontSize:12,marginTop:8},
  empty:{padding:50,textAlign:"center",color:"#444",background:"#121214",borderRadius:10},
  toast:{position:"fixed",bottom:24,left:"50%",transform:"translateX(-50%)",padding:"10px 20px",borderRadius:8,color:"#fff",fontSize:13,fontWeight:600,zIndex:999,display:"flex",alignItems:"center",gap:8,boxShadow:"0 4px 20px rgba(0,0,0,.4)"},
};
